<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊÅêÊÄñÂ•∂Â•∂ - Â§©ÂàõÊó∂‰ª£</title>
    <script src="api-config.js"></script>
    <script src="api-service.js"></script>
    <script src="data-adapter.js"></script>
    <script src="points-system.js"></script>
    <script src="user-system.js"></script>
    <script src="common.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Quicksand', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b1b 50%, #0f0f0f 100%);
            min-height: 100vh;
            color: white;
            position: relative;
            overflow-x: hidden;
        }
        
        /* ÊÅêÊÄñËÉåÊôØÊïàÊûú - ÂçáÁ∫ßÁâà */
        .horror-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(139, 0, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(75, 0, 130, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 0, 0, 0.2) 0%, transparent 50%);
            animation: horrorPulse 4s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        /* Â•∂Â•∂ÂèçÂ∞ÑÊïàÊûú */
        .grandma-reflection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path d="M100,20 C60,20 30,50 30,90 C30,130 60,160 100,160 C140,160 170,130 170,90 C170,50 140,20 100,20 Z" fill="none" stroke="rgba(139,0,0,0.1)" stroke-width="2"/></svg>') repeat;
            opacity: 0.1;
            pointer-events: none;
            z-index: 1;
            animation: reflectionMove 20s linear infinite;
        }
        
        @keyframes reflectionMove {
            0% { transform: translateX(0) translateY(0); }
            50% { transform: translateX(-10px) translateY(-5px); }
            100% { transform: translateX(0) translateY(0); }
        }
        
        /* Â§©Ê∞îÊïàÊûú - Ë°ÄÈõ® */
        .weather-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
            opacity: 0;
            transition: opacity 1s ease;
        }
        
        .weather-effect.blood-rain {
            background: 
                radial-gradient(circle at 10% 20%, rgba(139, 0, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 30% 40%, rgba(139, 0, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 50% 60%, rgba(139, 0, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 70% 80%, rgba(139, 0, 0, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 10%, rgba(139, 0, 0, 0.1) 0%, transparent 20%);
            opacity: 0.3;
            animation: bloodRain 3s linear infinite;
        }
        
        @keyframes bloodRain {
            0% { background-position: 0 0; }
            100% { background-position: 0 100px; }
        }
        
        @keyframes horrorPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        /* Èó™ÁîµÊïàÊûú */
        .lightning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0);
            pointer-events: none;
            z-index: 100;
        }
        
        .lightning.flash {
            animation: lightningFlash 0.3s ease-out;
        }
        
        @keyframes lightningFlash {
            0% { background: rgba(255, 255, 255, 0); }
            50% { background: rgba(255, 255, 255, 0.8); }
            100% { background: rgba(255, 255, 255, 0); }
        }
        
        /* ‰∏ªÂÆπÂô® */
        .main-container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* È°∂ÈÉ®ÂØºËà™ */
        .top-nav {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 0, 0, 0.3);
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8b0000, #4b0082);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            animation: logo-bounce 2s ease-in-out infinite;
        }
        
        @keyframes logo-bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-8px); }
            60% { transform: translateY(-4px); }
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, #ff0000, #8b0000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: linear-gradient(135deg, #8b0000, #4b0082);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .nav-btn:hover::before {
            left: 100%;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.4);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #8b0000, #4b0082);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: bold;
            color: #fff;
            font-size: 1rem;
        }
        
        .user-points {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 4px 12px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .user-canes {
            background: linear-gradient(135deg, #8b4513, #a0522d);
            color: white;
            padding: 4px 12px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-left: 8px;
        }
        
        /* Ê∏∏ÊàèÁªüËÆ°Ê†è */
        .game-stats {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .stat-card {
            background: rgba(255, 0, 0, 0.1);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 0, 0, 0.2);
        }
        
        .stat-label {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .stat-value {
            color: #fff;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        /* ‰∏ªÊ∏∏ÊàèÂå∫Âüü */
        .game-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .game-area {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
            border: 1px solid rgba(255, 0, 0, 0.3);
            position: relative;
        }
        
        .game-title {
            font-size: 2rem;
            color: #ff0000;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 3px 6px rgba(255, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            animation: titleGlow 2s ease-in-out infinite;
        }
        
        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 3px 6px rgba(255, 0, 0, 0.5); }
            50% { text-shadow: 0 3px 15px rgba(255, 0, 0, 0.8); }
        }
        
        .grandma-icon {
            font-size: 1.5rem;
            animation: grandmaFloat 3s ease-in-out infinite;
        }
        
        @keyframes grandmaFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(-5deg); }
            75% { transform: translateY(-10px) rotate(5deg); }
        }
        
        /* Ê∏∏ÊàèËÆ°Êó∂Âô® */
        .game-timer {
            background: rgba(139, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
            border: 1px solid rgba(255, 0, 0, 0.3);
            position: relative;
        }
        
        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            color: #ff6b35;
            text-shadow: 0 3px 6px rgba(0,0,0,0.5);
            font-family: 'Courier New', monospace;
        }
        
        .timer-display.warning {
            color: #ff0000;
            animation: timerWarning 1s ease-in-out infinite;
        }
        
        @keyframes timerWarning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .timer-status {
            color: #ff6b6b;
            font-size: 1rem;
            margin-top: 10px;
        }
        
        /* ÊàøÈó¥ÁΩëÊ†º */
        .rooms-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .room {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(255, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .room::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.5) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .room:hover::before {
            opacity: 1;
        }
        
        .room:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 0, 0, 0.3);
            border-color: rgba(255, 0, 0, 0.6);
        }
        
        .room.selected {
            background: rgba(0, 100, 0, 0.3);
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .room.danger {
            background: rgba(139, 0, 0, 0.5);
            border-color: #ff0000;
            animation: dangerPulse 1s ease-in-out infinite;
        }
        
        @keyframes dangerPulse {
            0%, 100% { 
                background: rgba(139, 0, 0, 0.5);
                transform: scale(1);
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            }
            50% { 
                background: rgba(255, 0, 0, 0.7);
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
            }
        }
        
        .room.safe {
            background: rgba(0, 100, 0, 0.3);
            border-color: #00ff00;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }
        
        .room-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            transition: transform 0.3s ease;
        }
        
        .room:hover .room-icon {
            transform: scale(1.2);
        }
        
        .room-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .room-pool {
            color: #ff6b35;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .room-players {
            color: #3498db;
            font-size: 0.85em;
        }
        
        .room-bet {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 107, 53, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* ÊäïÊ≥®Âå∫Âüü */
        .betting-area {
            background: rgba(139, 0, 0, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .betting-title {
            color: #ff6b6b;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .bet-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .bet-input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 0, 0, 0.3);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1rem;
            width: 150px;
            text-align: center;
        }
        
        .bet-btn {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .bet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }
        
        .bet-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .quick-bet-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .quick-bet {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid rgba(255, 107, 53, 0.5);
            color: #ff6b35;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .quick-bet:hover {
            background: rgba(255, 107, 53, 0.4);
            transform: translateY(-1px);
        }
        
        /* ‰æßËæπÊ†è */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* Â•ñÈáëÊ±† */
        .prize-pool {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
            border: 2px solid rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .prize-pool::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            animation: rotate-glow 20s linear infinite;
        }
        
        @keyframes rotate-glow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .prize-pool-title {
            font-size: 1.3rem;
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }
        
        .prize-amount {
            font-size: 2rem;
            color: #ffd700;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 3px 6px rgba(255, 215, 0, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .prize-info {
            color: #ff6b6b;
            font-size: 0.9rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        
        /* ËøûËÉúÊòæÁ§∫ */
        .win-streak {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.4);
            z-index: 100;
            animation: streakGlow 2s ease-in-out infinite;
        }
        
        @keyframes streakGlow {
            0%, 100% { box-shadow: 0 10px 25px rgba(255, 107, 53, 0.4); }
            50% { box-shadow: 0 15px 35px rgba(255, 107, 53, 0.6); }
        }
        
        .streak-text {
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .streak-number {
            color: #ffd700;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        /* ÂéÜÂè≤ËÆ∞ÂΩï */
        .history-section {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .history-title {
            font-size: 1.3rem;
            color: #ff6b6b;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 53, 0.2);
            transition: all 0.3s ease;
        }
        
        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);
        }
        
        .history-item:last-child {
            margin-bottom: 0;
        }
        
        .history-round {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 15px;
            font-size: 0.8rem;
        }
        
        .history-rooms {
            flex: 1;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .history-mode {
            color: #ffd700;
            font-weight: bold;
            font-size: 0.8rem;
            margin-top: 3px;
        }
        
        /* ÊéíË°åÊ¶ú */
        .leaderboard {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8);
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .leaderboard-title {
            font-size: 1.3rem;
            color: #ff6b6b;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .leaderboard-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .leaderboard-tab {
            flex: 1;
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid rgba(255, 107, 53, 0.5);
            color: #ff6b35;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .leaderboard-tab.active {
            background: rgba(255, 107, 53, 0.5);
            color: white;
        }
        
        .leaderboard-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 53, 0.2);
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);
        }
        
        .leaderboard-rank {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #8b0000;
            margin-right: 15px;
        }
        
        .leaderboard-rank.silver {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: #333;
        }
        
        .leaderboard-rank.bronze {
            background: linear-gradient(135deg, #cd7f32, #e4a853);
            color: white;
        }
        
        .leaderboard-name {
            flex: 1;
            color: white;
            font-weight: 600;
        }
        
        .leaderboard-value {
            color: #ffd700;
            font-weight: bold;
        }
        
        /* ÊúÄÊñ∞ËÉåÂåÖÁ≥ªÁªüÊ†∑Âºè */
        .backpack-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .backpack-page {
            background: linear-gradient(135deg, #1a1a1a, #2d1b1b);
            border-radius: 25px;
            padding: 40px;
            max-width: 900px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 107, 53, 0.3);
            position: relative;
            animation: modalSlideUp 0.3s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes modalSlideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .backpack-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 107, 53, 0.3);
        }
        
        .backpack-title {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .backpack-close {
            background: none;
            border: none;
            color: #ff6b6b;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .backpack-close:hover {
            background: rgba(255, 107, 107, 0.1);
            transform: rotate(90deg);
        }
        
        .backpack-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .backpack-stat {
            background: rgba(255, 107, 53, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }
        
        .backpack-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);
        }
        
        .backpack-stat-label {
            color: #ff6b6b;
            font-size: 1rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .backpack-stat-value {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .backpack-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .backpack-category {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid rgba(255, 107, 53, 0.5);
            color: #ff6b35;
            padding: 8px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .backpack-category.active {
            background: rgba(255, 107, 53, 0.5);
            color: white;
        }
        
        .backpack-category:hover:not(.active) {
            background: rgba(255, 107, 53, 0.4);
            transform: translateY(-1px);
        }
        
        .backpack-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .backpack-item {
            background: rgba(255, 107, 53, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }
        
        .backpack-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.3);
        }
        
        .backpack-item.selected {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .backpack-item-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            position: relative;
        }
        
        .backpack-item-rarity {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .backpack-item-rarity.legendary {
            background: linear-gradient(135deg, #ff0000, #8b0000);
        }
        
        .backpack-item-rarity.epic {
            background: linear-gradient(135deg, #9933ff, #6600cc);
        }
        
        .backpack-item-rarity.rare {
            background: linear-gradient(135deg, #00bcd4, #0088cc);
        }
        
        .backpack-item-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
        }
        
        .backpack-item-count {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 8px;
        }
        
        .backpack-item-desc {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .backpack-item-stats {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 0.8rem;
            color: #ccc;
        }
        
        .backpack-item-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .backpack-item-action {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .backpack-item-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }
        
        .backpack-item-action:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .backpack-item-action.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .backpack-item-action.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .backpack-item-action.sell {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .backpack-item-action.sell:hover {
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        /* Áâ©ÂìÅËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü */
        .item-detail-modal {
            background: linear-gradient(135deg, #1a1a1a, #2d1b1b);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 107, 53, 0.3);
            position: relative;
            animation: modalSlideUp 0.3s ease-out;
        }
        
        .item-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 107, 53, 0.3);
        }
        
        .item-detail-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff6b6b;
        }
        
        .item-detail-close {
            background: none;
            border: none;
            color: #ff6b6b;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .item-detail-close:hover {
            background: rgba(255, 107, 107, 0.1);
            transform: rotate(90deg);
        }
        
        .item-detail-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .item-detail-info {
            background: rgba(255, 107, 53, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .item-detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: white;
            font-size: 1rem;
        }
        
        .item-detail-label {
            color: #ff6b6b;
            font-weight: 600;
        }
        
        .item-detail-value {
            font-weight: bold;
        }
        
        .item-detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* ÊØèÊó•‰ªªÂä°ÂºπÁ™ó */
        .tasks-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        .tasks-page {
            background: linear-gradient(135deg, #1a1a1a, #2d1b1b);
            border-radius: 25px;
            padding: 40px;
            max-width: 700px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 107, 53, 0.3);
            position: relative;
            animation: modalSlideUp 0.3s ease-out;
        }
        
        .tasks-title {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .task-item {
            background: rgba(255, 107, 53, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .task-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
        }
        
        .task-reward {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            padding: 5px 15px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .task-desc {
            color: #ff6b6b;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .task-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            flex: 1;
            height: 10px;
            background: rgba(255, 107, 53, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin-right: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            min-width: 80px;
        }
        
        .task-btn {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .task-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }
        
        .task-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* ÁßØÂàÜÊòéÁªÜÂºπÁ™ó */
        .points-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        .points-page {
            background: linear-gradient(135deg, #1a1a1a, #2d1b1b);
            border-radius: 25px;
            padding: 40px;
            max-width: 700px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 107, 53, 0.3);
            position: relative;
            animation: modalSlideUp 0.3s ease-out;
        }
        
        .points-title {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b6b;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .points-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .points-stat {
            background: rgba(255, 107, 53, 0.1);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
        }
        
        .points-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);
        }
        
        .stat-label {
            color: #ff6b6b;
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .stat-value {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .stat-value.positive {
            color: #00ff00;
        }
        
        .stat-value.negative {
            color: #ff0000;
        }
        
        .points-history {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 30px;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 107, 53, 0.2);
            transition: all 0.3s ease;
        }
        
        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);
        }
        
        .history-desc {
            color: white;
            font-weight: 600;
        }
        
        .history-amount {
            font-weight: bold;
        }
        
        .history-amount.positive {
            color: #00ff00;
        }
        
        .history-amount.negative {
            color: #ff0000;
        }
        
        /* Ê∂àÊÅØÊèêÁ§∫ */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            z-index: 1001;
            animation: messageSlideIn 0.3s ease-out;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            max-width: 300px;
        }
        
        @keyframes messageSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .message.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .message.error {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .message.info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: 1fr;
            }
            
            .rooms-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .game-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bet-controls {
                flex-direction: column;
            }
            
            .win-streak {
                bottom: 10px;
                right: 10px;
                padding: 10px 15px;
            }
            
            .backpack-items {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .backpack-stats {
                grid-template-columns: 1fr;
            }
            
            .points-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ÊÅêÊÄñËÉåÊôØ -->
    <div class="horror-bg"></div>
    <div class="grandma-reflection"></div>
    <div class="weather-effect" id="weatherEffect"></div>
    <div class="lightning" id="lightning"></div>
    
    <!-- ‰∏ªÂÆπÂô® -->
    <div class="main-container">
        <!-- È°∂ÈÉ®ÂØºËà™ -->
        <div class="top-nav">
            <div class="logo-section">
                <div class="logo-icon">üëµ</div>
                <div class="logo-text">ÊÅêÊÄñÂ•∂Â•∂</div>
            </div>
            
            <div class="nav-buttons">
                <button class="nav-btn" onclick="location.href='index.html'">üè† ËøîÂõûÈ¶ñÈ°µ</button>
                <button class="nav-btn" onclick="GrandmaGame.showBackpack()">üéí ËÉåÂåÖ</button>
                <button class="nav-btn" onclick="GrandmaGame.showDailyTasks()">üìã ÊØèÊó•‰ªªÂä°</button>
                <button class="nav-btn" onclick="GrandmaGame.showPointsDetails()">üí∞ ÁßØÂàÜÊòéÁªÜ</button>
            </div>
            
            <div class="user-info">
                <div class="user-avatar">üë§</div>
                <div class="user-details">
                    <div class="user-name" id="userName">Âä†ËΩΩ‰∏≠...</div>
                    <div>
                        <span class="user-points">üí∞ <span id="userPoints">0</span></span>
                        <span class="user-canes">ü¶Ø <span id="userCanes">0</span></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ê∏∏ÊàèÁªüËÆ° -->
        <div class="game-stats">
            <div class="stat-card">
                <div class="stat-label">ÂΩìÂâçÂõûÂêà</div>
                <div class="stat-value" id="currentRound">1</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Â•ñÈáëÊ±†</div>
                <div class="stat-value">üí∞ <span id="prizePoolAmount">0</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Âú®Á∫øÁé©ÂÆ∂</div>
                <div class="stat-value" id="onlinePlayers">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ÊÄªÊäïÊ≥®</div>
                <div class="stat-value">üí∞ <span id="totalBets">0</span></div>
            </div>
        </div>
        
        <!-- ‰∏ªÊ∏∏ÊàèÂå∫Âüü -->
        <div class="game-container">
            <div class="game-area">
                <div class="game-title">
                    <span class="grandma-icon">üëµ</span>
                    <span>ÊÅêÊÄñÂ•∂Â•∂ÊàøÈó¥</span>
                    <span class="grandma-icon">üèöÔ∏è</span>
                </div>
                
                <!-- Ê∏∏ÊàèËÆ°Êó∂Âô® -->
                <div class="game-timer">
                    <div class="timer-display" id="timerDisplay">30</div>
                    <div class="timer-status" id="timerStatus">ÂáÜÂ§áÈò∂ÊÆµ</div>
                </div>
                
                <!-- ÊàøÈó¥ÁΩëÊ†º -->
                <div class="rooms-container" id="roomsContainer">
                    <!-- ÊàøÈó¥Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                
                <!-- ÊäïÊ≥®Âå∫Âüü -->
                <div class="betting-area">
                    <div class="betting-title">üí∞ ÊäïÊ≥®Âå∫Âüü</div>
                    <div class="bet-controls">
                        <input type="number" class="bet-input" id="betAmount" placeholder="ËæìÂÖ•ÊäïÊ≥®ÈáëÈ¢ù" min="1" max="1000">
                        <button class="bet-btn" id="betBtn" onclick="placeBet()">Á°ÆËÆ§ÊäïÊ≥®</button>
                    </div>
                    <div class="quick-bet-buttons">
                        <button class="quick-bet" onclick="quickBet(10)">10</button>
                        <button class="quick-bet" onclick="quickBet(50)">50</button>
                        <button class="quick-bet" onclick="quickBet(100)">100</button>
                        <button class="quick-bet" onclick="quickBet(500)">500</button>
                    </div>
                </div>
            </div>
            
            <!-- ‰æßËæπÊ†è -->
            <div class="sidebar">
                <!-- Â•ñÈáëÊ±† -->
                <div class="prize-pool">
                    <div class="prize-pool-title">üèÜ Â•ñÈáëÊ±†</div>
                    <div class="prize-amount">üí∞ <span id="prizePoolDisplay">0</span></div>
                    <div class="prize-info">ÂâçÂçÅÂêçÁìúÂàÜ</div>
                </div>
                
                <!-- ÂéÜÂè≤ËÆ∞ÂΩï -->
                <div class="history-section">
                    <div class="history-title">üìú Â•∂Â•∂ËøëÂçÅÊúüÂéªÂêë</div>
                    <div class="history-list" id="historyList">
                        <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
                
                <!-- ÊéíË°åÊ¶ú -->
                <div class="leaderboard">
                    <div class="leaderboard-title">üìä ÊéíË°åÊ¶ú</div>
                    <div class="leaderboard-tabs">
                        <div class="leaderboard-tab active" onclick="switchLeaderboard('bet')">ÊäïÊ≥®Ê¶ú</div>
                        <div class="leaderboard-tab" onclick="switchLeaderboard('streak')">ËøûËÉúÊ¶ú</div>
                    </div>
                    <div class="leaderboard-list" id="leaderboardList">
                        <!-- ÊéíË°åÊ¶úÊï∞ÊçÆÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ËøûËÉúÊòæÁ§∫ -->
    <div class="win-streak" id="winStreak">
        <div class="streak-text">ËøûËÉú</div>
        <div class="streak-number" id="streakNumber">0</div>
    </div>

    <script>
        // ÊÅêÊÄñÂ•∂Â•∂Ê∏∏ÊàèÁ≥ªÁªü - ÊúÄÊñ∞ËÉåÂåÖÈõÜÊàêÁâà
        const GrandmaGame = {
            // Ê∏∏ÊàèÁä∂ÊÄÅ
            gameState: {
                currentRound: 1,
                timeLeft: 30,
                isLocked: false,
                selectedRoom: null,
                betAmount: 0,
                totalBets: 0,
                prizePool: 0,
                winStreak: 0,
                hasProtection: false,
                rooms: [],
                players: {},
                leaderboard: {
                    bet: [],
                    streak: []
                },
                history: [],
                grandmaAppeared: false,
                userPoints: 0,
                roundEnded: false,
                // Êñ∞Â¢ûÁä∂ÊÄÅ
                userCanes: 0,
                dailyTasks: {
                    task1: { completed: 0, target: 10, claimed: false },
                    task2: { completed: 0, target: 30, claimed: false },
                    task3: { completed: 0, target: 10, claimed: false, count: 0 }
                },
                pointsHistory: [],
                totalInvested: 0,
                totalEarned: 0,
                // ÊúÄÊñ∞ËÉåÂåÖÁ≥ªÁªü
                backpack: {
                    items: [],
                    capacity: 50,
                    categories: ['all', 'consumable', 'equipment', 'special', 'currency'],
                    selectedCategory: 'all'
                }
            },
            
            // ÊàøÈó¥ÈÖçÁΩÆ
            roomConfig: [
                { id: 1, name: 'ÂçßÂÆ§', icon: 'üõèÔ∏è' },
                { id: 2, name: 'Âé®Êàø', icon: 'üç≥' },
                { id: 3, name: 'ÂÆ¢ÂéÖ', icon: 'üõãÔ∏è' },
                { id: 4, name: 'Êµ¥ÂÆ§', icon: 'üöø' },
                { id: 5, name: '‰π¶Êàø', icon: 'üìö' },
                { id: 6, name: 'ÂÇ®ËóèÂÆ§', icon: 'üì¶' },
                { id: 7, name: 'Èò≥Âè∞', icon: 'üå∫' },
                { id: 8, name: 'Âú∞‰∏ãÂÆ§', icon: 'üî¶' }
            ],
            
            // Áâ©ÂìÅÈÖçÁΩÆ
            itemConfig: {
                // Ê∂àËÄóÂìÅ
                'cane': {
                    id: 'cane',
                    name: 'Â•∂Â•∂ÁöÑÊãêÊùñ',
                    icon: 'ü¶Ø',
                    description: 'ÊØè10ÁßØÂàÜË¢´Â•∂Â•∂ÊäìËµ∞ÂèØËé∑Âæó1‰∏™ÊãêÊùñÔºå‰ΩøÁî®Âêé‰∏ãÊ¨°Ë¢´ÊäìÂÖçÂèóÊçüÂ§±',
                    category: 'consumable',
                    rarity: 'common',
                    value: 10,
                    usable: true,
                    consumable: true,
                    stackable: true,
                    maxStack: 99
                },
                'protection': {
                    id: 'protection',
                    name: 'ÂÖç‰º§Âç°',
                    icon: 'üõ°Ô∏è',
                    description: 'ÂèØÊäµÊå°‰∏ÄÊ¨°Â•∂Â•∂ÁöÑÊäìÊçïÔºå‰ΩøÁî®Âêé‰∏ãÊ¨°Ë¢´ÊäìÂÖçÂèóÊçüÂ§±',
                    category: 'consumable',
                    rarity: 'rare',
                    value: 100,
                    usable: true,
                    consumable: true,
                    stackable: true,
                    maxStack: 10
                },
                'lucky_charm': {
                    id: 'lucky_charm',
                    name: 'Âπ∏ËøêÁ¨¶',
                    icon: 'üçÄ',
                    description: 'Â¢ûÂä†10%ÁöÑÂ≠òÊ¥ªÊ¶ÇÁéáÔºå‰ΩøÁî®Âêé‰∏ã‰∏ÄÂõûÂêàÁîüÊïà',
                    category: 'consumable',
                    rarity: 'epic',
                    value: 50,
                    usable: true,
                    consumable: true,
                    stackable: true,
                    maxStack: 5
                },
                'speed_boost': {
                    id: 'speed_boost',
                    name: 'Âä†ÈÄüËçØÊ∞¥',
                    icon: '‚ö°',
                    description: 'ÂáèÂ∞ë5ÁßíÊäïÊ≥®ÈîÅÂÆöÊó∂Èó¥Ôºå‰ΩøÁî®ÂêéÁ´ãÂç≥ÁîüÊïà',
                    category: 'consumable',
                    rarity: 'rare',
                    value: 30,
                    usable: true,
                    consumable: true,
                    stackable: true,
                    maxStack: 10
                },
                'double_reward': {
                    id: 'double_reward',
                    name: 'ÂèåÂÄçÂ•ñÂä±Âç°',
                    icon: 'üíé',
                    description: '‰∏ãÊ¨°Ëé∑ËÉúËé∑ÂæóÂèåÂÄçÂ•ñÂä±Ôºå‰ΩøÁî®Âêé‰∏ã‰∏ÄÂõûÂêàÁîüÊïà',
                    category: 'consumable',
                    rarity: 'legendary',
                    value: 200,
                    usable: true,
                    consumable: true,
                    stackable: true,
                    maxStack: 3
                },
                // Ë£ÖÂ§áÂìÅ
                'night_vision': {
                    id: 'night_vision',
                    name: 'Â§úËßÜ‰ª™',
                    icon: 'üëì',
                    description: 'ÊòæÁ§∫Â•∂Â•∂ÁöÑÁúüÂÆû‰ΩçÁΩÆÔºåÂ¢ûÂä†30%ÁöÑÂ≠òÊ¥ªÊ¶ÇÁéá',
                    category: 'equipment',
                    rarity: 'epic',
                    value: 150,
                    usable: true,
                    consumable: false,
                    stackable: false,
                    maxStack: 1
                },
                'stealth_boots': {
                    id: 'stealth_boots',
                    name: 'ÈöêË∫´Èù¥',
                    icon: 'üëü',
                    description: 'ÂáèÂ∞ë50%Ë¢´ÊäìÁöÑÊ¶ÇÁéáÔºåË£ÖÂ§áÂêéÊåÅÁª≠ÁîüÊïà',
                    category: 'equipment',
                    rarity: 'rare',
                    value: 80,
                    usable: true,
                    consumable: false,
                    stackable: false,
                    maxStack: 1
                },
                'lucky_amulet': {
                    id: 'lucky_amulet',
                    name: 'Âπ∏ËøêÊä§Ë∫´Á¨¶',
                    icon: 'üßø',
                    description: 'Â¢ûÂä†20%ÁöÑÂ≠òÊ¥ªÊ¶ÇÁéáÔºåË£ÖÂ§áÂêéÊåÅÁª≠ÁîüÊïà',
                    category: 'equipment',
                    rarity: 'rare',
                    value: 60,
                    usable: true,
                    consumable: false,
                    stackable: false,
                    maxStack: 1
                },
                // ÁâπÊÆäÁâ©ÂìÅ
                'grandma_photo': {
                    id: 'grandma_photo',
                    name: 'Â•∂Â•∂ÁöÑÁÖßÁâá',
                    icon: 'üì∑',
                    description: 'Á•ûÁßòÁöÑÂ•∂Â•∂ÁÖßÁâáÔºåÊçÆËØ¥ËÉΩÂ∏¶Êù•Â•ΩËøê',
                    category: 'special',
                    rarity: 'legendary',
                    value: 500,
                    usable: false,
                    consumable: false,
                    stackable: true,
                    maxStack: 1
                },
                'haunted_key': {
                    id: 'haunted_key',
                    name: 'ÈóπÈ¨ºÈí•Âåô',
                    icon: 'üóùÔ∏è',
                    description: 'ÂèØ‰ª•ÊâìÂºÄÁßòÂØÜÊàøÈó¥ÁöÑÈí•Âåô',
                    category: 'special',
                    rarity: 'epic',
                    value: 300,
                    usable: false,
                    consumable: false,
                    stackable: true,
                    maxStack: 3
                },
                // Ë¥ßÂ∏Å
                'mystery_box': {
                    id: 'mystery_box',
                    name: 'Á•ûÁßòÁõ≤Áõí',
                    icon: 'üéÅ',
                    description: 'ÂåÖÂê´ÈöèÊú∫ÈÅìÂÖ∑ÁöÑÁ•ûÁßòÁõ≤Áõí',
                    category: 'currency',
                    rarity: 'legendary',
                    value: 100,
                    usable: true,
                    consumable: true,
                    stackable: true,
                    maxStack: 99
                }
            },
            
            // ÂàùÂßãÂåñÊ∏∏Êàè
            init() {
                console.log('=== ÂàùÂßãÂåñÊÅêÊÄñÂ•∂Â•∂Ê∏∏Êàè ===');
                
                // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
                if (!this.checkLogin()) {
                    return;
                }
                
                // ÂàùÂßãÂåñÁî®Êà∑Êï∞ÊçÆ
                this.loadUserData();
                
                // ÂàùÂßãÂåñÊàøÈó¥
                this.initRooms();
                
                // ÂàùÂßãÂåñÂÖ∂‰ªñÂäüËÉΩ
                this.startGameTimer();
                this.updateLeaderboard();
                this.simulatePlayers();
                this.startWeatherEffect();
                
                // ÈöèÊú∫Èó™ÁîµÊïàÊûú
                setInterval(() => {
                    if (Math.random() < 0.1) {
                        const lightning = document.getElementById('lightning');
                        lightning.classList.add('flash');
                        setTimeout(() => {
                            lightning.classList.remove('flash');
                        }, 300);
                    }
                }, 5000);
                
                console.log('Ê∏∏ÊàèÂàùÂßãÂåñÂÆåÊàê');
            },
            
            // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
            checkLogin() {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const currentUser = localStorage.getItem('currentUser');
                
                if (!isLoggedIn || !currentUser) {
                    console.log('Áî®Êà∑Êú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢');
                    window.location.href = 'login.html';
                    return false;
                }
                
                return true;
            },
            
            // Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆ
            loadUserData() {
                const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
                this.gameState.userPoints = user.points || 1000;
                this.gameState.userCanes = user.canes || 0;
                
                // Âä†ËΩΩ‰ªªÂä°ËøõÂ∫¶
                const savedTasks = localStorage.getItem('grandmaDailyTasks');
                if (savedTasks) {
                    this.gameState.dailyTasks = JSON.parse(savedTasks);
                }
                
                // Âä†ËΩΩÁßØÂàÜÂéÜÂè≤
                const savedHistory = localStorage.getItem('grandmaPointsHistory');
                if (savedHistory) {
                    this.gameState.pointsHistory = JSON.parse(savedHistory);
                }
                
                // Âä†ËΩΩËÉåÂåÖÊï∞ÊçÆ
                const savedBackpack = localStorage.getItem('grandmaBackpack');
                if (savedBackpack) {
                    this.gameState.backpack = JSON.parse(savedBackpack);
                }
                
                // ÂàùÂßãÂåñÈªòËÆ§Áâ©ÂìÅ
                this.initializeDefaultItems();
                
                // ËÆ°ÁÆóÊÄªÊäïÂÖ•ÂíåÊÄªÊî∂ÂÖ•
                this.calculatePointsStats();
                
                // Êõ¥Êñ∞UI
                this.updateUserInfo();
                this.updatePointsDisplay();
                
                console.log('Âä†ËΩΩÁî®Êà∑Êï∞ÊçÆÂÆåÊàê');
            },
            
            // ÂàùÂßãÂåñÈªòËÆ§Áâ©ÂìÅ
            initializeDefaultItems() {
                // Â¶ÇÊûúËÉåÂåÖ‰∏∫Á©∫ÔºåÊ∑ªÂä†‰∏Ä‰∫õÈªòËÆ§Áâ©ÂìÅ
                if (this.gameState.backpack.items.length === 0) {
                    // Ê∑ªÂä†ÂàùÂßãÊãêÊùñ
                    if (this.gameState.userCanes > 0) {
                        this.gameState.backpack.items.push({
                            ...this.itemConfig['cane'],
                            count: this.gameState.userCanes
                        });
                    }
                    
                    // Ê∑ªÂä†ÂàùÂßãÁ•ûÁßòÁõ≤Áõí
                    this.gameState.backpack.items.push({
                        ...this.itemConfig['mystery_box'],
                        count: 1
                    });
                }
            },
            
            // ‰øùÂ≠òÁî®Êà∑Êï∞ÊçÆ
            saveUserData() {
                const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
                user.points = this.gameState.userPoints;
                user.canes = this.gameState.userCanes;
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                // ‰øùÂ≠ò‰ªªÂä°ËøõÂ∫¶
                localStorage.setItem('grandmaDailyTasks', JSON.stringify(this.gameState.dailyTasks));
                
                // ‰øùÂ≠òÁßØÂàÜÂéÜÂè≤
                localStorage.setItem('grandmaPointsHistory', JSON.stringify(this.gameState.pointsHistory));
                
                // ‰øùÂ≠òËÉåÂåÖÊï∞ÊçÆ
                localStorage.setItem('grandmaBackpack', JSON.stringify(this.gameState.backpack));
                
                // ÂêåÊó∂Êõ¥Êñ∞ÁßØÂàÜÁ≥ªÁªü
                if (window.pointsSystem) {
                    window.pointsSystem.currentUser = user;
                    window.pointsSystem.updatePoints(0, 'ÂêåÊ≠•ÁßØÂàÜ', { sync: true });
                }
                
                console.log('‰øùÂ≠òÁî®Êà∑Êï∞ÊçÆÂÆåÊàê');
            },
            
            // ËÆ°ÁÆóÁßØÂàÜÁªüËÆ°
            calculatePointsStats() {
                this.gameState.totalInvested = 0;
                this.gameState.totalEarned = 0;
                
                this.gameState.pointsHistory.forEach(record => {
                    if (record.type === 'invest') {
                        this.gameState.totalInvested += record.amount;
                    } else if (record.type === 'earn') {
                        this.gameState.totalEarned += record.amount;
                    }
                });
            },
            
            // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
            updateUserInfo() {
                const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const userName = document.getElementById('userName');
                const userCanes = document.getElementById('userCanes');
                
                if (userName && userCanes) {
                    userName.textContent = user.name;
                    userCanes.textContent = this.gameState.userCanes;
                }
            },
            
            // Êõ¥Êñ∞ÁßØÂàÜÊòæÁ§∫
            updatePointsDisplay() {
                console.log('Êõ¥Êñ∞ÁßØÂàÜÊòæÁ§∫:', this.gameState.userPoints);
                
                // Êõ¥Êñ∞ÊâÄÊúâÊòæÁ§∫ÁßØÂàÜÁöÑÂÖÉÁ¥†
                const pointsElements = document.querySelectorAll('[id*="userPoints"], [class*="user-points"]');
                pointsElements.forEach(element => {
                    if (element.tagName === 'SPAN') {
                        element.textContent = this.gameState.userPoints;
                    } else if (element.tagName === 'DIV') {
                        const span = element.querySelector('span');
                        if (span) {
                            span.textContent = this.gameState.userPoints;
                        } else {
                            element.textContent = `üí∞ ${this.gameState.userPoints}`;
                        }
                    }
                });
                
                // Êõ¥Êñ∞ÁâπÂÆöÁöÑÁßØÂàÜÊòæÁ§∫
                const specificElements = [
                    'userPoints',
                    'prizePoolAmount',
                    'prizePoolDisplay',
                    'totalBets'
                ];
                
                specificElements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = this.gameState.userPoints;
                    }
                });
            },
            
            // ÂàùÂßãÂåñÊàøÈó¥
            initRooms() {
                const container = document.getElementById('roomsContainer');
                container.innerHTML = '';
                
                this.gameState.rooms = [];
                
                this.roomConfig.forEach(config => {
                    const room = {
                        ...config,
                        danger: false,
                        players: 0,
                        totalBet: 0
                    };
                    
                    this.gameState.rooms.push(room);
                    
                    const roomElement = this.createRoomElement(room);
                    container.appendChild(roomElement);
                });
            },
            
            // ÂàõÂª∫ÊàøÈó¥ÂÖÉÁ¥†
            createRoomElement(room) {
                const div = document.createElement('div');
                div.className = 'room';
                div.id = `room-${room.id}`;
                div.onclick = () => this.selectRoom(room.id);
                
                div.innerHTML = `
                    <div class="room-icon">${room.icon}</div>
                    <div class="room-name">${room.name}</div>
                    <div class="room-pool">Â•ñÊ±†: üí∞<span class="room-pool-amount">0</span></div>
                    <div class="room-players">Áé©ÂÆ∂: <span class="room-players-count">0</span></div>
                    <div class="room-bet" style="display: none;" id="room-bet-${room.id}">üí∞<span class="room-bet-amount">0</span></div>
                `;
                
                return div;
            },
            
            // ÈÄâÊã©ÊàøÈó¥
            selectRoom(roomId) {
                if (this.gameState.isLocked || this.gameState.roundEnded) {
                    this.showMessage('ÊäïÊ≥®Â∑≤ÈîÅÂÆöÔºåËØ∑Á≠âÂæÖ‰∏ã‰∏ÄÂõûÂêà', 'error');
                    return;
                }
                
                // Â¶ÇÊûúÂ∑≤ÊúâÊäïÊ≥®ÔºåËΩ¨ÁßªÂà∞Êñ∞ÊàøÈó¥
                if (this.gameState.betAmount > 0 && this.gameState.selectedRoom) {
                    // ÁßªÈô§ÊóßÊàøÈó¥ÁöÑÊäïÊ≥®ËßíÊ†á
                    const oldBetElement = document.getElementById(`room-bet-${this.gameState.selectedRoom}`);
                    if (oldBetElement) {
                        oldBetElement.style.display = 'none';
                    }
                    
                    const oldRoom = this.gameState.rooms.find(r => r.id === this.gameState.selectedRoom);
                    oldRoom.totalBet -= this.gameState.betAmount;
                    oldRoom.players--;
                    this.updateRoomDisplay(oldRoom);
                }
                
                // ÁßªÈô§‰πãÂâçÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
                document.querySelectorAll('.room').forEach(room => {
                    room.classList.remove('selected');
                });
                
                // Ê∑ªÂä†Êñ∞ÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
                const selectedRoom = document.getElementById(`room-${roomId}`);
                selectedRoom.classList.add('selected');
                
                this.gameState.selectedRoom = roomId;
                
                // Â¶ÇÊûúÂ∑≤ÊúâÊäïÊ≥®ÔºåÊõ¥Êñ∞Êñ∞ÊàøÈó¥
                if (this.gameState.betAmount > 0) {
                    const newRoom = this.gameState.rooms.find(r => r.id === roomId);
                    newRoom.totalBet += this.gameState.betAmount;
                    newRoom.players++;
                    this.updateRoomDisplay(newRoom);
                    
                    // ÊòæÁ§∫ÊäïÊ≥®‰ø°ÊÅØ
                    const betElement = document.getElementById(`room-bet-${roomId}`);
                    const betAmountDisplay = betElement.querySelector('.room-bet-amount');
                    betElement.style.display = 'block';
                    betAmountDisplay.textContent = this.gameState.betAmount;
                }
            },
            
            // Êõ¥Êñ∞ÊàøÈó¥ÊòæÁ§∫
            updateRoomDisplay(room) {
                const roomElement = document.getElementById(`room-${room.id}`);
                roomElement.querySelector('.room-pool-amount').textContent = room.totalBet;
                roomElement.querySelector('.room-players-count').textContent = room.players;
            },
            
            // Âø´ÈÄüÊäïÊ≥®
            quickBet(amount) {
                document.getElementById('betAmount').value = amount;
            },
            
            // ÊäïÊ≥®
            placeBet() {
                console.log('=== ÂºÄÂßãÊäïÊ≥® ===');
                
                if (this.gameState.isLocked || this.gameState.roundEnded) {
                    this.showMessage('ÊäïÊ≥®Â∑≤ÈîÅÂÆöÔºåËØ∑Á≠âÂæÖ‰∏ã‰∏ÄÂõûÂêà', 'error');
                    return;
                }
                
                if (!this.gameState.selectedRoom) {
                    this.showMessage('ËØ∑ÂÖàÈÄâÊã©ÊàøÈó¥', 'error');
                    return;
                }
                
                const betInput = document.getElementById('betAmount');
                const additionalAmount = parseInt(betInput.value);
                
                if (!additionalAmount || additionalAmount < 1) {
                    this.showMessage('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊäïÊ≥®ÈáëÈ¢ù', 'error');
                    return;
                }
                
                // Ê£ÄÊü•ÁßØÂàÜÊòØÂê¶Ë∂≥Â§ü
                if (this.gameState.userPoints < additionalAmount) {
                    this.showMessage('ÁßØÂàÜ‰∏çË∂≥ÔºÅ', 'error');
                    return;
                }
                
                console.log('ÊäïÊ≥®ÈáëÈ¢ù:', additionalAmount);
                console.log('ÂΩìÂâçÁßØÂàÜ:', this.gameState.userPoints);
                
                // Êâ£Èô§ÁßØÂàÜ
                this.gameState.userPoints -= additionalAmount;
                this.gameState.betAmount += additionalAmount;
                this.gameState.totalBets += additionalAmount;
                
                // ËÆ∞ÂΩïÁßØÂàÜÂéÜÂè≤
                this.addPointsHistory('invest', additionalAmount, 'Ê∏∏ÊàèÊäïÊ≥®');
                
                // 5%ÊâãÁª≠Ë¥πÔºå3%ËøõÂÖ•Â•ñÈáëÊ±†
                const fee = Math.floor(additionalAmount * 0.05);
                const poolContribution = Math.floor(additionalAmount * 0.03);
                this.gameState.prizePool += poolContribution;
                
                // Êõ¥Êñ∞ÊàøÈó¥ÊäïÊ≥®
                const room = this.gameState.rooms.find(r => r.id === this.gameState.selectedRoom);
                room.totalBet += additionalAmount;
                room.players++;
                
                // ÊòæÁ§∫ÊäïÊ≥®‰ø°ÊÅØ
                const roomElement = document.getElementById(`room-${this.gameState.selectedRoom}`);
                const betElement = document.getElementById(`room-bet-${this.gameState.selectedRoom}`);
                const betAmountDisplay = betElement.querySelector('.room-bet-amount');
                betElement.style.display = 'block';
                betAmountDisplay.textContent = this.gameState.betAmount;
                
                // Á´ãÂç≥Êõ¥Êñ∞UI
                this.updatePointsDisplay();
                this.saveUserData();
                
                // ÊòæÁ§∫ÈáëÈ¢ùÊ≥®ÂÖ•Âä®Áîª
                this.showMoneyInjection(additionalAmount);
                
                this.showMessage(`ÊàêÂäüÊäïÊ≥® ${additionalAmount} ÁßØÂàÜÂà∞${room.name}ÔºåÊÄªÊäïÊ≥®: ${this.gameState.betAmount}`, 'success');
                
                // Ê∏ÖÁ©∫ÊäïÊ≥®ËæìÂÖ•
                betInput.value = '';
                
                // Êõ¥Êñ∞ÁªüËÆ°
                this.updateStats();
                
                // Êõ¥Êñ∞‰ªªÂä°ËøõÂ∫¶
                this.updateTaskProgress('task1', additionalAmount);
                
                console.log('ÊäïÊ≥®ÂÆåÊàêÔºåÂâ©‰ΩôÁßØÂàÜ:', this.gameState.userPoints);
            },
            
            // ÊòæÁ§∫ÈáëÈ¢ùÊ≥®ÂÖ•Âä®Áîª
            showMoneyInjection(amount) {
                const selectedRoom = document.getElementById(`room-${this.gameState.selectedRoom}`);
                const injection = document.createElement('div');
                injection.className = 'money-injection';
                injection.textContent = `+${amount}`;
                injection.style.cssText = `
                    position: absolute;
                    font-size: 1.2rem;
                    font-weight: 700;
                    color: #00ff00;
                    pointer-events: none;
                    animation: moneyFloat 2s ease-out forwards;
                    z-index: 6;
                    text-shadow: 0 2px 10px rgba(0, 255, 0, 0.8);
                `;
                injection.style.left = '50%';
                injection.style.top = '50%';
                injection.style.transform = 'translate(-50%, -50%)';
                
                selectedRoom.appendChild(injection);
                
                // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§
                setTimeout(() => {
                    if (injection.parentNode) {
                        injection.parentNode.removeChild(injection);
                    }
                }, 2000);
            },
            
            // Ê∏∏ÊàèËÆ°Êó∂Âô®
            startGameTimer() {
                setInterval(() => {
                    if (this.gameState.roundEnded) return;
                    
                    this.gameState.timeLeft--;
                    
                    const timerDisplay = document.getElementById('timerDisplay');
                    const timerStatus = document.getElementById('timerStatus');
                    
                    timerDisplay.textContent = this.gameState.timeLeft;
                    
                    if (this.gameState.timeLeft <= 5) {
                        timerDisplay.classList.add('warning');
                        timerStatus.textContent = 'Âç≥Â∞ÜÂºÄÂ•ñ';
                        this.gameState.isLocked = true;
                    } else if (this.gameState.timeLeft <= 25) {
                        timerDisplay.classList.remove('warning');
                        timerStatus.textContent = 'ÊäïÊ≥®Êó∂Èó¥';
                    } else {
                        timerStatus.textContent = 'ÂáÜÂ§áÈò∂ÊÆµ';
                    }
                    
                    // Êó∂Èó¥Âà∞ÔºåÂºÄÂ•ñ
                    if (this.gameState.timeLeft <= 0) {
                        this.endRound();
                    }
                }, 1000);
            },
            
            // ÁªìÊùüÂõûÂêà
            endRound() {
                if (this.gameState.roundEnded) return;
                
                this.gameState.roundEnded = true;
                
                // ÈöèÊú∫ÈÄâÊã©1-7‰∏™ÊàøÈó¥
                const roomCount = Math.floor(Math.random() * 7) + 1;
                const availableRooms = [...Array(8).keys()].map(i => i + 1);
                let dangerRooms = [];
                
                // ÈöèÊú∫ÈÄâÊã©ÊàøÈó¥
                for (let i = 0; i < roomCount; i++) {
                    const randomIndex = Math.floor(Math.random() * availableRooms.length);
                    dangerRooms.push(availableRooms[randomIndex]);
                    availableRooms.splice(randomIndex, 1);
                }
                
                // Êõ¥Êñ∞ÊàøÈó¥Áä∂ÊÄÅ
                this.gameState.rooms.forEach(room => {
                    const roomElement = document.getElementById(`room-${room.id}`);
                    roomElement.classList.remove('danger', 'safe');
                    
                    if (dangerRooms.includes(room.id)) {
                        roomElement.classList.add('danger');
                        room.danger = true;
                    } else {
                        roomElement.classList.add('safe');
                        room.danger = false;
                    }
                });
                
                // ËÆ∞ÂΩïÂéÜÂè≤
                const historyRecord = {
                    round: this.gameState.currentRound,
                    mode: 'ÈöèÊú∫',
                    rooms: dangerRooms.map(id => this.roomConfig.find(r => r.id === id).name),
                    timestamp: new Date()
                };
                
                this.gameState.history.unshift(historyRecord);
                if (this.gameState.history.length > 10) {
                    this.gameState.history.pop();
                }
                
                this.updateHistory();
                
                // ÁªìÁÆóÊäïÊ≥®
                setTimeout(() => {
                    this.settleBets(dangerRooms);
                }, 2000);
            },
            
            // ÁªìÁÆóÊäïÊ≥® - ÂÆåÊï¥‰øÆÂ§çÁâà
            settleBets(dangerRooms) {
                console.log('=== ÂºÄÂßãÁªìÁÆóÊäïÊ≥® ===');
                console.log('Âç±Èô©ÊàøÈó¥:', dangerRooms);
                console.log('Áî®Êà∑ÊäïÊ≥®ÈáëÈ¢ù:', this.gameState.betAmount);
                console.log('Áî®Êà∑ÈÄâÊã©ÊàøÈó¥:', this.gameState.selectedRoom);
                
                // ËÆ°ÁÆóÊâÄÊúâÂÆâÂÖ®ÊàøÈó¥ÁöÑÊÄªÊäïÊ≥®
                const totalSafeBets = this.gameState.rooms
                    .filter(room => !dangerRooms.includes(room.id))
                    .reduce((sum, room) => sum + room.totalBet, 0);
                
                // ËÆ°ÁÆóÊâÄÊúâÂç±Èô©ÊàøÈó¥ÁöÑÊÄªÊäïÊ≥®
                const totalDangerBets = this.gameState.rooms
                    .filter(room => dangerRooms.includes(room.id))
                    .reduce((sum, room) => sum + room.totalBet, 0);
                
                console.log('Â≠òÊ¥ªÊàøÈó¥ÊÄªÊäïÊ≥®:', totalSafeBets);
                console.log('Ë¢´ÊäìÊàøÈó¥ÊÄªÊäïÊ≥®:', totalDangerBets);
                
                // Â¶ÇÊûúÊ≤°ÊúâÊäïÊ≥®ÔºåÁõ¥Êé•ÈáçÁΩÆ
                if (!this.gameState.selectedRoom || this.gameState.betAmount <= 0) {
                    console.log('Áî®Êà∑Êú™ÊäïÊ≥®ÔºåË∑≥ËøáÁªìÁÆó');
                    setTimeout(() => {
                        this.resetRound();
                    }, 3000);
                    return;
                }
                
                const isWin = !dangerRooms.includes(this.gameState.selectedRoom);
                const room = this.gameState.rooms.find(r => r.id === this.gameState.selectedRoom);
                
                console.log('Áî®Êà∑ÊòØÂê¶Â≠òÊ¥ª:', isWin);
                console.log('ÊàøÈó¥‰ø°ÊÅØ:', room);
                
                if (isWin) {
                    // Áî®Êà∑Â≠òÊ¥ªÔºåËÆ°ÁÆóÊî∂Áõä
                    if (totalSafeBets > 0) {
                        // ËÆ°ÁÆóÁî®Êà∑ÊäïÊ≥®ÊØî‰æã
                        const userBetRatio = room.totalBet / totalSafeBets;
                        
                        // ËÆ°ÁÆóÂèØÁìúÂàÜÁöÑÊÄªÈáëÈ¢ùÔºàË¢´ÊäìÊàøÈó¥ÁöÑ95%Ôºâ
                        const totalDangerPool = Math.floor(totalDangerBets * 0.95);
                        const userEarnings = Math.floor(totalDangerPool * userBetRatio);
                        
                        console.log('Áî®Êà∑ÊäïÊ≥®ÊØî‰æã:', userBetRatio);
                        console.log('ÂèØÁìúÂàÜÈáëÈ¢ù:', totalDangerPool);
                        console.log('Áî®Êà∑Êî∂Áõä:', userEarnings);
                        
                        // ËøîËøòÊú¨ÈáëÂπ∂Áªô‰∫àÊî∂Áõä
                        const totalReturn = this.gameState.betAmount + userEarnings;
                        
                        console.log('ËøîËøòÊú¨Èáë:', this.gameState.betAmount);
                        console.log('ÁìúÂàÜÊî∂Áõä:', userEarnings);
                        console.log('ÊÄªËøîËøò:', totalReturn);
                        
                        // Êõ¥Êñ∞Áî®Êà∑ÁßØÂàÜ
                        this.gameState.userPoints += totalReturn;
                        this.gameState.winStreak++;
                        
                        // ËÆ∞ÂΩïÁßØÂàÜÂéÜÂè≤
                        this.addPointsHistory('earn', totalReturn, 'Ê∏∏ÊàèËé∑ËÉú');
                        
                        // Á´ãÂç≥Êõ¥Êñ∞UI
                        this.updatePointsDisplay();
                        this.saveUserData();
                        
                        this.showMessage(`üéâ ÊÅ≠ÂñúÂ≠òÊ¥ªÔºÅËøîËøòÊú¨Èáë ${this.gameState.betAmount}ÔºåÁìúÂàÜÊî∂Áõä${userEarnings} ÁßØÂàÜ`, 'success');
                        
                        // ÊòæÁ§∫ÁªìÁÆóÈ°µÈù¢
                        this.showSettlementPage(true, room, totalReturn, userEarnings);
                    } else {
                        // Â¶ÇÊûúÊ≤°ÊúâÂÖ∂‰ªñÂÆâÂÖ®ÊäïÊ≥®ÔºåÂè™ËøîËøòÊú¨Èáë
                        this.gameState.userPoints += this.gameState.betAmount;
                        this.gameState.winStreak++;
                        
                        // ËÆ∞ÂΩïÁßØÂàÜÂéÜÂè≤
                        this.addPointsHistory('earn', this.gameState.betAmount, 'Ê∏∏ÊàèËé∑ËÉú');
                        
                        this.updatePointsDisplay();
                        this.saveUserData();
                        
                        this.showMessage(`üéâ ÊÅ≠ÂñúÂ≠òÊ¥ªÔºÅËøîËøòÊú¨Èáë ${this.gameState.betAmount}`, 'success');
                        
                        // ÊòæÁ§∫ÁªìÁÆóÈ°µÈù¢
                        this.showSettlementPage(true, room, this.gameState.betAmount, 0);
                    }
                } else {
                    // Áî®Êà∑Ë¢´Êäì
                    if (!this.gameState.hasProtection) {
                        console.log('Áî®Êà∑Ë¢´ÊäìÔºåÊçüÂ§±ÁßØÂàÜ:', this.gameState.betAmount);
                        
                        this.gameState.winStreak = 0;
                        
                        // ËÆ∞ÂΩïÁßØÂàÜÂéÜÂè≤
                        this.addPointsHistory('invest', this.gameState.betAmount, 'Ê∏∏ÊàèÂ§±Ë¥•');
                        
                        this.showMessage(`üò¢ ÂæàÈÅóÊÜæÔºåÊçüÂ§± ${this.gameState.betAmount} ÁßØÂàÜ`, 'error');
                        
                        // ÊòæÁ§∫ÁªìÁÆóÈ°µÈù¢
                        this.showSettlementPage(false, room, this.gameState.betAmount, 0);
                        
                        // ÊéâËêΩÊãêÊùñ
                        this.dropCanes(this.gameState.betAmount, totalDangerBets);
                        
                        // Êõ¥Êñ∞‰ªªÂä°ËøõÂ∫¶
                        this.updateTaskProgress('task2', this.gameState.betAmount);
                    } else {
                        this.showMessage(`üõ°Ô∏è ÂÖç‰º§Âç°ÁîüÊïàÔºåÂÖçÂèóÊçüÂ§±`, 'info');
                        this.gameState.hasProtection = false;
                        
                        // ÊòæÁ§∫ÁªìÁÆóÈ°µÈù¢
                        this.showSettlementPage(false, room, 0, 0);
                    }
                }
                
                // Êõ¥Êñ∞ÊéíË°åÊ¶ú
                this.updateLeaderboard();
                
                // Âª∂ËøüÈáçÁΩÆÂõûÂêà
                setTimeout(() => {
                    this.resetRound();
                }, 5000);
            },
            
            // ÊéâËêΩÊãêÊùñ
            dropCanes(userBet, totalDangerBets) {
                // ËÆ°ÁÆóÊÄªÊãêÊùñÊï∞ÈáèÔºöÊØè10ÁßØÂàÜË¢´Â•∂Â•∂ÊäìËµ∞ÂèØËé∑Âæó1‰∏™ÊãêÊùñ
                const totalCanes = Math.floor(totalDangerBets / 10);
                
                if (totalCanes > 0) {
                    // ËÆ°ÁÆóÁî®Êà∑Â∫îÂæóÊãêÊùñÊï∞Èáè
                    const userCanes = Math.floor(userBet / 10);
                    
                    if (userCanes > 0) {
                        this.gameState.userCanes += userCanes;
                        this.updateUserInfo();
                        this.saveUserData();
                        
                        this.showMessage(`ü¶Ø Ëé∑Âæó ${userCanes} ‰∏™ÊãêÊùñ`, 'success');
                    }
                }
            },
            
            // ÊòæÁ§∫ÁªìÁÆóÈ°µÈù¢
            showSettlementPage(isWin, room, betAmount, earnings) {
                console.log('=== ÊòæÁ§∫ÁªìÁÆóÈ°µÈù¢ ===');
                console.log('ÊòØÂê¶Ëé∑ËÉú:', isWin);
                console.log('ÊàøÈó¥:', room);
                console.log('ÊäïÊ≥®ÈáëÈ¢ù:', betAmount);
                console.log('Êî∂Áõä:', earnings);
                
                // ÁßªÈô§Áé∞ÊúâÁªìÁÆóÈ°µÈù¢
                const existingSettlement = document.querySelector('.settlement-overlay');
                if (existingSettlement) {
                    existingSettlement.remove();
                }
                
                // ÂàõÂª∫ÁªìÁÆóÈ°µÈù¢ÂÆπÂô®
                const settlementOverlay = document.createElement('div');
                settlementOverlay.className = 'settlement-overlay';
                
                // ÂàõÂª∫ÁªìÁÆóÈ°µÈù¢
                const settlementPage = document.createElement('div');
                settlementPage.className = 'settlement-page';
                
                const roomName = room.name;
                const roomIcon = room.icon;
                
                settlementPage.innerHTML = `
                    <div class="settlement-header">
                        <div class="settlement-title">üéÆ Ê∏∏ÊàèÁªìÁÆó</div>
                        <div class="settlement-round">Á¨¨${this.gameState.currentRound}ÂõûÂêà</div>
                        <button class="settlement-close" onclick="GrandmaGame.closeSettlementPage()">‚úï</button>
                    </div>
                    
                    <div class="settlement-result ${isWin ? 'win' : 'lose'}">
                        ${isWin ? 'üéâ' : 'üò±'}
                    </div>
                    
                    <div class="settlement-status">
                        ${isWin ? '‰Ω†ÊàêÂäüË∫≤ÈÅø‰∫ÜÂ•∂Â•∂ÔºÅ' : '‰Ω†Ë¢´Â•∂Â•∂ÊäìÂà∞‰∫ÜÔºÅ'}
                    </div>
                    
                    <div class="settlement-location">
                        <div class="settlement-location-title">üìç Âú∞ÁÇπ</div>
                        <div class="settlement-location-name">${roomIcon}${roomName}</div>
                    </div>
                    
                    <div class="settlement-details">
                        <div class="settlement-details-row">
                            <div class="settlement-details-label">ÊäïÊ≥®ÈáëÈ¢ù</div>
                            <div class="settlement-details-value">üí∞ ${this.gameState.betAmount}</div>
                        </div>
                        ${isWin ? `
                            <div class="settlement-details-row">
                                <div class="settlement-details-label">ËøîËøòÊú¨Èáë</div>
                                <div class="settlement-details-value positive">üí∞ ${this.gameState.betAmount}</div>
                            </div>
                            <div class="settlement-details-row">
                                <div class="settlement-details-label">ÁìúÂàÜÊî∂Áõä</div>
                                <div class="settlement-details-value positive">üí∞ ${earnings}</div>
                            </div>
                        ` : `
                            <div class="settlement-details-row">
                                <div class="settlement-details-label">ÊçüÂ§±ÈáëÈ¢ù</div>
                                <div class="settlement-details-value negative">üí∞ ${this.gameState.betAmount}</div>
                            </div>
                        `}
                        <div class="settlement-details-row">
                            <div class="settlement-details-label">ÊâãÁª≠Ë¥π</div>
                            <div class="settlement-details-value">üí∞ ${Math.floor(this.gameState.betAmount * 0.05)}</div>
                        </div>
                    </div>
                    
                    <div class="settlement-total ${isWin ? 'win' : 'lose'}">
                        ${isWin ? 
                            `ÊÄªÊî∂ÁõäÔºöüí∞ ${earnings}` : 
                            `ÊÄªÊçüÂ§±Ôºöüí∞ ${this.gameState.betAmount}`
                        }
                    </div>
                    
                    <div class="settlement-buttons">
                        <button class="settlement-btn secondary" onclick="GrandmaGame.closeSettlementPage()">ÁªßÁª≠Ê∏∏Êàè</button>
                        <button class="settlement-btn" onclick="GrandmaGame.confirmSettlementPage()">Á°ÆËÆ§</button>
                    </div>
                `;
                
                settlementOverlay.appendChild(settlementPage);
                document.body.appendChild(settlementOverlay);
                
                console.log('ÁªìÁÆóÈ°µÈù¢Â∑≤ÊòæÁ§∫');
            },
            
            // ÂÖ≥Èó≠ÁªìÁÆóÈ°µÈù¢
            closeSettlementPage() {
                const settlementOverlay = document.querySelector('.settlement-overlay');
                if (settlementOverlay) {
                    settlementOverlay.remove();
                    console.log('ÁªìÁÆóÈ°µÈù¢Â∑≤ÂÖ≥Èó≠');
                }
            },
            
            // Á°ÆËÆ§ÁªìÁÆó
            confirmSettlementPage() {
                this.closeSettlementPage();
                this.resetRound();
            },
            
            // ÈáçÁΩÆÂõûÂêà
            resetRound() {
                this.gameState.currentRound++;
                this.gameState.timeLeft = 30;
                this.gameState.isLocked = false;
                this.gameState.betAmount = 0;
                this.gameState.selectedRoom = null;
                this.gameState.roundEnded = false;
                
                // ÈáçÁΩÆÊàøÈó¥Áä∂ÊÄÅ
                this.gameState.rooms.forEach(room => {
                    room.danger = false;
                    room.totalBet = 0;
                    room.players = 0;
                    this.updateRoomDisplay(room);
                });
                
                // ÈáçÁΩÆÊàøÈó¥ÊòæÁ§∫
                document.querySelectorAll('.room').forEach(room => {
                    room.classList.remove('selected', 'danger', 'safe');
                    const betDisplay = room.querySelector('.room-bet');
                    if (betDisplay) {
                        betDisplay.style.display = 'none';
                    }
                });
                
                // Êõ¥Êñ∞ÁªüËÆ°
                document.getElementById('currentRound').textContent = this.gameState.currentRound;
                this.updateStats();
                
                console.log('ÂõûÂêàÈáçÁΩÆÂÆåÊàê');
            },
            
            // Êõ¥Êñ∞ÁªüËÆ°
            updateStats() {
                document.getElementById('prizePoolAmount').textContent = this.gameState.prizePool;
                document.getElementById('prizePoolDisplay').textContent = this.gameState.prizePool;
                document.getElementById('totalBets').textContent = this.gameState.totalBets;
                document.getElementById('streakNumber').textContent = this.gameState.winStreak;
            },
            
            // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩï
            updateHistory() {
                const container = document.getElementById('historyList');
                
                if (this.gameState.history.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #666;">ÊöÇÊó†ËÆ∞ÂΩï</div>';
                    return;
                }
                
                container.innerHTML = this.gameState.history.map(record => `
                    <div class="history-item">
                        <div class="history-round">${record.round}Êúü</div>
                        <div class="history-rooms">
                            ${record.rooms.join('Ôºå')}
                            <div class="history-mode">${record.mode}Ê®°Âºè</div>
                        </div>
                    </div>
                `).join('');
            },
            
            // Êõ¥Êñ∞ÊéíË°åÊ¶ú
            updateLeaderboard() {
                // Ê®°ÊãüÁúüÂÆûÁé©ÂÆ∂Êï∞ÊçÆ
                const realPlayers = [
                    { name: 'Â§©ÂàõÁé©ÂÆ∂1', value: 3200, rank: 1 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂2', value: 2100, rank: 2 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂3', value: 1500, rank: 3 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂4', value: 900, rank: 4 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂5', value: 750, rank: 5 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂6', value: 600, rank: 6 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂7', value: 550, rank: 7 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂8', value: 520, rank: 8 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂9', value: 510, rank: 9 },
                    { name: 'Â§©ÂàõÁé©ÂÆ∂10', value: 500, rank: 10 }
                ];
                
                this.gameState.leaderboard.bet = realPlayers;
                
                this.gameState.leaderboard.streak = [
                    { name: 'ËøûËÉúÁéã1', value: 15, rank: 1 },
                    { name: 'ËøûËÉúÁéã2', value: 12, rank: 2 },
                    { name: 'ËøûËÉúÁéã3', value: 10, rank: 3 },
                    { name: 'ËøûËÉúÁéã4', value: 8, rank: 4 },
                    { name: 'ËøûËÉúÁéã5', value: 6, rank: 5 }
                ];
                
                this.displayLeaderboard('bet');
            },
            
            // ÊòæÁ§∫ÊéíË°åÊ¶ú
            displayLeaderboard(type) {
                const container = document.getElementById('leaderboardList');
                const data = this.gameState.leaderboard[type];
                
                container.innerHTML = data.map((player, index) => {
                    let rankClass = '';
                    if (index === 0) rankClass = 'gold';
                    else if (index === 1) rankClass = 'silver';
                    else if (index === 2) rankClass = 'bronze';
                    
                    return `
                        <div class="leaderboard-item">
                            <div class="leaderboard-rank ${rankClass}">${player.rank}</div>
                            <div class="leaderboard-name">${player.name}</div>
                            <div class="leaderboard-value">${type === 'bet' ? 'üí∞' : 'üî•'}${player.value}</div>
                        </div>
                    `;
                }).join('');
            },
            
            // ÂàáÊç¢ÊéíË°åÊ¶ú
            switchLeaderboard(type) {
                // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
                document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                event.target.classList.add('active');
                
                // ÊòæÁ§∫ÂØπÂ∫îÊéíË°åÊ¶ú
                this.displayLeaderboard(type);
            },
            
            // Ê®°ÊãüÁé©ÂÆ∂
            simulatePlayers() {
                setInterval(() => {
                    if (!this.gameState.isLocked && !this.gameState.roundEnded) {
                        // ÈöèÊú∫Ê∑ªÂä†‰∫∫Êú∫ÊäïÊ≥®
                        const botCount = Math.floor(Math.random() * 5) + 1;
                        
                        for (let i = 0; i < botCount; i++) {
                            const roomId = Math.floor(Math.random() * 8) + 1;
                            const betAmount = Math.floor(Math.random() * 5) + 1; // 1-5ÁßØÂàÜÈöèÊú∫
                            
                            const room = this.gameState.rooms.find(r => r.id === roomId);
                            room.totalBet += betAmount;
                            room.players++;
                            this.updateRoomDisplay(room);
                            
                            // Ê∑ªÂä†‰∫∫Êú∫ÊäïÊ≥®ËßíÊ†á
                            const betElement = document.getElementById(`room-bet-${roomId}`);
                            if (betElement) {
                                betElement.style.display = 'block';
                                betElement.querySelector('.room-bet-amount').textContent = betAmount;
                            }
                        }
                        
                        // Êõ¥Êñ∞Âú®Á∫øÁé©ÂÆ∂Êï∞
                        const onlineCount = Math.floor(Math.random() * 50) + 20;
                        document.getElementById('onlinePlayers').textContent = onlineCount;
                    }
                }, 3000);
            },
            
            // ÊòæÁ§∫ÊúÄÊñ∞ËÉåÂåÖÁ≥ªÁªü
            showBackpack() {
                // ÁßªÈô§Áé∞ÊúâËÉåÂåÖÈ°µÈù¢
                const existingBackpack = document.querySelector('.backpack-overlay');
                if (existingBackpack) {
                    existingBackpack.remove();
                }
                
                // ÂàõÂª∫ËÉåÂåÖÈ°µÈù¢ÂÆπÂô®
                const backpackOverlay = document.createElement('div');
                backpackOverlay.className = 'backpack-overlay';
                
                // ÂàõÂª∫ËÉåÂåÖÈ°µÈù¢
                const backpackPage = document.createElement('div');
                backpackPage.className = 'backpack-page';
                
                // Ëé∑ÂèñÂàÜÁ±ªÁâ©ÂìÅ
                const categorizedItems = this.getCategorizedItems();
                
                backpackPage.innerHTML = `
                    <div class="backpack-header">
                        <div class="backpack-title">
                            <span>üéí</span>
                            <span>ÊàëÁöÑËÉåÂåÖ</span>
                        </div>
                        <button class="backpack-close" onclick="GrandmaGame.closeBackpack()">‚úï</button>
                    </div>
                    
                    <div class="backpack-stats">
                        <div class="backpack-stat">
                            <div class="backpack-stat-label">ÂÆπÈáè</div>
                            <div class="backpack-stat-value">${this.gameState.backpack.items.length}/${this.gameState.backpack.capacity}</div>
                        </div>
                        <div class="backpack-stat">
                            <div class="backpack-stat-label">ÊÄª‰ª∑ÂÄº</div>
                            <div class="backpack-stat-value">üí∞ ${this.calculateBackpackValue()}</div>
                        </div>
                        <div class="backpack-stat">
                            <div class="backpack-stat-label">ÊãêÊùñ</div>
                            <div class="backpack-stat-value">ü¶Ø ${this.gameState.userCanes}</div>
                        </div>
                    </div>
                    
                    <div class="backpack-categories">
                        ${this.gameState.backpack.categories.map(category => `
                            <div class="backpack-category ${this.gameState.backpack.selectedCategory === category ? 'active' : ''}" 
                                 onclick="GrandmaGame.filterBackpackCategory('${category}')">
                                ${this.getCategoryName(category)}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="backpack-items">
                        ${categorizedItems.map(item => `
                            <div class="backpack-item ${item.selected ? 'selected' : ''}" onclick="GrandmaGame.selectBackpackItem('${item.id}')">
                                <div class="backpack-item-icon">
                                    ${item.icon}
                                    ${item.rarity !== 'common' ? `<div class="backpack-item-rarity ${item.rarity}">${this.getRarityName(item.rarity)}</div>` : ''}
                                </div>
                                <div class="backpack-item-name">${item.name}</div>
                                <div class="backpack-item-count">√ó${item.count}</div>
                                <div class="backpack-item-desc">${item.description}</div>
                                ${item.stats ? `
                                    <div class="backpack-item-stats">${item.stats}</div>
                                ` : ''}
                                <div class="backpack-item-actions">
                                    ${item.usable ? `
                                        <button class="backpack-item-action" onclick="GrandmaGame.useBackpackItem('${item.id}')" title="‰ΩøÁî®">
                                            <i class="fas fa-hand-pointer"></i>
                                        </button>
                                    ` : ''}
                                    <button class="backpack-item-action" onclick="GrandmaGame.viewBackpackItem('${item.id}')" title="Êü•ÁúãËØ¶ÊÉÖ">
                                        <i class="fas fa-info-circle"></i>
                                    </button>
                                    ${item.sellable ? `
                                        <button class="backpack-item-action sell" onclick="GrandmaGame.sellBackpackItem('${item.id}')" title="Âá∫ÂîÆ">
                                            <i class="fas fa-coins"></i>
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                        `).join('')}
                    </div>
                    
                    <div class="backpack-footer">
                        <button class="backpack-item-action" onclick="GrandmaGame.sortBackpack()">
                            <i class="fas fa-sort"></i>
                            ÊéíÂ∫è
                        </button>
                        <button class="backpack-item-action" onclick="GrandmaGame.openBackpackShop()">
                            <i class="fas fa-shopping-cart"></i>
                            ÂïÜÂ∫ó
                        </button>
                    </div>
                `;
                
                backpackOverlay.appendChild(backpackPage);
                document.body.appendChild(backpackOverlay);
            },
            
            // Ëé∑ÂèñÂàÜÁ±ªÁâ©ÂìÅ
            getCategorizedItems() {
                const selectedCategory = this.gameState.backpack.selectedCategory;
                
                if (selectedCategory === 'all') {
                    return this.gameState.backpack.items;
                }
                
                return this.gameState.backpack.items.filter(item => 
                    item.category === selectedCategory
                );
            },
            
            // Ëé∑ÂèñÂàÜÁ±ªÂêçÁß∞
            getCategoryName(category) {
                const names = {
                    'all': 'ÂÖ®ÈÉ®',
                    'consumable': 'Ê∂àËÄóÂìÅ',
                    'equipment': 'Ë£ÖÂ§á',
                    'special': 'ÁâπÊÆä',
                    'currency': 'Ë¥ßÂ∏Å'
                };
                return names[category] || category;
            },
            
            // Ëé∑ÂèñÁ®ÄÊúâÂ∫¶ÂêçÁß∞
            getRarityName(rarity) {
                const names = {
                    'common': 'ÊôÆÈÄö',
                    'rare': 'Á®ÄÊúâ',
                    'epic': 'Âè≤ËØó',
                    'legendary': '‰º†ËØ¥'
                };
                return names[rarity] || rarity;
            },
            
            // Á≠õÈÄâËÉåÂåÖÂàÜÁ±ª
            filterBackpackCategory(category) {
                this.gameState.backpack.selectedCategory = category;
                this.showBackpack();
            },
            
            // ÈÄâÊã©ËÉåÂåÖÁâ©ÂìÅ
            selectBackpackItem(itemId) {
                const item = this.gameState.backpack.items.find(item => item.id === itemId);
                
                if (!item) return;
                
                // ÂàáÊç¢ÈÄâ‰∏≠Áä∂ÊÄÅ
                item.selected = !item.selected;
                
                // Â¶ÇÊûúÊòØÊ∂àËÄóÂìÅÔºå‰ΩøÁî®Áâ©ÂìÅ
                if (item.selected && item.usable && item.category === 'consumable') {
                    this.useBackpackItem(itemId);
                }
                
                this.showBackpack();
            },
            
            // ‰ΩøÁî®ËÉåÂåÖÁâ©ÂìÅ
            useBackpackItem(itemId) {
                const item = this.gameState.backpack.items.find(item => item.id === itemId);
                
                if (!item || item.count <= 0) {
                    this.showMessage('Áâ©ÂìÅÊï∞Èáè‰∏çË∂≥', 'error');
                    return;
                }
                
                // Ê†πÊçÆÁâ©ÂìÅÁ±ªÂûãÊâßË°å‰∏çÂêåÊïàÊûú
                switch (item.id) {
                    case 'cane':
                        // ‰ΩøÁî®ÊãêÊùñ - ÂÖçË¥π‰∏ÄÊ¨°Ë¢´Êäì
                        this.gameState.hasProtection = true;
                        item.count--;
                        this.showMessage('ÊãêÊùñÂ∑≤ÊøÄÊ¥ªÔºå‰∏ãÊ¨°Ë¢´ÊäìÂ∞ÜÂÖçÂèóÊçüÂ§±', 'success');
                        break;
                        
                    case 'protection':
                        // ‰ΩøÁî®ÂÖç‰º§Âç°
                        this.gameState.hasProtection = true;
                        item.count--;
                        this.showMessage('ÂÖç‰º§Âç°Â∑≤ÊøÄÊ¥ªÔºå‰∏ãÊ¨°Ë¢´ÊäìÂ∞ÜÂÖçÂèóÊçüÂ§±', 'success');
                        break;
                        
                    case 'lucky_charm':
                        // ‰ΩøÁî®Âπ∏ËøêÁ¨¶
                        this.gameState.luckyBonus = 0.1; // 10%Â≠òÊ¥ªÂä†Êàê
                        item.count--;
                        this.showMessage('Âπ∏ËøêÁ¨¶Â∑≤ÊøÄÊ¥ªÔºå‰∏ãÊ¨°Â≠òÊ¥ªÊ¶ÇÁéáÂ¢ûÂä†10%', 'success');
                        break;
                        
                    case 'speed_boost':
                        // ‰ΩøÁî®Âä†ÈÄüËçØÊ∞¥
                        this.gameState.speedBonus = 5; // 5ÁßíÂä†ÈÄü
                        item.count--;
                        this.showMessage('Âä†ÈÄüËçØÊ∞¥Â∑≤ÊøÄÊ¥ªÔºåÊäïÊ≥®ÈîÅÂÆöÊó∂Èó¥ÂáèÂ∞ë5Áßí', 'success');
                        break;
                        
                    case 'double_reward':
                        // ‰ΩøÁî®ÂèåÂÄçÂ•ñÂä±Âç°
                        this.gameState.doubleBonus = true;
                        item.count--;
                        this.showMessage('ÂèåÂÄçÂ•ñÂä±Âç°Â∑≤ÊøÄÊ¥ªÔºå‰∏ãÊ¨°Ëé∑ËÉúËé∑ÂæóÂèåÂÄçÂ•ñÂä±', 'success');
                        break;
                        
                    case 'mystery_box':
                        // ‰ΩøÁî®Á•ûÁßòÁõ≤Áõí
                        this.openMysteryBox();
                        item.count--;
                        break;
                }
                
                // Â¶ÇÊûúÁâ©ÂìÅÁî®ÂÆåÔºå‰ªéËÉåÂåÖ‰∏≠ÁßªÈô§
                if (item.count <= 0) {
                    const index = this.gameState.backpack.items.findIndex(item => item.id === itemId);
                    if (index > -1) {
                        this.gameState.backpack.items.splice(index, 1);
                    }
                }
                
                this.saveUserData();
                this.showBackpack(); // Âà∑Êñ∞ËÉåÂåÖÈ°µÈù¢
            },
            
            // ÊâìÂºÄÁ•ûÁßòÁõ≤Áõí
            openMysteryBox() {
                const possibleItems = ['cane', 'protection', 'lucky_charm', 'speed_boost', 'double_reward'];
                const weights = [30, 10, 15, 20, 5]; // ÊùÉÈáç
                const random = Math.random() * 100;
                let cumulative = 0;
                let selectedItem = possibleItems[0];
                
                for (let i = 0; i < possibleItems.length; i++) {
                    cumulative += weights[i];
                    if (random <= cumulative) {
                        selectedItem = possibleItems[i];
                        break;
                    }
                }
                
                const itemConfig = this.itemConfig[selectedItem];
                const newItem = {
                    ...itemConfig,
                    count: 1
                };
                
                // Ê∑ªÂä†Âà∞ËÉåÂåÖ
                this.gameState.backpack.items.push(newItem);
                
                this.showMessage(`üéÅ ‰ªéÁ•ûÁßòÁõ≤Áõí‰∏≠Ëé∑Âæó‰∫Ü ${newItem.name}ÔºÅ`, 'success');
                this.saveUserData();
                this.showBackpack();
            },
            
            // Êü•ÁúãËÉåÂåÖÁâ©ÂìÅËØ¶ÊÉÖ
            viewBackpackItem(itemId) {
                const item = this.gameState.backpack.items.find(item => item.id === itemId);
                
                if (!item) return;
                
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.style.zIndex = '2000';
                modal.innerHTML = `
                    <div class="item-detail-modal">
                        <div class="item-detail-header">
                            <div class="item-detail-title">${item.name}</div>
                            <button class="item-detail-close" onclick="this.closest('.modal').remove()">‚úï</button>
                        </div>
                        <div class="item-detail-icon">${item.icon}</div>
                        <div class="item-detail-info">
                            <div class="item-detail-row">
                                <div class="item-detail-label">Á®ÄÊúâÂ∫¶:</div>
                                <div class="item-detail-value">${this.getRarityName(item.rarity)}</div>
                            </div>
                            <div class="item-detail-row">
                                <div class="item-detail-label">Êï∞Èáè:</div>
                                <div class="item-detail-value">${item.count}</div>
                            </div>
                            <div class="item-detail-row">
                                <div class="item-detail-label">‰ª∑ÂÄº:</div>
                                <div class="item-detail-value">üí∞ ${item.value}</div>
                            </div>
                            <div class="item-detail-row">
                                <div class="item-detail-label">ÊÄª‰ª∑ÂÄº:</div>
                                <div class="item-detail-value">üí∞ ${item.count * item.value}</div>
                            </div>
                            <div class="item-detail-row">
                                <div class="item-detail-label">ÂàÜÁ±ª:</div>
                                <div class="item-detail-value">${this.getCategoryName(item.category)}</div>
                            </div>
                            <div class="item-detail-row">
                                <div class="item-detail-label">Áä∂ÊÄÅ:</div>
                                <div class="item-detail-value">${item.usable ? 'ÂèØ‰ΩøÁî®' : '‰∏çÂèØ‰ΩøÁî®'}</div>
                            </div>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 182, 193, 0.3);">
                                <div style="color: #8B008B; margin-bottom: 10px;">${item.description}</div>
                            </div>
                        </div>
                        <div class="item-detail-actions">
                            ${item.usable ? `
                                <button class="item-detail-action" onclick="GrandmaGame.useBackpackItem('${item.id}'); this.closest('.modal').remove();">
                                    ‰ΩøÁî®Áâ©ÂìÅ
                                </button>
                            ` : ''}
                            <button class="item-detail-action secondary" onclick="this.closest('.modal').remove();">
                                ÂÖ≥Èó≠
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                setTimeout(() => {
                    modal.remove();
                }, 5000);
            },
            
            // Âá∫ÂîÆËÉåÂåÖÁâ©ÂìÅ
            sellBackpackItem(itemId) {
                const item = this.gameState.backpack.items.find(item => item.id === itemId);
                
                if (!item || item.count <= 0) {
                    this.showMessage('Áâ©ÂìÅÊï∞Èáè‰∏çË∂≥', 'error');
                    return;
                }
                
                const sellPrice = Math.floor(item.value * 0.5); // 50%Âá∫ÂîÆ‰ª∑Ê†º
                const sellCount = item.count;
                const totalValue = sellPrice * sellCount;
                
                // Â¢ûÂä†ÁßØÂàÜ
                this.gameState.userPoints += totalValue;
                this.addPointsHistory('earn', totalValue, `Âá∫ÂîÆ${item.name}`);
                
                // ‰ªéËÉåÂåÖ‰∏≠ÁßªÈô§
                const index = this.gameState.backpack.items.findIndex(item => item.id === itemId);
                if (index > -1) {
                    this.gameState.backpack.items.splice(index, 1);
                }
                
                this.updatePointsDisplay();
                this.saveUserData();
                
                this.showMessage(`ÊàêÂäüÂá∫ÂîÆ ${sellCount}‰∏™${item.name}ÔºåËé∑Âæó${totalValue}ÁßØÂàÜ`, 'success');
                this.showBackpack();
            },
            
            // ÊéíÂ∫èËÉåÂåÖ
            sortBackpack() {
                // ÊåâÁ®ÄÊúâÂ∫¶ÊéíÂ∫è
                const rarityOrder = { 'legendary': 4, 'epic': 3, 'rare': 2, 'common': 1 };
                
                this.gameState.backpack.items.sort((a, b) => {
                    const rarityA = rarityOrder[a.rarity] || 0;
                    const rarityB = rarityOrder[b.rarity] || 0;
                    
                    if (rarityA !== rarityB) {
                        return rarityB - rarityA;
                    }
                    
                    // Áõ∏ÂêåÁ®ÄÊúâÂ∫¶Êåâ‰ª∑ÂÄºÊéíÂ∫è
                    return b.value - a.value;
                });
                
                this.showBackpack();
            },
            
            // ÊâìÂºÄËÉåÂåÖÂïÜÂ∫ó
            openBackpackShop() {
                this.showMessage('ËÉåÂåÖÂïÜÂ∫óÂäüËÉΩÂºÄÂèë‰∏≠...', 'info');
            },
            
            // ËÆ°ÁÆóËÉåÂåÖÊÄª‰ª∑ÂÄº
            calculateBackpackValue() {
                return this.gameState.backpack.items.reduce((total, item) => {
                    return total + (item.count * item.value);
                }, 0);
            },
            
            // ÂÖ≥Èó≠ËÉåÂåÖ
            closeBackpack() {
                const backpackOverlay = document.querySelector('.backpack-overlay');
                if (backpackOverlay) {
                    backpackOverlay.remove();
                }
            },
            
            // ÊòæÁ§∫ÊØèÊó•‰ªªÂä°
            showDailyTasks() {
                // ÁßªÈô§Áé∞Êúâ‰ªªÂä°È°µÈù¢
                const existingTasks = document.querySelector('.tasks-overlay');
                if (existingTasks) {
                    existingTasks.remove();
                }
                
                // ÂàõÂª∫‰ªªÂä°È°µÈù¢ÂÆπÂô®
                const tasksOverlay = document.createElement('div');
                tasksOverlay.className = 'tasks-overlay';
                
                // ÂàõÂª∫‰ªªÂä°È°µÈù¢
                const tasksPage = document.createElement('div');
                tasksPage.className = 'tasks-page';
                
                const task1 = this.gameState.dailyTasks.task1;
                const task2 = this.gameState.dailyTasks.task2;
                const task3 = this.gameState.dailyTasks.task3;
                
                tasksPage.innerHTML = `
                    <div class="tasks-title">üìã ÊØèÊó•‰ªªÂä°</div>
                    <div class="tasks-list">
                        <div class="task-item">
                            <div class="task-header">
                                <div class="task-name">‰ªªÂä°‰∏ÄÔºöÂãáÊï¢ÁöÑÊåëÊàòËÄÖ</div>
                                <div class="task-reward">üí∞ 2.88</div>
                            </div>
                            <div class="task-desc">Ê∏∏Áé©10ÊääÊ∏∏ÊàèÔºåÂçïÂ±ÄÊäïÊ≥®‰∏ç‰Ωé‰∫é5ÁßØÂàÜ</div>
                            <div class="task-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${(task1.completed / task1.target) * 100}%"></div>
                                </div>
                                <div class="progress-text">${task1.completed}/${task1.target}</div>
                            </div>
                            <button class="task-btn" ${task1.completed >= task1.target && !task1.claimed ? '' : 'disabled'} onclick="GrandmaGame.claimTaskReward('task1')">
                                ${task1.claimed ? 'Â∑≤È¢ÜÂèñ' : 'È¢ÜÂèñÂ•ñÂä±'}
                            </button>
                        </div>
                        <div class="task-item">
                            <div class="task-header">
                                <div class="task-name">‰ªªÂä°‰∫åÔºöÂùöÊåÅ‰∏çÊáà</div>
                                <div class="task-reward">ü¶Ø 10.88</div>
                            </div>
                            <div class="task-desc">Ê∏∏Áé©30ÊääÊ∏∏ÊàèÔºåÊØèÊçüÂ§±100ÁßØÂàÜÊ¶ÇÁéáËé∑ÂæóÊãêÊùñ</div>
                            <div class="task-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${(task2.completed / task2.target) * 100}%"></div>
                                </div>
                                <div class="progress-text">${task2.completed}/${task2.target}</div>
                            </div>
                            <button class="task-btn" ${task2.completed >= task2.target && !task2.claimed ? '' : 'disabled'} onclick="GrandmaGame.claimTaskReward('task2')">
                                ${task2.claimed ? 'Â∑≤È¢ÜÂèñ' : 'È¢ÜÂèñÂ•ñÂä±'}
                            </button>
                        </div>
                        <div class="task-item">
                            <div class="task-header">
                                <div class="task-name">‰ªªÂä°‰∏âÔºöÂπ∏ËøêÊòü</div>
                                <div class="task-reward">üéÅ ÈöèÊú∫Â•ñÂä±</div>
                            </div>
                            <div class="task-desc">ÂÆåÊàêÊ∏∏ÊàèÊúâÊ¶ÇÁéáËé∑ÂæóÈöèÊú∫Â•ñÂä±ÔºåÊØèÊó•ÊúÄÂ§ö10Ê¨°</div>
                            <div class="task-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${(task3.completed / task3.target) * 100}%"></div>
                                </div>
                                <div class="progress-text">${task3.completed}/${task3.target}</div>
                            </div>
                            <div class="task-desc">‰ªäÊó•Â∑≤Ëß¶Âèë: ${task3.count}/10 Ê¨°</div>
                        </div>
                    </div>
                    <button class="settlement-btn" onclick="GrandmaGame.closeDailyTasks()">ÂÖ≥Èó≠</button>
                `;
                
                tasksOverlay.appendChild(tasksPage);
                document.body.appendChild(tasksOverlay);
            },
            
            // ÂÖ≥Èó≠ÊØèÊó•‰ªªÂä°
            closeDailyTasks() {
                const tasksOverlay = document.querySelector('.tasks-overlay');
                if (tasksOverlay) {
                    tasksOverlay.remove();
                }
            },
            
            // È¢ÜÂèñ‰ªªÂä°Â•ñÂä±
            claimTaskReward(taskId) {
                const task = this.gameState.dailyTasks[taskId];
                
                if (task.completed >= task.target && !task.claimed) {
                    task.claimed = true;
                    
                    if (taskId === 'task1') {
                        this.gameState.userPoints += 2.88;
                        this.addPointsHistory('earn', 2.88, '‰ªªÂä°‰∏ÄÂ•ñÂä±');
                        this.showMessage('ÊàêÂäüÈ¢ÜÂèñ‰ªªÂä°‰∏ÄÂ•ñÂä±Ôºö2.88ÁßØÂàÜ', 'success');
                    } else if (taskId === 'task2') {
                        this.gameState.userCanes += 10.88;
                        this.showMessage('ÊàêÂäüÈ¢ÜÂèñ‰ªªÂä°‰∫åÂ•ñÂä±Ôºö10.88‰∏™ÊãêÊùñ', 'success');
                    }
                    
                    this.updatePointsDisplay();
                    this.updateUserInfo();
                    this.saveUserData();
                    this.showDailyTasks(); // Âà∑Êñ∞‰ªªÂä°È°µÈù¢
                }
            },
            
            // Êõ¥Êñ∞‰ªªÂä°ËøõÂ∫¶
            updateTaskProgress(taskId, value) {
                const task = this.gameState.dailyTasks[taskId];
                
                if (taskId === 'task1') {
                    // ‰ªªÂä°‰∏ÄÔºöÊØèÁé©‰∏ÄÊääÊ∏∏ÊàèÂ¢ûÂä†ËøõÂ∫¶
                    task.completed = Math.min(task.completed + 1, task.target);
                } else if (taskId === 'task2') {
                    // ‰ªªÂä°‰∫åÔºöÊØèÊçüÂ§±100ÁßØÂàÜÂ¢ûÂä†ËøõÂ∫¶
                    task.completed = Math.min(task.completed + Math.floor(value / 100), task.target);
                } else if (taskId === 'task3') {
                    // ‰ªªÂä°‰∏âÔºöÈöèÊú∫Ëß¶Âèë
                    if (task.count < 10 && Math.random() < 0.3) {
                        task.completed = Math.min(task.completed + 1, task.target);
                        task.count++;
                        
                        // ÈöèÊú∫Â•ñÂä±
                        const rewards = [
                            { amount: 0.88, probability: 0.7 },
                            { amount: 2.88, probability: 0.2 },
                            { amount: 5.88, probability: 0.07 },
                            { amount: 18.88, probability: 0.03 }
                        ];
                        
                        let random = Math.random();
                        let cumulative = 0;
                        let rewardAmount = 0;
                        
                        for (const reward of rewards) {
                            cumulative += reward.probability;
                            if (random <= cumulative) {
                                rewardAmount = reward.amount;
                                break;
                            }
                        }
                        
                        this.gameState.userPoints += rewardAmount;
                        this.addPointsHistory('earn', rewardAmount, '‰ªªÂä°‰∏âÂ•ñÂä±');
                        this.updatePointsDisplay();
                        this.saveUserData();
                        
                        this.showMessage(`üéÅ Ëß¶Âèë‰ªªÂä°‰∏âÂ•ñÂä±Ôºö${rewardAmount}ÁßØÂàÜ`, 'success');
                    }
                }
                
                this.saveUserData();
            },
            
            // ÊòæÁ§∫ÁßØÂàÜÊòéÁªÜ
            showPointsDetails() {
                // ÁßªÈô§Áé∞ÊúâÁßØÂàÜÈ°µÈù¢
                const existingPoints = document.querySelector('.points-overlay');
                if (existingPoints) {
                    existingPoints.remove();
                }
                
                // ÂàõÂª∫ÁßØÂàÜÈ°µÈù¢ÂÆπÂô®
                const pointsOverlay = document.createElement('div');
                pointsOverlay.className = 'points-overlay';
                
                // ÂàõÂª∫ÁßØÂàÜÈ°µÈù¢
                const pointsPage = document.createElement('div');
                pointsPage.className = 'points-page';
                
                // ËÆ°ÁÆóÁõà‰∫è
                const profit = this.gameState.totalEarned - this.gameState.totalInvested;
                
                pointsPage.innerHTML = `
                    <div class="points-title">üí∞ ÁßØÂàÜÊòéÁªÜ</div>
                    <div class="points-stats">
                        <div class="points-stat">
                            <div class="stat-label">ÊÄªÊäïÂÖ•</div>
                            <div class="stat-value">üí∞ ${this.gameState.totalInvested}</div>
                        </div>
                        <div class="points-stat">
                            <div class="stat-label">ÊÄªÊî∂ÂÖ•</div>
                            <div class="stat-value">üí∞ ${this.gameState.totalEarned}</div>
                        </div>
                        <div class="points-stat">
                            <div class="stat-label">Áõà‰∫è</div>
                            <div class="stat-value ${profit >= 0 ? 'positive' : 'negative'}">üí∞ ${profit}</div>
                        </div>
                        <div class="points-stat">
                            <div class="stat-label">ÂΩìÂâçÁßØÂàÜ</div>
                            <div class="stat-value">üí∞ ${this.gameState.userPoints}</div>
                        </div>
                    </div>
                    <div class="points-history">
                        ${this.gameState.pointsHistory.length > 0 ? 
                            this.gameState.pointsHistory.map(record => `
                                <div class="history-item">
                                    <div class="history-desc">${record.description}</div>
                                    <div class="history-amount ${record.type === 'earn' ? 'positive' : 'negative'}">
                                        ${record.type === 'earn' ? '+' : '-'}üí∞ ${record.amount}
                                    </div>
                                </div>
                            `).join('') : 
                            '<div style="text-align: center; color: #666; padding: 20px;">ÊöÇÊó†ËÆ∞ÂΩï</div>'
                        }
                    </div>
                    <button class="settlement-btn" onclick="GrandmaGame.closePointsDetails()">ÂÖ≥Èó≠</button>
                `;
                
                pointsOverlay.appendChild(pointsPage);
                document.body.appendChild(pointsOverlay);
            },
            
            // ÂÖ≥Èó≠ÁßØÂàÜÊòéÁªÜ
            closePointsDetails() {
                const pointsOverlay = document.querySelector('.points-overlay');
                if (pointsOverlay) {
                    pointsOverlay.remove();
                }
            },
            
            // Ê∑ªÂä†ÁßØÂàÜÂéÜÂè≤ËÆ∞ÂΩï
            addPointsHistory(type, amount, description) {
                this.gameState.pointsHistory.unshift({
                    type,
                    amount,
                    description,
                    timestamp: new Date()
                });
                
                // Âè™‰øùÁïôÊúÄËøë50Êù°ËÆ∞ÂΩï
                if (this.gameState.pointsHistory.length > 50) {
                    this.gameState.pointsHistory.pop();
                }
                
                // ÈáçÊñ∞ËÆ°ÁÆóÁªüËÆ°
                this.calculatePointsStats();
                
                this.saveUserData();
            },
            
            // ÂºÄÂßãÂ§©Ê∞îÊïàÊûú
            startWeatherEffect() {
                const weatherEffect = document.getElementById('weatherEffect');
                
                setInterval(() => {
                    if (Math.random() < 0.3) {
                        weatherEffect.classList.add('blood-rain');
                        setTimeout(() => {
                            weatherEffect.classList.remove('blood-rain');
                        }, 5000);
                    }
                }, 15000);
            },
            
            // ÊòæÁ§∫Ê∂àÊÅØ
            showMessage(text, type) {
                const existingMessage = document.querySelector('.message');
                if (existingMessage) {
                    existingMessage.remove();
                }
                
                const message = document.createElement('div');
                message.className = `message ${type}`;
                message.textContent = text;
                document.body.appendChild(message);
                
                setTimeout(() => {
                    message.remove();
                }, 3000);
            }
        };
        
        // ÂÖ®Â±ÄÂáΩÊï∞
        window.GrandmaGame = GrandmaGame;
        
        // ÂÖ®Â±ÄÂáΩÊï∞
        function quickBet(amount) {
            GrandmaGame.quickBet(amount);
        }
        
        function placeBet() {
            GrandmaGame.placeBet();
        }
        
        function switchLeaderboard(type) {
            GrandmaGame.switchLeaderboard(type);
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        window.onload = function() {
            console.log('È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÂàùÂßãÂåñÊ∏∏Êàè');
            GrandmaGame.init();
        };
    </script>
</body>
</html>
