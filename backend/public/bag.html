<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒŒåŒ…ç³»ç»Ÿ - å¤©åˆ›æ—¶ä»£</title>
    
    <!-- ä¼˜åŒ–å­—ä½“åŠ è½½ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF7043;
            --secondary: #FFB74D;
            --accent: #FFC107;
            --bg-dark: #2C3E50;
            --bg-light: #34495E;
            --text-light: #ECF0F1;
            --gradient: linear-gradient(135deg, #FF7043, #FFB74D, #FFC107);
            --shadow: 0 8px 25px rgba(255, 112, 67, 0.3);
            --transition: all 0.3s ease;
            --border-radius: 20px;
        }
        
        body {
            font-family: 'Noto Sans SC', 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
            background: linear-gradient(135deg, #FFE5F1 0%, #FFD1DC 25%, #FFC0CB 50%, #FFB6C1 75%, #FFA07A 100%);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* åŠ¨æ€èƒŒæ™¯ç²’å­ */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gradient);
            border-radius: 50%;
            opacity: 0.6;
            animation: particleFloat 20s linear infinite;
        }
        
        .particle.interactive {
            width: 6px;
            height: 6px;
            opacity: 0.8;
            animation: particleFloat 15s linear infinite;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-10vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* èƒŒåŒ…èƒŒæ™¯åŠ¨ç”» */
        .bag-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path d="M100,20 C60,20 30,50 30,90 C30,130 60,160 100,160 C140,160 170,130 170,90 C170,50 140,20 100,20 Z" fill="none" stroke="rgba(255,182,193,0.1)" stroke-width="2"/></svg>') repeat;
            opacity: 0.1;
            pointer-events: none;
            z-index: 1;
            animation: bagFloat 20s linear infinite;
        }
        
        @keyframes bagFloat {
            0% { transform: translateX(0) translateY(0) rotate(0deg); }
            50% { transform: translateX(-10px) translateY(-5px) rotate(5deg); }
            100% { transform: translateX(0) translateY(0) rotate(0deg); }
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--primary);
            box-shadow: var(--shadow);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 2.2rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: logoGlow 3s ease-in-out infinite;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            animation: logoRotate 10s linear infinite;
        }
        
        @keyframes logoGlow {
            0%, 100% {
                filter: drop-shadow(0 0 20px rgba(255, 112, 67, 0.5));
            }
            50% {
                filter: drop-shadow(0 0 30px rgba(255, 112, 67, 0.8));
            }
        }
        
        @keyframes logoRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .settings-btn {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 112, 67, 0.1);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: 2px solid rgba(255, 112, 67, 0.3);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }
        
        .user-info:hover {
            background: rgba(255, 112, 67, 0.2);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }
        
        .user-points {
            background: var(--gradient);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1rem;
            margin-top: 0.5rem;
            min-width: 200px;
            box-shadow: var(--shadow);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 1001;
        }
        
        .user-info.active .user-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            color: #333;
            text-decoration: none;
        }
        
        .user-dropdown-item:hover {
            background: rgba(255, 112, 67, 0.1);
        }
        
        .user-dropdown-divider {
            height: 1px;
            background: rgba(255, 112, 67, 0.3);
            margin: 0.5rem 0;
        }
        
        /* ä¸»å†…å®¹ */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .page-title {
            font-size: 3rem;
            font-weight: 900;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            animation: fadeInDown 1s ease;
        }
        
        .page-subtitle {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 1rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease 0.3s;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* èƒŒåŒ…ç³»ç»Ÿå¸ƒå±€ */
        .bag-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        /* èƒŒåŒ…ä¾§è¾¹æ  */
        .bag-sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 112, 67, 0.3);
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .sidebar-subtitle {
            color: #666;
            font-size: 0.9rem;
        }
        
        .sidebar-menu {
            list-style: none;
        }
        
        .sidebar-menu-item {
            margin-bottom: 0.5rem;
        }
        
        .sidebar-menu-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 112, 67, 0.2);
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            color: #333;
            text-decoration: none;
            font-weight: 500;
        }
        
        .sidebar-menu-link:hover {
            background: rgba(255, 112, 67, 0.1);
        }
        
        .sidebar-menu-link.active {
            background: var(--gradient);
            color: white;
        }
        
        .sidebar-menu-icon {
            width: 20px;
            text-align: center;
        }
        
        /* èƒŒåŒ…ä¸»å†…å®¹ */
        .bag-main {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: var(--border-radius);
            padding: 2rem;
            overflow-y: auto;
        }
        
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 112, 67, 0.3);
        }
        
        .main-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .main-actions {
            display: flex;
            gap: 1rem;
        }
        
        .action-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .action-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* èƒŒåŒ…ç½‘æ ¼ */
        .bag-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .bag-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 112, 67, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .bag-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .bag-item.selected {
            background: rgba(255, 112, 67, 0.2);
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(255, 112, 67, 0.3);
        }
        
        .bag-item-icon {
            font-size: 2.5rem;
            margin-bottom: 0.8rem;
        }
        
        .bag-item-name {
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .bag-item-count {
            color: var(--primary);
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .bag-item-quality {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--gradient);
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .bag-item-quality.common {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .bag-item-quality.rare {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .bag-item-quality.epic {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .bag-item-quality.legendary {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        /* èƒŒåŒ…è¯¦æƒ…é¢æ¿ */
        .bag-detail-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .bag-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 112, 67, 0.3);
        }
        
        .bag-detail-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
        }
        
        .bag-detail-close {
            background: none;
            border: none;
            color: #666;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .bag-detail-close:hover {
            background: rgba(255, 112, 67, 0.1);
            color: var(--primary);
        }
        
        .bag-detail-content {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        
        .bag-detail-icon {
            font-size: 3rem;
        }
        
        .bag-detail-info {
            flex: 1;
        }
        
        .bag-detail-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .bag-detail-desc {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }
        
        .bag-detail-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .detail-stat {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 112, 67, 0.2);
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
        }
        
        .detail-stat-label {
            color: #666;
            font-size: 0.8rem;
        }
        
        .detail-stat-value {
            color: #333;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .bag-detail-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .detail-btn {
            flex: 1;
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .detail-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .detail-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .detail-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .empty-desc {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(400px);
            transition: var(--transition);
            max-width: 350px;
            border-left: 4px solid var(--accent);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left-color: #27AE60;
        }
        
        .notification.error {
            border-left-color: #E74C3C;
        }
        
        .notification.info {
            border-left-color: #3498DB;
        }
        
        .notification-icon {
            font-size: 1.3rem;
            color: var(--accent);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.2rem;
        }
        
        .notification-message {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .bag-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .bag-sidebar {
                display: none;
            }
            
            .bag-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .main-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .main-actions {
                justify-content: center;
            }
            
            .bag-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- åŠ¨æ€èƒŒæ™¯ç²’å­ -->
    <div class="particles" id="particles"></div>
    <div class="bag-bg" id="bagBg"></div>
    
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">ğŸ’</div>
                <div class="logo-text">èƒŒåŒ…ç³»ç»Ÿ</div>
            </div>
            
            <div class="nav-right">
                <a href="doll-king.html" class="settings-btn">
                    <i class="fas fa-crown"></i>
                    <span>å¨ƒå¨ƒä¹‹ç‹</span>
                </a>
                
                <div class="user-info" id="userInfo">
                    <div class="user-avatar">ğŸ‘¤</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">ç©å®¶</div>
                        <div class="user-points">ğŸ’° <span id="userPoints">0</span></div>
                    </div>
                    
                    <div class="user-dropdown">
                        <a href="index.html" class="user-dropdown-item">
                            <i class="fas fa-home"></i>
                            <span>è¿”å›é¦–é¡µ</span>
                        </a>
                        <a href="user-center.html" class="user-dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>ä¸ªäººèµ„æ–™</span>
                        </a>
                        <a href="achievements.html" class="user-dropdown-item">
                            <i class="fas fa-trophy"></i>
                            <span>æˆå°±</span>
                        </a>
                        <a href="inventory.html" class="user-dropdown-item">
                            <i class="fas fa-box"></i>
                            <span>ç‰©å“æ </span>
                        </a>
                        <a href="bag.html" class="user-dropdown-item active">
                            <i class="fas fa-shopping-bag"></i>
                            <span>æˆ‘çš„èƒŒåŒ…</span>
                        </a>
                        <a href="mall.html" class="user-dropdown-item">
                            <i class="fas fa-shopping-cart"></i>
                            <span>å¤©åˆ›å•†åŸ</span>
                        </a>
                        <a href="market.html" class="user-dropdown-item">
                            <i class="fas fa-store"></i>
                            <span>äº¤æ˜“å¸‚åœº</span>
                        </a>
                        <a href="dice.html" class="user-dropdown-item">
                            <i class="fas fa-dice"></i>
                            <span>å¹¸è¿éª°å­</span>
                        </a>
                        <a href="doll.html" class="user-dropdown-item">
                            <i class="fas fa-doll"></i>
                            <span>å¨ƒå¨ƒç³»ç»Ÿ</span>
                        </a>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <a href="#" class="user-dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>é€€å‡ºç™»å½•</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- ä¸»å†…å®¹ -->
    <main class="main-content">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <section class="page-header">
            <h1 class="page-title">ğŸ’ èƒŒåŒ…ç³»ç»Ÿ</h1>
            <p class="page-subtitle">ç®¡ç†æ‚¨çš„ç‰©å“ï¼ŒæŸ¥çœ‹æ”¶è—å’Œé“å…·</p>
        </section>
        
        <!-- èƒŒåŒ…ç³»ç»Ÿå¸ƒå±€ -->
        <div class="bag-layout">
            <!-- èƒŒåŒ…ä¾§è¾¹æ  -->
            <aside class="bag-sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">ç‰©å“åˆ†ç±»</div>
                    <div class="sidebar-subtitle">å¿«é€Ÿå¯¼èˆª</div>
                </div>
                
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a href="#all" class="sidebar-menu-link active" data-category="all">
                            <i class="fas fa-th sidebar-menu-icon"></i>
                            <span>å…¨éƒ¨ç‰©å“</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#doll" class="sidebar-menu-link" data-category="doll">
                            <i class="fas fa-doll sidebar-menu-icon"></i>
                            <span>å¨ƒå¨ƒ</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#item" class="sidebar-menu-link" data-category="item">
                            <i class="fas fa-cube sidebar-menu-icon"></i>
                            <span>é“å…·</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#equipment" class="sidebar-menu-link" data-category="equipment">
                            <i class="fas fa-shield-alt sidebar-menu-icon"></i>
                            <span>è£…å¤‡</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#skin" class="sidebar-menu-link" data-category="skin">
                            <i class="fas fa-palette sidebar-menu-icon"></i>
                            <span>çš®è‚¤</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#currency" class="sidebar-menu-link" data-category="currency">
                            <i class="fas fa-coins sidebar-menu-icon"></i>
                            <span>è´§å¸</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#other" class="sidebar-menu-link" data-category="other">
                            <i class="fas fa-ellipsis-h sidebar-menu-icon"></i>
                            <span>å…¶ä»–</span>
                        </a>
                    </li>
                </ul>
                
                <div class="bag-stats">
                    <div class="stat-item">
                        <span class="stat-label">æ€»ç‰©å“</span>
                        <span class="stat-value" id="bagTotalItems">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ€»ä»·å€¼</span>
                        <span class="stat-value" id="bagTotalValue">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">èƒŒåŒ…å®¹é‡</span>
                        <span class="stat-value">100/100</span>
                    </div>
                </div>
            </aside>
            
            <!-- èƒŒåŒ…ä¸»å†…å®¹ -->
            <div class="bag-main">
                <div class="main-header">
                    <div class="main-title">
                        <i class="fas fa-shopping-bag"></i>
                        <span>æˆ‘çš„èƒŒåŒ…</span>
                    </div>
                    <div class="main-actions">
                        <button class="action-btn" id="sortBtn">
                            <i class="fas fa-sort"></i>
                            <span>æ’åº</span>
                        </button>
                        <button class="action-btn secondary" id="organizeBtn">
                            <i class="fas fa-th"></i>
                            <span>æ•´ç†</span>
                        </button>
                    </div>
                </div>
                
                <div class="bag-grid" id="bagGrid">
                    <!-- èƒŒåŒ…ç‰©å“å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- èƒŒåŒ…è¯¦æƒ…é¢æ¿ -->
                <div class="bag-detail-panel" id="bagDetailPanel" style="display: none;">
                    <div class="bag-detail-header">
                        <div class="bag-detail-title">ç‰©å“è¯¦æƒ…</div>
                        <button class="bag-detail-close" id="detailClose">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="bag-detail-content">
                        <div class="bag-detail-icon" id="detailIcon">ğŸ’</div>
                        <div class="bag-detail-info">
                            <div class="bag-detail-name" id="detailName">ç‰©å“åç§°</div>
                            <div class="bag-detail-desc" id="detailDesc">ç‰©å“æè¿°</div>
                            <div class="bag-detail-stats" id="detailStats">
                                <!-- åŠ¨æ€ç”Ÿæˆå±æ€§ -->
                            </div>
                            <div class="bag-detail-actions" id="detailActions">
                                <!-- åŠ¨æ€ç”Ÿæˆæ“ä½œæŒ‰é’® -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ä¼˜åŒ–è„šæœ¬åŠ è½½ -->
    <script>
        // åŠ¨æ€APIé…ç½® - è‡ªåŠ¨é€‚åº”æœåŠ¡å™¨åœ°å€
        window.API_CONFIG = {
            BASE_URL: window.location.origin,
            ENDPOINTS: {
                USER: '/api/user',
                POINTS: '/api/points',
                ITEMS: '/api/items',
                MALL: '/api/mall'
            },
            TIMEOUT: 5000
        };

        // é¢„åŠ è½½å…³é”®è„šæœ¬
        function loadScript(src, callback) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = callback;
            script.onerror = () => {
                console.error('Failed to load script:', src);
                // å¦‚æœå¤–éƒ¨è„šæœ¬åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å†…è”å¤‡ç”¨ç‰ˆæœ¬
                if (callback) callback();
            };
            document.head.appendChild(script);
        }

        // æŒ‰é¡ºåºåŠ è½½è„šæœ¬
        const scripts = [
            'api-service.js',
            'data-adapter.js', 
            'points-system.js',
            'user-system.js',
            'common.js'
        ];

        let loadedScripts = 0;
        
        function loadNextScript() {
            if (loadedScripts < scripts.length) {
                loadScript(scripts[loadedScripts], () => {
                    loadedScripts++;
                    loadNextScript();
                });
            } else {
                // æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–èƒŒåŒ…ç³»ç»Ÿ
                initBagSystem();
            }
        }

        // åˆå§‹åŒ–èƒŒåŒ…ç³»ç»Ÿ
        function initBagSystem() {
            console.log('=== èƒŒåŒ…ç³»ç»Ÿåˆå§‹åŒ– ===');
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (!checkLoginStatus()) {
                return;
            }
            
            // åˆå§‹åŒ–ç²’å­æ•ˆæœ
            initParticles();
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners();
            
            // ç­‰å¾…å…¶ä»–ç³»ç»ŸåŠ è½½å®Œæˆ
            waitForSystems(() => {
                // åŠ è½½èƒŒåŒ…æ•°æ®
                loadBagData();
                
                // æ›´æ–°UI
                updateUI();
                
                // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
                initPointsSystem();
                
                console.log('èƒŒåŒ…ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            });
        }
        
        // ç­‰å¾…å…¶ä»–ç³»ç»ŸåŠ è½½å®Œæˆ
        function waitForSystems(callback) {
            let attempts = 0;
            const maxAttempts = 50;
            
            const checkSystems = () => {
                attempts++;
                
                if (window.pointsSystem && window.pointsSystem.isInitialized && 
                    window.userSystem && window.userSystem.isLoggedIn) {
                    console.log('èƒŒåŒ…ç³»ç»Ÿï¼šæ‰€æœ‰ç³»ç»Ÿå·²åŠ è½½å®Œæˆ');
                    callback();
                } else if (attempts < maxAttempts) {
                    console.log(`èƒŒåŒ…ç³»ç»Ÿï¼šç­‰å¾…ç³»ç»ŸåŠ è½½... (${attempts}/${maxAttempts})`);
                    setTimeout(checkSystems, 100);
                } else {
                    console.error('èƒŒåŒ…ç³»ç»Ÿï¼šç³»ç»ŸåŠ è½½è¶…æ—¶');
                    callback();
                }
            };
            
            checkSystems();
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const currentUser = localStorage.getItem('currentUser');
            
            if (!isLoggedIn || !currentUser) {
                console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                window.location.href = 'login.html';
                return false;
            }
            
            return true;
        }
        
        // åˆå§‹åŒ–ç²’å­æ•ˆæœ
        function initParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 25;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
            
            // æ·»åŠ äº¤äº’ç²’å­
            for (let i = 0; i < 5; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle interactive';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.animationDuration = (10 + Math.random() * 5) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // ç”¨æˆ·ä¸‹æ‹‰èœå•
            const userInfo = document.getElementById('userInfo');
            if (userInfo) {
                userInfo.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userInfo.classList.toggle('active');
                });
                
                document.addEventListener('click', () => {
                    userInfo.classList.remove('active');
                });
            }
            
            // é€€å‡ºç™»å½•
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    logout();
                });
            }
            
            // ä¾§è¾¹æ èœå•é¡¹
            const menuItems = document.querySelectorAll('.sidebar-menu-link');
            menuItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const category = item.dataset.category;
                    if (category) {
                        filterByCategory(category);
                        // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                        menuItems.forEach(mi => mi.classList.remove('active'));
                        item.classList.add('active');
                    }
                });
            });
            
            // æ“ä½œæŒ‰é’®
            const sortBtn = document.getElementById('sortBtn');
            if (sortBtn) {
                sortBtn.addEventListener('click', () => {
                    sortBagItems();
                });
            }
            
            const organizeBtn = document.getElementById('organizeBtn');
            if (organizeBtn) {
                organizeBtn.addEventListener('click', () => {
                    organizeBagItems();
                });
            }
            
            // è¯¦æƒ…é¢æ¿å…³é—­æŒ‰é’®
            const detailClose = document.getElementById('detailClose');
            if (detailClose) {
                detailClose.addEventListener('click', () => {
                    hideBagDetail();
                });
            }
        }
        
        // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
        function initPointsSystem() {
            console.log('èƒŒåŒ…ç³»ç»Ÿï¼šåˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ');
            
            if (window.pointsSystem) {
                // è®¢é˜…ç§¯åˆ†å˜åŠ¨äº‹ä»¶
                window.pointsSystem.subscribe((data) => {
                    console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿè®¢é˜…äº‹ä»¶', data);
                    updatePointsDisplay(data.newPoints);
                });
                
                // ç›‘å¬ç§¯åˆ†æ›´æ–°äº‹ä»¶
                window.addEventListener('pointsUpdated', (e) => {
                    console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†æ›´æ–°äº‹ä»¶', e.detail);
                    updatePointsDisplay(e.detail.newPoints);
                });
                
                // ç›‘å¬ç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶
                window.addEventListener('pointsDisplayUpdated', (e) => {
                    console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶', e.detail);
                    updatePointsDisplay(e.detail.points);
                });
                
                // åˆå§‹æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
                const currentPoints = window.pointsSystem.getPoints();
                updatePointsDisplay(currentPoints);
                
                console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå½“å‰ç§¯åˆ†', currentPoints);
            } else {
                console.error('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿæœªæ‰¾åˆ°');
            }
        }
        
        // åŠ è½½èƒŒåŒ…æ•°æ®
        function loadBagData() {
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const userId = user.id || user.username;
            
            // ä»localStorageåŠ è½½èƒŒåŒ…æ•°æ®
            const savedBagItems = localStorage.getItem(`bagItems_${userId}`);
            if (savedBagItems) {
                window.BagSystem.bagItems = JSON.parse(savedBagItems);
            } else {
                // å¦‚æœæ²¡æœ‰èƒŒåŒ…æ•°æ®ï¼Œåˆ›å»ºé»˜è®¤æ•°æ®
                window.BagSystem.bagItems = createDefaultBagItems();
                localStorage.setItem(`bagItems_${userId}`, JSON.stringify(window.BagSystem.bagItems));
            }
            
            // æ˜¾ç¤ºèƒŒåŒ…ç‰©å“
            window.BagSystem.displayBagItems();
            
            console.log('èƒŒåŒ…æ•°æ®åŠ è½½å®Œæˆ:', window.BagSystem.bagItems.length, 'ä¸ªç‰©å“');
        }
        
        // åˆ›å»ºé»˜è®¤èƒŒåŒ…ç‰©å“æ•°æ®
        function createDefaultBagItems() {
            return [
                {
                    id: 'item_1',
                    name: 'å¤æ´»å¸',
                    icon: 'ğŸ’°',
                    category: 'currency',
                    count: 5,
                    value: 100,
                    quality: 'common',
                    description: 'åœ¨æ¸¸æˆä¸­å¤±è´¥æ—¶å¯ä»¥ä½¿ç”¨ï¼Œé¿å…æŸå¤±ç§¯åˆ†',
                    obtainTime: new Date().toISOString(),
                    usable: true,
                    sellable: true
                },
                {
                    id: 'item_2',
                    name: 'ç§¯åˆ†åŠ å€å¡',
                    icon: 'ğŸ’',
                    category: 'item',
                    count: 2,
                    value: 300,
                    quality: 'rare',
                    description: '7å¤©å†…æ‰€æœ‰æ¸¸æˆç§¯åˆ†æ”¶ç›Šç¿»å€',
                    obtainTime: new Date().toISOString(),
                    usable: true,
                    sellable: true
                },
                {
                    id: 'item_3',
                    name: 'é™å®šçš®è‚¤',
                    icon: 'ğŸ¨',
                    category: 'skin',
                    count: 1,
                    value: 800,
                    quality: 'epic',
                    description: 'é™å®šç‰ˆæ¸¸æˆçš®è‚¤ï¼Œç¨€æœ‰æ”¶è—å“',
                    obtainTime: new Date().toISOString(),
                    usable: true,
                    sellable: true
                },
                {
                    id: 'item_4',
                    name: 'å¹¸è¿ç¬¦',
                    icon: 'ğŸ€',
                    category: 'item',
                    count: 3,
                    value: 200,
                    quality: 'rare',
                    description: 'å¢åŠ æ¸¸æˆå¹¸è¿å€¼ï¼Œæé«˜è·èƒœæ¦‚ç‡',
                    obtainTime: new Date().toISOString(),
                    usable: true,
                    sellable: true
                },
                {
                    id: 'item_5',
                    name: 'åŠ é€Ÿè¯æ°´',
                    icon: 'âš¡',
                    category: 'item',
                    count: 1,
                    value: 500,
                    quality: 'epic',
                    description: 'å‡å°‘æ¸¸æˆç­‰å¾…æ—¶é—´ï¼ŒåŠ å¿«æ¸¸æˆè¿›ç¨‹',
                    obtainTime: new Date().toISOString(),
                    usable: true,
                    sellable: true
                },
                {
                    id: 'item_6',
                    name: 'ç¥ç§˜ç›²ç›’',
                    icon: 'ğŸ',
                    category: 'item',
                    count: 1,
                    value: 1000,
                    quality: 'legendary',
                    description: 'æ‰“å¼€å¯è·å¾—éšæœºç¨€æœ‰ç‰©å“',
                    obtainTime: new Date().toISOString(),
                    usable: true,
                    sellable: false
                }
            ];
        }
        
        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const userName = document.getElementById('userName');
            const userPoints = document.getElementById('userPoints');
            
            if (user && userName && userPoints) {
                userName.textContent = user.name || 'æœªçŸ¥ç”¨æˆ·';
                // ä½¿ç”¨ç§¯åˆ†ç³»ç»Ÿè·å–ç§¯åˆ†
                const points = window.pointsSystem ? 
                    window.pointsSystem.getPoints() : 
                    (user.points || 0);
                userPoints.textContent = points;
            }
            
            // æ›´æ–°èƒŒåŒ…æ˜¾ç¤º
            if (window.BagSystem) {
                window.BagSystem.displayBagItems();
            }
        }
        
        // æŒ‰åˆ†ç±»è¿‡æ»¤èƒŒåŒ…ç‰©å“
        function filterByCategory(category) {
            if (window.BagSystem) {
                window.BagSystem.filterByCategory(category);
            }
        }
        
        // æ’åºèƒŒåŒ…ç‰©å“
        function sortBagItems() {
            if (window.BagSystem) {
                window.BagSystem.sortBagItems();
            }
        }
        
        // æ•´ç†èƒŒåŒ…ç‰©å“
        function organizeBagItems() {
            if (window.BagSystem) {
                window.BagSystem.organizeBagItems();
            }
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            if (window.userSystem) {
                window.userSystem.logout();
            } else {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('currentUser');
                showNotification('info', 'é€€å‡ºç™»å½•', 'æ‚¨å·²æˆåŠŸé€€å‡ºç™»å½•');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1000);
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(type, title, message) {
            try {
                // ç§»é™¤ç°æœ‰é€šçŸ¥
                const existing = document.querySelector('.notification');
                if (existing) existing.remove();
                
                // åˆ›å»ºæ–°é€šçŸ¥
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-icon">${type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â„¹ï¸'}</div>
                    <div class="notification-content">
                        <div class="notification-title">${title}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => notification.classList.add('show'), 100);
                
                // è‡ªåŠ¨éšè—
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            } catch (error) {
                console.error('æ˜¾ç¤ºé€šçŸ¥å¤±è´¥:', error);
            }
        }
        
        // èƒŒåŒ…ç³»ç»Ÿ - å®Œæ•´ç‰ˆ
        window.BagSystem = {
            // å½“å‰é€‰ä¸­çš„åˆ†ç±»
            currentCategory: 'all',
            
            // èƒŒåŒ…ç‰©å“æ•°æ®
            bagItems: [],
            
            // å½“å‰é€‰ä¸­çš„ç‰©å“
            selectedItem: null,
            
            // åˆå§‹åŒ–
            init() {
                console.log('=== èƒŒåŒ…ç³»ç»Ÿåˆå§‹åŒ– ===');
                
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                if (!this.checkLoginStatus()) {
                    return;
                }
                
                // åˆå§‹åŒ–ç²’å­æ•ˆæœ
                this.initParticles();
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
                this.initEventListeners();
                
                // ç­‰å¾…å…¶ä»–ç³»ç»ŸåŠ è½½å®Œæˆ
                this.waitForSystems(() => {
                    // åŠ è½½èƒŒåŒ…æ•°æ®
                    this.loadBagData();
                    
                    // æ›´æ–°UI
                    this.updateUI();
                    
                    // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
                    this.initPointsSystem();
                    
                    console.log('èƒŒåŒ…ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                });
            },
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkLoginStatus() {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const currentUser = localStorage.getItem('currentUser');
                
                if (!isLoggedIn || !currentUser) {
                    console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                    window.location.href = 'login.html';
                    return false;
                }
                
                return true;
            },
            
            // åˆå§‹åŒ–ç²’å­æ•ˆæœ
            initParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 25;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 10 + 's';
                    particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                    particlesContainer.appendChild(particle);
                }
                
                // æ·»åŠ äº¤äº’ç²’å­
                for (let i = 0; i < 5; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle interactive';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 5 + 's';
                    particle.style.animationDuration = (10 + Math.random() * 5) + 's';
                    particlesContainer.appendChild(particle);
                }
            },
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners() {
                // ç”¨æˆ·ä¸‹æ‹‰èœå•
                const userInfo = document.getElementById('userInfo');
                if (userInfo) {
                    userInfo.addEventListener('click', (e) => {
                        e.stopPropagation();
                        userInfo.classList.toggle('active');
                    });
                    
                    document.addEventListener('click', () => {
                        userInfo.classList.remove('active');
                    });
                }
                
                // é€€å‡ºç™»å½•
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.logout();
                    });
                }
                
                // ä¾§è¾¹æ èœå•é¡¹
                const menuItems = document.querySelectorAll('.sidebar-menu-link');
                menuItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const category = item.dataset.category;
                        if (category) {
                            this.filterByCategory(category);
                            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                            menuItems.forEach(mi => mi.classList.remove('active'));
                            item.classList.add('active');
                        }
                    });
                });
                
                // æ“ä½œæŒ‰é’®
                const sortBtn = document.getElementById('sortBtn');
                if (sortBtn) {
                    sortBtn.addEventListener('click', () => {
                        this.sortBagItems();
                    });
                }
                
                const organizeBtn = document.getElementById('organizeBtn');
                if (organizeBtn) {
                    organizeBtn.addEventListener('click', () => {
                        this.organizeBagItems();
                    });
                }
                
                // è¯¦æƒ…é¢æ¿å…³é—­æŒ‰é’®
                const detailClose = document.getElementById('detailClose');
                if (detailClose) {
                    detailClose.addEventListener('click', () => {
                        this.hideBagDetail();
                    });
                }
            },
            
            // ç­‰å¾…å…¶ä»–ç³»ç»ŸåŠ è½½å®Œæˆ
            waitForSystems(callback) {
                let attempts = 0;
                const maxAttempts = 50;
                
                const checkSystems = () => {
                    attempts++;
                    
                    if (window.pointsSystem && window.pointsSystem.isInitialized && 
                        window.userSystem && window.userSystem.isLoggedIn) {
                        console.log('èƒŒåŒ…ç³»ç»Ÿï¼šæ‰€æœ‰ç³»ç»Ÿå·²åŠ è½½å®Œæˆ');
                        callback();
                    } else if (attempts < maxAttempts) {
                        console.log(`èƒŒåŒ…ç³»ç»Ÿï¼šç­‰å¾…ç³»ç»ŸåŠ è½½... (${attempts}/${maxAttempts})`);
                        setTimeout(checkSystems, 100);
                    } else {
                        console.error('èƒŒåŒ…ç³»ç»Ÿï¼šç³»ç»ŸåŠ è½½è¶…æ—¶');
                        callback();
                    }
                };
                
                checkSystems();
            },
            
            // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
            initPointsSystem() {
                console.log('èƒŒåŒ…ç³»ç»Ÿï¼šåˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ');
                
                if (window.pointsSystem) {
                    // è®¢é˜…ç§¯åˆ†å˜åŠ¨äº‹ä»¶
                    window.pointsSystem.subscribe((data) => {
                        console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿè®¢é˜…äº‹ä»¶', data);
                        this.updatePointsDisplay(data.newPoints);
                    });
                    
                    // ç›‘å¬ç§¯åˆ†æ›´æ–°äº‹ä»¶
                    window.addEventListener('pointsUpdated', (e) => {
                        console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†æ›´æ–°äº‹ä»¶', e.detail);
                        this.updatePointsDisplay(e.detail.newPoints);
                    });
                    
                    // ç›‘å¬ç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶
                    window.addEventListener('pointsDisplayUpdated', (e) => {
                        console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶', e.detail);
                        this.updatePointsDisplay(e.detail.points);
                    });
                    
                    // åˆå§‹æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
                    const currentPoints = window.pointsSystem.getPoints();
                    this.updatePointsDisplay(currentPoints);
                    
                    console.log('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå½“å‰ç§¯åˆ†', currentPoints);
                } else {
                    console.error('èƒŒåŒ…ç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿæœªæ‰¾åˆ°');
                }
            },
            
            // åŠ è½½èƒŒåŒ…æ•°æ®
            loadBagData() {
                const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const userId = user.id || user.username;
                
                // ä»localStorageåŠ è½½èƒŒåŒ…æ•°æ®
                const savedBagItems = localStorage.getItem(`bagItems_${userId}`);
                if (savedBagItems) {
                    this.bagItems = JSON.parse(savedBagItems);
                } else {
                    // å¦‚æœæ²¡æœ‰èƒŒåŒ…æ•°æ®ï¼Œåˆ›å»ºé»˜è®¤æ•°æ®
                    this.bagItems = this.createDefaultBagItems();
                    localStorage.setItem(`bagItems_${userId}`, JSON.stringify(this.bagItems));
                }
                
                // æ˜¾ç¤ºèƒŒåŒ…ç‰©å“
                this.displayBagItems();
                
                console.log('èƒŒåŒ…æ•°æ®åŠ è½½å®Œæˆ:', this.bagItems.length, 'ä¸ªç‰©å“');
            },
            
            // åˆ›å»ºé»˜è®¤èƒŒåŒ…ç‰©å“æ•°æ®
            createDefaultBagItems() {
                return [
                    {
                        id: 'item_1',
                        name: 'å¤æ´»å¸',
                        icon: 'ğŸ’°',
                        category: 'currency',
                        count: 5,
                        value: 100,
                        quality: 'common',
                        description: 'åœ¨æ¸¸æˆä¸­å¤±è´¥æ—¶å¯ä»¥ä½¿ç”¨ï¼Œé¿å…æŸå¤±ç§¯åˆ†',
                        obtainTime: new Date().toISOString(),
                        usable: true,
                        sellable: true
                    },
                    {
                        id: 'item_2',
                        name: 'ç§¯åˆ†åŠ å€å¡',
                        icon: 'ğŸ’',
                        category: 'item',
                        count: 2,
                        value: 300,
                        quality: 'rare',
                        description: '7å¤©å†…æ‰€æœ‰æ¸¸æˆç§¯åˆ†æ”¶ç›Šç¿»å€',
                        obtainTime: new Date().toISOString(),
                        usable: true,
                        sellable: true
                    },
                    {
                        id: 'item_3',
                        name: 'é™å®šçš®è‚¤',
                        icon: 'ğŸ¨',
                        category: 'skin',
                        count: 1,
                        value: 800,
                        quality: 'epic',
                        description: 'é™å®šç‰ˆæ¸¸æˆçš®è‚¤ï¼Œç¨€æœ‰æ”¶è—å“',
                        obtainTime: new Date().toISOString(),
                        usable: true,
                        sellable: true
                    },
                    {
                        id: 'item_4',
                        name: 'å¹¸è¿ç¬¦',
                        icon: 'ğŸ€',
                        category: 'item',
                        count: 3,
                        value: 200,
                        quality: 'rare',
                        description: 'å¢åŠ æ¸¸æˆå¹¸è¿å€¼ï¼Œæé«˜è·èƒœæ¦‚ç‡',
                        obtainTime: new Date().toISOString(),
                        usable: true,
                        sellable: true
                    },
                    {
                        id: 'item_5',
                        name: 'åŠ é€Ÿè¯æ°´',
                        icon: 'âš¡',
                        category: 'item',
                        count: 1,
                        value: 500,
                        quality: 'epic',
                        description: 'å‡å°‘æ¸¸æˆç­‰å¾…æ—¶é—´ï¼ŒåŠ å¿«æ¸¸æˆè¿›ç¨‹',
                        obtainTime: new Date().toISOString(),
                        usable: true,
                        sellable: true
                    },
                    {
                        id: 'item_6',
                        name: 'ç¥ç§˜ç›²ç›’',
                        icon: 'ğŸ',
                        category: 'item',
                        count: 1,
                        value: 1000,
                        quality: 'legendary',
                        description: 'æ‰“å¼€å¯è·å¾—éšæœºç¨€æœ‰ç‰©å“',
                        obtainTime: new Date().toISOString(),
                        usable: true,
                        sellable: false
                    }
                ];
            },
            
            // æ˜¾ç¤ºèƒŒåŒ…ç‰©å“
            displayBagItems() {
                const bagGrid = document.getElementById('bagGrid');
                if (!bagGrid) return;
                
                // è¿‡æ»¤ç‰©å“
                let filteredItems = this.bagItems;
                if (this.currentCategory !== 'all') {
                    filteredItems = this.bagItems.filter(item => item.category === this.currentCategory);
                }
                
                if (filteredItems.length === 0) {
                    bagGrid.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-icon">ğŸ’</div>
                            <div class="empty-title">èƒŒåŒ…æ˜¯ç©ºçš„</div>
                            <div class="empty-desc">æ‚¨è¿˜æ²¡æœ‰ä»»ä½•ç‰©å“</div>
                        </div>
                    `;
                    return;
                }
                
                bagGrid.innerHTML = filteredItems.map(item => {
                    return `
                        <div class="bag-item ${item.selected ? 'selected' : ''}" onclick="selectBagItem('${item.id}')">
                            ${item.quality ? `<div class="bag-item-quality ${item.quality}">${this.getQualityName(item.quality)}</div>` : ''}
                            <div class="bag-item-icon">${item.icon}</div>
                            <div class="bag-item-name">${item.name}</div>
                            <div class="bag-item-count">Ã—${item.count}</div>
                        </div>
                    `;
                }).join('');
                
                // æ›´æ–°ç»Ÿè®¡
                this.updateBagStats();
            },
            
            // æŒ‰åˆ†ç±»è¿‡æ»¤èƒŒåŒ…ç‰©å“
            filterByCategory(category) {
                this.currentCategory = category;
                this.displayBagItems();
            },
            
            // é€‰æ‹©èƒŒåŒ…ç‰©å“
            selectBagItem(itemId) {
                const item = this.bagItems.find(item => item.id === itemId);
                if (!item) return;
                
                this.selectedItem = item;
                
                // æ›´æ–°é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.bag-item').forEach(itemElement => {
                    itemElement.classList.remove('selected');
                });
                document.querySelector(`[onclick="selectBagItem('${itemId}')"]`).classList.add('selected');
                
                // æ˜¾ç¤ºç‰©å“è¯¦æƒ…
                this.showBagDetail(item);
            },
            
            // æ˜¾ç¤ºèƒŒåŒ…ç‰©å“è¯¦æƒ…
            showBagDetail(item) {
                const detailPanel = document.getElementById('bagDetailPanel');
                if (!detailPanel) return;
                
                // æ›´æ–°è¯¦æƒ…å†…å®¹
                document.getElementById('detailIcon').textContent = item.icon;
                document.getElementById('detailName').textContent = item.name;
                document.getElementById('detailDesc').textContent = item.description;
                
                // ç”Ÿæˆå±æ€§ä¿¡æ¯
                let statsHtml = `
                    <div class="detail-stat">
                        <div class="detail-stat-label">ç¨€æœ‰åº¦</div>
                        <div class="detail-stat-value">${this.getQualityName(item.quality)}</div>
                    </div>
                    <div class="detail-stat">
                        <div class="detail-stat-label">æ•°é‡</div>
                        <div class="detail-stat-value">Ã—${item.count}</div>
                    </div>
                    <div class="detail-stat">
                        <div class="detail-stat-label">ä»·å€¼</div>
                        <div class="detail-stat-value">ğŸ’° ${item.value}</div>
                    </div>
                    <div class="detail-stat">
                        <div class="detail-stat-label">è·å¾—æ—¶é—´</div>
                        <div class="detail-stat-value">${this.formatTime(item.obtainTime)}</div>
                    </div>
                    <div class="detail-stat">
                        <div class="detail-stat-label">æ€»ä»·å€¼</div>
                        <div class="detail-stat-value">ğŸ’° ${item.count * item.value}</div>
                    </div>
                `;
                
                document.getElementById('detailStats').innerHTML = statsHtml;
                
                // ç”Ÿæˆæ“ä½œæŒ‰é’®
                let actionsHtml = '';
                
                if (item.usable) {
                    actionsHtml += `
                        <button class="detail-btn" onclick="useBagItem('${item.id}'); this.closest('.bag-detail-panel').remove();">
                            <i class="fas fa-hand-pointer"></i>
                            <span>ä½¿ç”¨ç‰©å“</span>
                        </button>
                    `;
                }
                
                actionsHtml += `
                    <button class="detail-btn secondary" onclick="viewBagItem('${item.id}'); this.closest('.bag-detail-panel').remove();">
                        <i class="fas fa-info-circle"></i>
                        <span>æŸ¥çœ‹è¯¦æƒ…</span>
                    </button>
                `;
                
                if (item.sellable) {
                    actionsHtml += `
                        <button class="detail-btn secondary" onclick="sellBagItem('${item.id}'); this.closest('.bag-detail-panel').remove();">
                            <i class="fas fa-coins"></i>
                            <span>å‡ºå”®</span>
                        </button>
                    `;
                }
                
                document.getElementById('detailActions').innerHTML = actionsHtml;
                
                // æ˜¾ç¤ºé¢æ¿
                detailPanel.style.display = 'block';
            },
            
            // éšè—èƒŒåŒ…ç‰©å“è¯¦æƒ…
            hideBagDetail() {
                const detailPanel = document.getElementById('bagDetailPanel');
                if (detailPanel) {
                    detailPanel.style.display = 'none';
                }
                this.selectedItem = null;
            },
            
            // ä½¿ç”¨èƒŒåŒ…ç‰©å“
            useBagItem(itemId) {
                const item = this.bagItems.find(item => item.id === itemId);
                
                if (!item || !item.usable) {
                    this.showNotification('error', 'ä½¿ç”¨ç‰©å“å¤±è´¥', 'ç‰©å“ä¸å­˜åœ¨æˆ–ä¸å¯ä½¿ç”¨');
                    return;
                }
                
                if (item.count <= 0) {
                    this.showNotification('error', 'ä½¿ç”¨ç‰©å“å¤±è´¥', 'ç‰©å“æ•°é‡ä¸è¶³');
                    return;
                }
                
                // æ ¹æ®ç‰©å“ç±»å‹æ‰§è¡Œä¸åŒæ•ˆæœ
                switch (item.id) {
                    case 'item_1': // å¤æ´»å¸
                        this.useReviveCoin(item);
                        break;
                    case 'item_2': // ç§¯åˆ†åŠ å€å¡
                        this.useDoublePointsCard(item);
                        break;
                    case 'item_4': // å¹¸è¿ç¬¦
                        this.useLuckyCharm(item);
                        break;
                    case 'item_5': // åŠ é€Ÿè¯æ°´
                        this.useSpeedBoost(item);
                        break;
                    case 'item_6': // ç¥ç§˜ç›²ç›’
                        this.openMysteryBox(item);
                        break;
                    default:
                        this.showNotification('info', 'ä½¿ç”¨ç‰©å“', `ä½¿ç”¨${item.name}`);
                        break;
                }
                
                // æ›´æ–°æ˜¾ç¤º
                this.displayBagItems();
            },
            
            // ä½¿ç”¨å¤æ´»å¸
            useReviveCoin(item) {
                // æ¿€æ´»å¤æ´»å¸æ•ˆæœ
                this.showNotification('success', 'ä½¿ç”¨å¤æ´»å¸', 'ä¸‹æ¬¡å¤±è´¥æ—¶è‡ªåŠ¨å¤æ´»ï¼Œä¸æŸå¤±ç§¯åˆ†');
                item.count--;
                
                if (item.count <= 0) {
                    // ä»èƒŒåŒ…ä¸­ç§»é™¤
                    const index = this.bagItems.findIndex(i => i.id === item.id);
                    if (index > -1) {
                        this.bagItems.splice(index, 1);
                    }
                }
                
                this.saveBagData();
                this.showNotification('success', 'ä½¿ç”¨æˆåŠŸ', 'å¤æ´»å¸å·²æ¿€æ´»');
            },
            
            // ä½¿ç”¨ç§¯åˆ†åŠ å€å¡
            useDoublePointsCard(item) {
                // æ¿€æ´»ç§¯åˆ†åŠ å€æ•ˆæœ
                const duration = 7 * 24 * 60 * 60 * 1000; // 7å¤©çš„æ¯«ç§’æ•°
                const endTime = Date.now() + duration;
                
                localStorage.setItem('doublePointsActive', 'true');
                localStorage.setItem('doublePointsEndTime', endTime.toString());
                
                item.count--;
                
                if (item.count <= 0) {
                    // ä»èƒŒåŒ…ä¸­ç§»é™¤
                    const index = this.bagItems.findIndex(i => i.id === item.id);
                    if (index > -1) {
                        this.bagItems.splice(index, 1);
                    }
                }
                
                this.saveBagData();
                this.showNotification('success', 'ä½¿ç”¨æˆåŠŸ', 'ç§¯åˆ†åŠ å€å·²æ¿€æ´»ï¼ŒæŒç»­7å¤©');
            },
            
            // ä½¿ç”¨å¹¸è¿ç¬¦
            useLuckyCharm(item) {
                // å¢åŠ å¹¸è¿å€¼
                this.showNotification('success', 'ä½¿ç”¨å¹¸è¿ç¬¦', 'å¹¸è¿å€¼æå‡ï¼Œä¸‹æ¬¡æ¸¸æˆè·èƒœæ¦‚ç‡å¢åŠ ');
                item.count--;
                
                if (item.count <= 0) {
                    // ä»èƒŒåŒ…ä¸­ç§»é™¤
                    const index = this.bagItems.findIndex(i => i.id === item.id);
                    if (index > -1) {
                        this.bagItems.splice(index, 1);
                    }
                }
                
                this.saveBagData();
                this.showNotification('success', 'ä½¿ç”¨æˆåŠŸ', 'å¹¸è¿ç¬¦å·²ä½¿ç”¨');
            },
            
            // ä½¿ç”¨åŠ é€Ÿè¯æ°´
            useSpeedBoost(item) {
                // å‡å°‘ç­‰å¾…æ—¶é—´
                this.showNotification('success', 'ä½¿ç”¨åŠ é€Ÿè¯æ°´', 'æ¸¸æˆé€Ÿåº¦æå‡ï¼Œç­‰å¾…æ—¶é—´å‡å°‘');
                item.count--;
                
                if (item.count <= 0) {
                    // ä»èƒŒåŒ…ä¸­ç§»é™¤
                    const index = this.bagItems.findIndex(i => i.id === item.id);
                    if (index > -1) {
                        this.bagItems.splice(index, 1);
                    }
                }
                
                this.saveBagData();
                this.showNotification('success', 'ä½¿ç”¨æˆåŠŸ', 'åŠ é€Ÿè¯æ°´å·²ä½¿ç”¨');
            },
            
            // æ‰“å¼€ç¥ç§˜ç›²ç›’
            openMysteryBox(item) {
                // éšæœºè·å¾—ç‰©å“
                const possibleItems = [
                    { id: 'item_1', count: 1 },
                    { id: 'item_2', count: 1 },
                    { id: 'item_3', count: 1 },
                    { id: 'item_4', count: 1 },
                    { id: 'item_5', count: 1 }
                ];
                
                const randomItem = possibleItems[Math.floor(Math.random() * possibleItems.length)];
                const newItem = this.createItemFromTemplate(randomItem.id, randomItem.count);
                
                // æ·»åŠ åˆ°èƒŒåŒ…
                this.bagItems.push(newItem);
                
                // ç§»é™¤ç›²ç›’
                item.count--;
                
                if (item.count <= 0) {
                    // ä»èƒŒåŒ…ä¸­ç§»é™¤
                    const index = this.bagItems.findIndex(i => i.id === item.id);
                    if (index > -1) {
                        this.bagItems.splice(index, 1);
                    }
                }
                
                this.saveBagData();
                this.displayBagItems();
                this.showNotification('success', 'å¼€ç®±æˆåŠŸ', `è·å¾—${newItem.name}Ã—${newItem.count}`);
            },
            
            // ä»æ¨¡æ¿åˆ›å»ºç‰©å“
            createItemFromTemplate(templateId, count) {
                const templates = {
                    'item_1': { name: 'å¤æ´»å¸', icon: 'ğŸ’°', category: 'currency', value: 100, quality: 'common' },
                    'item_2': { name: 'ç§¯åˆ†åŠ å€å¡', icon: 'ğŸ’', category: 'item', value: 300, quality: 'rare' },
                    'item_3': { name: 'é™å®šçš®è‚¤', icon: 'ğŸ¨', category: 'skin', value: 800, quality: 'epic' },
                    'item_4': { name: 'å¹¸è¿ç¬¦', icon: 'ğŸ€', category: 'item', value: 200, quality: 'rare' },
                    'item_5': { name: 'åŠ é€Ÿè¯æ°´', icon: 'âš¡', category: 'item', value: 500, quality: 'epic' }
                };
                
                const template = templates[templateId];
                if (!template) {
                    return null;
                }
                
                return {
                    id: `${templateId}_${Date.now()}`,
                    name: template.name,
                    icon: template.icon,
                    category: template.category,
                    count: count,
                    value: template.value,
                    quality: template.quality,
                    description: `ä»ç¥ç§˜ç›²ç›’è·å¾—çš„${template.name}`,
                    obtainTime: new Date().toISOString(),
                    usable: true,
                    sellable: true
                };
            },
            
            // æŸ¥çœ‹èƒŒåŒ…ç‰©å“è¯¦æƒ…
            viewBagItem(itemId) {
                const item = this.bagItems.find(item => item.id === itemId);
                if (!item) {
                    this.showNotification('error', 'æŸ¥çœ‹å¤±è´¥', 'ç‰©å“ä¸å­˜åœ¨');
                    return;
                }
                
                this.showBagDetail(item);
            },
            
            // å‡ºå”®èƒŒåŒ…ç‰©å“
            sellBagItem(itemId) {
                const item = this.bagItems.find(item => item.id === itemId);
                
                if (!item || !item.sellable) {
                    this.showNotification('error', 'å‡ºå”®å¤±è´¥', 'è¯¥ç‰©å“ä¸å¯å‡ºå”®');
                    return;
                }
                
                const sellPrice = Math.floor(item.value * 0.5); // 50%å‡ºå”®ä»·æ ¼
                const sellCount = item.count;
                const totalValue = sellPrice * sellCount;
                
                // è·å¾—ç§¯åˆ†
                if (window.pointsSystem) {
                    const result = window.pointsSystem.addPoints(totalValue, 'å‡ºå”®' + item.name);
                    
                    if (result.success) {
                        this.showNotification('success', 'å‡ºå”®æˆåŠŸ', `æˆåŠŸå‡ºå”®${sellCount}ä¸ª${item.name}ï¼Œè·å¾—${totalValue}ç§¯åˆ†`);
                    } else {
                        this.showNotification('error', 'å‡ºå”®å¤±è´¥', result.error);
                    }
                }
                
                // ä»èƒŒåŒ…ä¸­ç§»é™¤
                const index = this.bagItems.findIndex(item => item.id === itemId);
                if (index > -1) {
                    this.bagItems.splice(index, 1);
                }
                
                // ä¿å­˜æ•°æ®
                this.saveBagData();
                
                // æ›´æ–°æ˜¾ç¤º
                this.displayBagItems();
                
                this.showNotification('success', 'å‡ºå”®æˆåŠŸ', `æˆåŠŸå‡ºå”®${sellCount}ä¸ª${item.name}ï¼Œè·å¾—${totalValue}ç§¯åˆ†`);
            },
            
            // æ’åºèƒŒåŒ…ç‰©å“
            sortBagItems() {
                // æŒ‰ä»·å€¼ä»é«˜åˆ°ä½æ’åº
                this.bagItems.sort((a, b) => b.value - a.value);
                
                // æŒ‰ç¨€æœ‰åº¦ä»é«˜åˆ°ä½æ’åº
                const rarityOrder = { 'legendary': 4, 'epic': 3, 'rare': 2, 'common': 1 };
                this.bagItems.sort((a, b) => {
                    const rarityA = rarityOrder[a.quality] || 0;
                    const rarityB = rarityOrder[b.quality] || 0;
                    return rarityB - rarityA;
                });
                
                this.saveBagData();
                this.displayBagItems();
                this.showNotification('info', 'æ’åºå®Œæˆ', 'ç‰©å“å·²æŒ‰ä»·å€¼å’Œç¨€æœ‰åº¦æ’åº');
            },
            
            // æ•´ç†èƒŒåŒ…ç‰©å“
            organizeBagItems() {
                // æŒ‰åˆ†ç±»æ•´ç†
                const categories = ['currency', 'item', 'equipment', 'skin', 'other'];
                const organizedItems = [];
                
                categories.forEach(category => {
                    const items = this.bagItems.filter(item => item.category === category);
                    organizedItems.push(...items);
                });
                
                // æŒ‰ç¨€æœ‰åº¦ä»é«˜åˆ°ä½æ’åº
                organizedItems.sort((a, b) => {
                    const rarityOrder = { 'legendary': 4, 'epic': 3, 'rare': 2, 'common': 1 };
                    const rarityA = rarityOrder[a.quality] || 0;
                    const rarityB = rarityOrder[b.quality] || 0;
                    return rarityB - rarityA;
                });
                
                this.bagItems = organizedItems;
                this.saveBagData();
                this.displayBagItems();
                this.showNotification('info', 'æ•´ç†å®Œæˆ', 'ç‰©å“å·²æŒ‰åˆ†ç±»å’Œç¨€æœ‰åº¦æ•´ç†');
            },
            
            // è®¡ç®—èƒŒåŒ…æ€»ä»·å€¼
            calculateBagValue() {
                return this.bagItems.reduce((total, item) => total + (item.count * item.value));
            },
            
            // ä¿å­˜èƒŒåŒ…æ•°æ®
            saveBagData() {
                const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const userId = user.id || user.username;
                localStorage.setItem(`bagItems_${userId}`, JSON.stringify(this.bagItems));
            },
            
            // æ›´æ–°èƒŒåŒ…ç»Ÿè®¡
            updateBagStats() {
                // æ›´æ–°åˆ†ç±»æ•°é‡
                const categories = ['all', 'doll', 'item', 'equipment', 'skin', 'currency', 'other'];
                categories.forEach(category => {
                    const count = category === 'all' ? 
                        this.bagItems.length : 
                        this.bagItems.filter(item => item.category === category).length;
                    
                    const countElement = document.getElementById(`${category}Items`);
                    if (countElement) {
                        countElement.textContent = count;
                    }
                });
                
                // æ›´æ–°æ€»ç‰©å“å’Œæ€»ä»·å€¼
                const totalItems = document.getElementById('bagTotalItems');
                const totalValue = document.getElementById('bagTotalValue');
                
                if (totalItems) totalItems.textContent = this.bagItems.length;
                if (totalValue) totalValue.textContent = this.calculateBagValue();
            },
            
            // è·å–ç¨€æœ‰åº¦åç§°
            getQualityName(quality) {
                const qualityTexts = {
                    'common': 'æ™®é€š',
                    'rare': 'ç¨€æœ‰',
                    'epic': 'å²è¯—',
                    'legendary': 'ä¼ è¯´'
                };
                return qualityTexts[quality] || 'æ™®é€š';
            },
            
            // æ ¼å¼åŒ–æ—¶é—´
            formatTime(timeString) {
                const date = new Date(timeString);
                const now = new Date();
                const diff = now - date;
                
                if (diff < 60000) {
                    return 'åˆšåˆš';
                } else if (diff < 86400000) {
                    return Math.floor(diff / 86400000) + 'å¤©å‰';
                } else if (diff < 2592000000) {
                    return Math.floor(diff / 86400000) + 'å¤©å‰';
                } else {
                    return 'å¾ˆä¹…ä»¥å‰';
                }
            },
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
            updateUserInfo(user) {
                try {
                    const userName = document.getElementById('userName');
                    const userPoints = document.getElementById('userPoints');
                    
                    if (user && userName && userPoints) {
                        userName.textContent = user.name || 'æœªçŸ¥ç”¨æˆ·';
                        // ä½¿ç”¨ç§¯åˆ†ç³»ç»Ÿè·å–ç§¯åˆ†
                        const points = window.pointsSystem ? 
                            window.pointsSystem.getPoints() : 
                            (user.points || 0);
                        userPoints.textContent = points;
                    }
                } catch (error) {
                    console.error('èƒŒåŒ…ç³»ç»Ÿï¼šæ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºå¤±è´¥', error);
                }
            },
            
            // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º - ä¿®å¤ç‰ˆ
            updatePointsDisplay(points) {
                console.log('èƒŒåŒ…ç³»ç»Ÿï¼šæ›´æ–°ç§¯åˆ†æ˜¾ç¤º', points);
                
                // æ›´æ–°æ‰€æœ‰æ˜¾ç¤ºç§¯åˆ†çš„å…ƒç´ 
                const pointsElements = document.querySelectorAll('[id*="userPoints"], [class*="user-points"]');
                pointsElements.forEach(element => {
                    if (element.tagName === 'SPAN') {
                        element.textContent = points;
                    } else if (element.tagName === 'DIV') {
                        const span = element.querySelector('span');
                        if (span) {
                            span.textContent = points;
                        } else {
                            element.textContent = `ğŸ’° ${points}`;
                        }
                    }
                });
                
                // è§¦å‘ç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶
                window.dispatchEvent(new CustomEvent('pointsDisplayUpdated', { points }));
            },
            
            // é€€å‡ºç™»å½•
            logout() {
                try {
                    // ä½¿ç”¨ç”¨æˆ·ç³»ç»Ÿé€€å‡º
                    if (window.userSystem) {
                        window.userSystem.logout();
                    } else {
                        // å¤‡ç”¨æ–¹æ¡ˆ
                        localStorage.removeItem('isLoggedIn');
                        localStorage.removeItem('currentUser');
                        this.showNotification('info', 'é€€å‡ºç™»å½•', 'æ‚¨å·²æˆåŠŸé€€å‡ºç™»å½•');
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 1000);
                    }
                } catch (error) {
                    console.error('èƒŒåŒ…ç³»ç»Ÿï¼šé€€å‡ºç™»å½•å¤±è´¥', error);
                }
            },
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(type, title, message) {
                try {
                    // ç§»é™¤ç°æœ‰é€šçŸ¥
                    const existing = document.querySelector('.notification');
                    if (existing) existing.remove();
                    
                    // åˆ›å»ºæ–°é€šçŸ¥
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    notification.innerHTML = `
                        <div class="notification-icon">${type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â„¹ï¸'}</div>
                        <div class="notification-content">
                            <div class="notification-title">${title}</div>
                            <div class="notification-message">${message}</div>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // æ˜¾ç¤ºåŠ¨ç”»
                    setTimeout(() => notification.classList.add('show'), 100);
                    
                    // è‡ªåŠ¨éšè—
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                } catch (error) {
                    console.error('èƒŒåŒ…ç³»ç»Ÿï¼šæ˜¾ç¤ºé€šçŸ¥å¤±è´¥', error);
                }
            }
        };
        
        // å…¨å±€å‡½æ•°
        function filterByCategory(category) {
            if (window.BagSystem) {
                window.BagSystem.filterByCategory(category);
            }
        }
        
        function selectBagItem(itemId) {
            if (window.BagSystem) {
                window.BagSystem.selectBagItem(itemId);
            }
        }
        
        function viewBagItem(itemId) {
            if (window.BagSystem) {
                window.BagSystem.viewBagItem(itemId);
            }
        }
        
        function sellBagItem(itemId) {
            if (window.BagSystem) {
                window.BagSystem.sellBagItem(itemId);
            }
        }
        
        function sortBagItems() {
            if (window.BagSystem) {
                window.BagSystem.sortBagItems();
            }
        }
        
        function organizeBagItems() {
            if (window.BagSystem) {
                window.BagSystem.organizeBagItems();
            }
        }
        
        function useBagItem(itemId) {
            if (window.BagSystem) {
                window.BagSystem.useBagItem(itemId);
            }
        }
        
        function hideBagDetail() {
            if (window.BagSystem) {
                window.BagSystem.hideBagDetail();
            }
        }
        
        function logout() {
            if (window.BagSystem) {
                window.BagSystem.logout();
            }
        }
        
        function showNotification(type, title, message) {
            if (window.BagSystem) {
                window.BagSystem.showNotification(type, title, message);
            }
        }
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== èƒŒåŒ…ç³»ç»Ÿé¡µé¢åˆå§‹åŒ– ===');
            BagSystem.init();
        });
    </script>
</body>
</html>
