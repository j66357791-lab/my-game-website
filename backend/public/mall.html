<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©åˆ›å•†åŸ - å¤©åˆ›æ—¶ä»£</title>
    
    <!-- ä¼˜åŒ–å­—ä½“åŠ è½½ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* è¿™é‡Œä¿æŒæ‚¨åŸæœ‰çš„æ‰€æœ‰CSSæ ·å¼ä¸å˜ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF7043;
            --secondary: #FFB74D;
            --accent: #FFC107;
            --bg-dark: #2C3E50;
            --bg-light: #34495E;
            --text-light: #ECF0F1;
            --gradient: linear-gradient(135deg, #FF7043, #FFB74D, #FFC107);
            --shadow: 0 8px 25px rgba(255, 112, 67, 0.3);
            --transition: all 0.3s ease;
            --border-radius: 20px;
        }
        
        body {
            font-family: 'Noto Sans SC', 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* åŠ¨æ€èƒŒæ™¯ç²’å­ */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gradient);
            border-radius: 50%;
            opacity: 0.6;
            animation: particleFloat 20s linear infinite;
        }
        
        .particle.interactive {
            width: 6px;
            height: 6px;
            opacity: 0.8;
            animation: particleFloat 15s linear infinite;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-10vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* å¯¼èˆªæ  */
        .navbar {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--primary);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 2.2rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: logoGlow 3s ease-in-out infinite;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            animation: logoRotate 10s linear infinite;
        }
        
        @keyframes logoGlow {
            0%, 100% {
                filter: drop-shadow(0 0 20px rgba(255, 112, 67, 0.5));
            }
            50% {
                filter: drop-shadow(0 0 30px rgba(255, 112, 67, 0.8));
            }
        }
        
        @keyframes logoRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .settings-btn {
            background: rgba(255, 112, 67, 0.1);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .settings-btn:hover {
            background: rgba(255, 112, 67, 0.2);
            transform: rotate(30deg);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 112, 67, 0.1);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: 2px solid rgba(255, 112, 67, 0.3);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }
        
        .user-info:hover {
            background: rgba(255, 112, 67, 0.2);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            color: white;
            font-size: 0.95rem;
        }
        
        .user-points {
            background: var(--gradient);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1rem;
            margin-top: 0.5rem;
            min-width: 200px;
            box-shadow: var(--shadow);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 1001;
        }
        
        .user-info.active .user-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            color: var(--text-light);
            text-decoration: none;
        }
        
        .user-dropdown-item:hover {
            background: rgba(255, 112, 67, 0.1);
        }
        
        .user-dropdown-divider {
            height: 1px;
            background: rgba(255, 112, 67, 0.3);
            margin: 0.5rem 0;
        }
        
        /* ä¸»å†…å®¹ */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .page-title {
            font-size: 3rem;
            font-weight: 900;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            animation: fadeInDown 1s ease;
        }
        
        .page-subtitle {
            font-size: 1.3rem;
            color: var(--text-light);
            margin-bottom: 1rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease 0.3s;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å•†åŸå¸ƒå±€ */
        .mall-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 200px);
        }
        
        /* ä¾§è¾¹æ  */
        .mall-sidebar {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 112, 67, 0.3);
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .sidebar-subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .menu-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-light);
            text-decoration: none;
        }
        
        .menu-item:hover {
            background: rgba(255, 112, 67, 0.2);
            border-color: rgba(255, 112, 67, 0.4);
            transform: translateX(5px);
        }
        
        .menu-item.active {
            background: var(--gradient);
            border-color: var(--primary);
            color: white;
        }
        
        .menu-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        .menu-text {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .mall-main {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: var(--border-radius);
            padding: 2rem;
            overflow-y: auto;
        }
        
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 112, 67, 0.3);
        }
        
        .main-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .main-actions {
            display: flex;
            gap: 1rem;
        }
        
        .action-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .action-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* å•†å“ç½‘æ ¼ */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .product-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .product-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: var(--text-light);
        }
        
        .product-info {
            padding: 1.5rem;
        }
        
        .product-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .product-description {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .product-price {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent);
        }
        
        .product-stock {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .product-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .product-btn {
            flex: 1;
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .product-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .product-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .product-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* è´­ç‰©è½¦ */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border-left: 2px solid var(--primary);
            z-index: 1000;
            transition: var(--transition);
            overflow-y: auto;
        }
        
        .cart-sidebar.active {
            right: 0;
        }
        
        .cart-header {
            background: rgba(255, 112, 67, 0.2);
            padding: 1.5rem;
            border-bottom: 2px solid rgba(255, 112, 67, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }
        
        .cart-close {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-close:hover {
            background: rgba(255, 112, 67, 0.2);
            color: white;
        }
        
        .cart-content {
            padding: 1.5rem;
        }
        
        .cart-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .cart-item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--text-light);
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }
        
        .cart-item-price {
            color: var(--accent);
            font-weight: 600;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .quantity-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .quantity-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .quantity-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 50px;
            text-align: center;
            border-radius: 4px;
            padding: 0.25rem;
        }
        
        .cart-item-remove {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid rgba(231, 76, 60, 0.3);
            color: #e74c3c;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .cart-item-remove:hover {
            background: rgba(231, 76, 60, 0.3);
        }
        
        .cart-footer {
            background: rgba(255, 112, 67, 0.2);
            padding: 1.5rem;
            border-top: 2px solid rgba(255, 112, 67, 0.3);
            margin-top: auto;
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }
        
        .cart-checkout {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            text-align: center;
        }
        
        .cart-checkout:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-dark);
            backdrop-filter: blur(20px);
            padding: 1rem 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(400px);
            transition: var(--transition);
            max-width: 350px;
            border-left: 4px solid var(--accent);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left-color: #27AE60;
        }
        
        .notification.error {
            border-left-color: #E74C3C;
        }
        
        .notification.info {
            border-left-color: #3498DB;
        }
        
        .notification-icon {
            font-size: 1.3rem;
            color: var(--accent);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            color: white;
            margin-bottom: 0.2rem;
        }
        
        .notification-message {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .mall-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .mall-sidebar {
                display: none;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .main-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .main-actions {
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
            
            .cart-sidebar.active {
                right: 0;
            }
        }
    </style>
</head>
<body>
    <!-- åŠ¨æ€èƒŒæ™¯ç²’å­ -->
    <div class="particles" id="particles"></div>
    
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">ğŸ›’</div>
                <div class="logo-text">å¤©åˆ›å•†åŸ</div>
            </div>
            
            <div class="nav-right">
                <div class="settings-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                </div>
                
                <div class="user-info" id="userInfo">
                    <div class="user-avatar">ğŸ‘¤</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">ç”¨æˆ·</div>
                        <div class="user-points">ğŸ’° <span id="userPoints">0</span></div>
                    </div>
                    
                    <div class="user-dropdown">
                        <a href="index.html" class="user-dropdown-item">
                            <i class="fas fa-home"></i>
                            <span>è¿”å›é¦–é¡µ</span>
                        </a>
                        <a href="user-center.html" class="user-dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>ä¸ªäººèµ„æ–™</span>
                        </a>
                        <a href="achievements.html" class="user-dropdown-item">
                            <i class="fas fa-trophy"></i>
                            <span>æˆå°±</span>
                        </a>
                        <a href="inventory.html" class="user-dropdown-item">
                            <i class="fas fa-box"></i>
                            <span>ç‰©å“æ </span>
                        </a>
                        <a href="bag.html" class="user-dropdown-item">
                            <i class="fas fa-shopping-bag"></i>
                            <span>æˆ‘çš„èƒŒåŒ…</span>
                        </a>
                        <a href="mall.html" class="user-dropdown-item active">
                            <i class="fas fa-shopping-cart"></i>
                            <span>å¤©åˆ›å•†åŸ</span>
                        </a>
                        <a href="market.html" class="user-dropdown-item">
                            <i class="fas fa-store"></i>
                            <span>äº¤æ˜“å¸‚åœº</span>
                        </a>
                        <a href="dice.html" class="user-dropdown-item">
                            <i class="fas fa-dice"></i>
                            <span>å¹¸è¿éª°å­</span>
                        </a>
                        <a href="doll.html" class="user-dropdown-item">
                            <i class="fas fa-doll"></i>
                            <span>å¨ƒå¨ƒç³»ç»Ÿ</span>
                        </a>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <a href="#" class="user-dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>é€€å‡ºç™»å½•</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- ä¸»å†…å®¹ -->
    <main class="main-content">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <section class="page-header">
            <h1 class="page-title">å¤©åˆ›å•†åŸ</h1>
            <p class="page-subtitle">ç²¾é€‰å•†å“ï¼Œç§¯åˆ†å…‘æ¢</p>
        </section>
        
        <!-- å•†åŸå¸ƒå±€ -->
        <div class="mall-layout">
            <!-- ä¾§è¾¹æ  -->
            <aside class="mall-sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">å•†å“åˆ†ç±»</div>
                    <div class="sidebar-subtitle">å¿«é€Ÿå¯¼èˆª</div>
                </div>
                
                <div class="sidebar-menu">
                    <a href="#" class="menu-item active" data-category="all" onclick="filterByCategory('all')">
                        <div class="menu-icon">ğŸ“¦</div>
                        <div class="menu-text">å…¨éƒ¨å•†å“</div>
                    </a>
                    
                    <a href="#" class="menu-item" data-category="virtual" onclick="filterByCategory('virtual')">
                        <div class="menu-icon">ğŸ“±</div>
                        <div class="menu-text">è™šæ‹Ÿå•†å“</div>
                    </a>
                    
                    <a href="#" class="menu-item" data-category="physical" onclick="filterByCategory('physical')">
                        <div class="menu-icon">ğŸ“¦</div>
                        <div class="menu-text">å®ä½“å•†å“</div>
                    </a>
                    
                    <a href="#" class="menu-item" data-category="service" onclick="filterByCategory('service')">
                        <div class="menu-icon">ğŸ’¼</div>
                        <div class="menu-text">æœåŠ¡</div>
                    </a>
                </div>
            </aside>
            
            <!-- ä¸»å†…å®¹åŒº -->
            <div class="mall-main">
                <div class="main-header">
                    <div class="main-title">
                        <i class="fas fa-shopping-cart"></i>
                        <span>å•†å“åˆ—è¡¨</span>
                    </div>
                    <div class="main-actions">
                        <button class="action-btn" onclick="refreshProducts()">
                            <i class="fas fa-sync"></i>
                            <span>åˆ·æ–°å•†å“</span>
                        </button>
                        <button class="action-btn secondary" onclick="toggleCart()">
                            <i class="fas fa-shopping-cart"></i>
                            <span>è´­ç‰©è½¦ (<span id="cartCount">0</span>)</span>
                        </button>
                    </div>
                </div>
                
                <div class="products-grid" id="productsGrid">
                    <!-- å•†å“å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </main>
    
    <!-- è´­ç‰©è½¦ä¾§è¾¹æ  -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <div class="cart-title">è´­ç‰©è½¦</div>
            <button class="cart-close" onclick="toggleCart()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-content" id="cartContent">
            <!-- è´­ç‰©è½¦å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="cart-footer">
            <div class="cart-total">
                <span>æ€»è®¡ï¼š</span>
                <span>ğŸ’° <span id="cartTotal">0</span></span>
            </div>
            <button class="cart-checkout" onclick="checkout()">
                ç»“ç®—
            </button>
        </div>
    </div>

    <!-- ä¼˜åŒ–è„šæœ¬åŠ è½½ -->
    <script>
        // åŠ¨æ€APIé…ç½® - è‡ªåŠ¨é€‚åº”æœåŠ¡å™¨åœ°å€
        window.API_CONFIG = {
            BASE_URL: window.location.origin,
            ENDPOINTS: {
                USER: '/api/user',
                POINTS: '/api/points',
                ITEMS: '/api/items',
                MALL: '/api/mall'
            },
            TIMEOUT: 5000
        };

        // é¢„åŠ è½½å…³é”®è„šæœ¬
        function loadScript(src, callback) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = callback;
            script.onerror = () => {
                console.error('Failed to load script:', src);
                // å¦‚æœå¤–éƒ¨è„šæœ¬åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å†…è”å¤‡ç”¨ç‰ˆæœ¬
                if (callback) callback();
            };
            document.head.appendChild(script);
        }

        // æŒ‰é¡ºåºåŠ è½½è„šæœ¬
        const scripts = [
            'api-service.js',
            'data-adapter.js', 
            'points-system.js',
            'user-system.js',
            'common.js'
        ];

        let loadedScripts = 0;
        
        function loadNextScript() {
            if (loadedScripts < scripts.length) {
                loadScript(scripts[loadedScripts], () => {
                    loadedScripts++;
                    loadNextScript();
                });
            } else {
                // æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–å•†åŸç³»ç»Ÿ
                initMallSystem();
            }
        }

        // åˆå§‹åŒ–å•†åŸç³»ç»Ÿ
        function initMallSystem() {
            console.log('=== å¤©åˆ›å•†åŸç³»ç»Ÿåˆå§‹åŒ– ===');
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            if (!checkLoginStatus()) {
                return;
            }
            
            // åˆå§‹åŒ–ç²’å­æ•ˆæœ
            initParticles();
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners();
            
            // ç­‰å¾…å…¶ä»–ç³»ç»ŸåŠ è½½å®Œæˆ
            waitForSystems(() => {
                // åŠ è½½å•†å“æ•°æ®
                loadProducts();
                
                // åŠ è½½è´­ç‰©è½¦
                loadCart();
                
                // æ›´æ–°UI
                updateUI();
                
                // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
                initPointsSystem();
                
                console.log('å¤©åˆ›å•†åŸç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
            });
        }
        
        // ç­‰å¾…å…¶ä»–ç³»ç»ŸåŠ è½½å®Œæˆ
        function waitForSystems(callback) {
            let attempts = 0;
            const maxAttempts = 50;
            
            const checkSystems = () => {
                attempts++;
                
                if (window.pointsSystem && window.pointsSystem.isInitialized && 
                    window.userSystem && window.userSystem.isLoggedIn) {
                    console.log('å•†åŸç³»ç»Ÿï¼šæ‰€æœ‰ç³»ç»Ÿå·²åŠ è½½å®Œæˆ');
                    callback();
                } else if (attempts < maxAttempts) {
                    console.log(`å•†åŸç³»ç»Ÿï¼šç­‰å¾…ç³»ç»ŸåŠ è½½... (${attempts}/${maxAttempts})`);
                    setTimeout(checkSystems, 100);
                } else {
                    console.error('å•†åŸç³»ç»Ÿï¼šç³»ç»ŸåŠ è½½è¶…æ—¶');
                    callback();
                }
            };
            
            checkSystems();
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            try {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const currentUser = localStorage.getItem('currentUser');
                
                if (!isLoggedIn || !currentUser) {
                    console.log('å•†åŸç³»ç»Ÿï¼šç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                    window.location.href = 'login.html';
                    return false;
                }
                
                return true;
            } catch (error) {
                console.error('å•†åŸç³»ç»Ÿï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥', error);
                return false;
            }
        }
        
        // åˆå§‹åŒ–ç²’å­æ•ˆæœ
        function initParticles() {
            try {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 25;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 10 + 's';
                    particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                    particlesContainer.appendChild(particle);
                }
                
                // æ·»åŠ äº¤äº’ç²’å­
                for (let i = 0; i < 5; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle interactive';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 5 + 's';
                    particle.style.animationDuration = (10 + Math.random() * 5) + 's';
                    particlesContainer.appendChild(particle);
                }
            } catch (error) {
                console.error('å•†åŸç³»ç»Ÿï¼šåˆå§‹åŒ–ç²’å­æ•ˆæœå¤±è´¥', error);
            }
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            try {
                // ç”¨æˆ·ä¸‹æ‹‰èœå•
                const userInfo = document.getElementById('userInfo');
                if (userInfo) {
                    userInfo.addEventListener('click', (e) => {
                        e.stopPropagation();
                        userInfo.classList.toggle('active');
                    });
                    
                    document.addEventListener('click', () => {
                        userInfo.classList.remove('active');
                    });
                }
                
                // é€€å‡ºç™»å½•
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        logout();
                    });
                }
                
                // è®¾ç½®æŒ‰é’®
                const settingsBtn = document.getElementById('settingsBtn');
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', () => {
                        showNotification('info', 'è®¾ç½®', 'è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
                    });
                }
                
                // ä¾§è¾¹æ èœå•é¡¹
                const menuItems = document.querySelectorAll('.menu-item');
                menuItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const category = item.dataset.category;
                        if (category) {
                            filterByCategory(category);
                            // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                            menuItems.forEach(mi => mi.classList.remove('active'));
                            item.classList.add('active');
                        }
                    });
                });
            } catch (error) {
                console.error('å•†åŸç³»ç»Ÿï¼šåˆå§‹åŒ–äº‹ä»¶ç›‘å¬å¤±è´¥', error);
            }
        }
        
        // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
        function initPointsSystem() {
            console.log('å•†åŸç³»ç»Ÿï¼šåˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ');
            
            if (window.pointsSystem) {
                // è®¢é˜…ç§¯åˆ†å˜åŠ¨äº‹ä»¶
                window.pointsSystem.subscribe((data) => {
                    console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿè®¢é˜…äº‹ä»¶', data);
                    updatePointsDisplay(data.newPoints);
                });
                
                // ç›‘å¬ç§¯åˆ†æ›´æ–°äº‹ä»¶
                window.addEventListener('pointsUpdated', (e) => {
                    console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†æ›´æ–°äº‹ä»¶', e.detail);
                    updatePointsDisplay(e.detail.newPoints);
                });
                
                // ç›‘å¬ç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶
                window.addEventListener('pointsDisplayUpdated', (e) => {
                    console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶', e.detail);
                    updatePointsDisplay(e.detail.points);
                });
                
                // åˆå§‹æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
                const currentPoints = window.pointsSystem.getPoints();
                updatePointsDisplay(currentPoints);
                
                console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå½“å‰ç§¯åˆ†', currentPoints);
            } else {
                console.error('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿæœªæ‰¾åˆ°');
            }
        }
        
        // åŠ è½½å•†å“æ•°æ®
        function loadProducts() {
            try {
                // ä»localStorageåŠ è½½å•†å“æ•°æ®
                const savedProducts = localStorage.getItem('mallProducts');
                if (savedProducts) {
                    window.MallSystem.products = JSON.parse(savedProducts);
                } else {
                    // å¦‚æœæ²¡æœ‰å•†å“æ•°æ®ï¼Œåˆ›å»ºé»˜è®¤å•†å“
                    window.MallSystem.products = createDefaultProducts();
                    localStorage.setItem('mallProducts', JSON.stringify(window.MallSystem.products));
                }
                
                // æ˜¾ç¤ºå•†å“
                window.MallSystem.displayProducts();
                
                console.log('å•†å“æ•°æ®åŠ è½½å®Œæˆ:', window.MallSystem.products.length, 'ä¸ªå•†å“');
            } catch (error) {
                console.error('åŠ è½½å•†å“æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // åˆ›å»ºé»˜è®¤å•†å“
        function createDefaultProducts() {
            return [
                {
                    id: 'product_1',
                    name: 'VIPä¼šå‘˜',
                    description: 'äº«å—VIPç‰¹æƒï¼Œè·å¾—ä¸“å±æ ‡è¯†å’Œç‰¹æ®ŠåŠŸèƒ½',
                    category: 'virtual',
                    price: 1000,
                    stock: 999,
                    icon: 'ğŸ‘‘',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'product_2',
                    name: 'ç§¯åˆ†ç¿»å€å¡',
                    description: 'ä½¿ç”¨åè·å¾—åŒå€ç§¯åˆ†å¥–åŠ±',
                    category: 'virtual',
                    price: 500,
                    stock: 100,
                    icon: 'ğŸ’',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'product_3',
                    name: 'å¹¸è¿éª°å­åˆ¸',
                    description: 'å…è´¹å‚ä¸å¹¸è¿éª°å­æ¸¸æˆ',
                    category: 'virtual',
                    price: 200,
                    stock: 200,
                    icon: 'ğŸ²',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'product_4',
                    name: 'å®šåˆ¶å¤´åƒæ¡†',
                    description: 'ä¸ªæ€§åŒ–ä½ çš„å¤´åƒï¼Œå½°æ˜¾ç‹¬ç‰¹é£æ ¼',
                    category: 'virtual',
                    price: 300,
                    stock: 50,
                    icon: 'ğŸ–¼ï¸',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'product_5',
                    name: 'é™é‡ç‰ˆæ‰‹åŠ',
                    description: 'ç²¾ç¾æ”¶è—å“ï¼Œé™é‡å‘å”®',
                    category: 'physical',
                    price: 2000,
                    stock: 10,
                    icon: 'ğŸ',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 'product_6',
                    name: 'ä¸“å±å®¢æœ',
                    description: '7x24å°æ—¶ä¸“å±å®¢æœæœåŠ¡',
                    category: 'service',
                    price: 1500,
                    stock: 20,
                    icon: 'ğŸ§',
                    status: 'active',
                    createdAt: new Date().toISOString()
                }
            ];
        }
        
        // åŠ è½½è´­ç‰©è½¦
        function loadCart() {
            try {
                const savedCart = localStorage.getItem('mallCart');
                if (savedCart) {
                    window.MallSystem.cart = JSON.parse(savedCart);
                } else {
                    window.MallSystem.cart = [];
                }
                
                window.MallSystem.updateCartUI();
            } catch (error) {
                console.error('åŠ è½½è´­ç‰©è½¦å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°UI
        function updateUI() {
            try {
                // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                updateUserInfo(currentUser);
                
                // æ›´æ–°è´­ç‰©è½¦
                window.MallSystem.updateCartUI();
            } catch (error) {
                console.error('å•†åŸç³»ç»Ÿï¼šæ›´æ–°UIå¤±è´¥', error);
            }
        }
        
        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
        function updateUserInfo(user) {
            try {
                const userName = document.getElementById('userName');
                const userPoints = document.getElementById('userPoints');
                
                if (userName) {
                    userName.textContent = user.name || 'æœªçŸ¥ç”¨æˆ·';
                }
                
                if (userPoints) {
                    // ä½¿ç”¨ç§¯åˆ†ç³»ç»Ÿè·å–ç§¯åˆ†
                    const points = window.pointsSystem ? 
                        window.pointsSystem.getPoints() : 
                        (user.points || 0);
                    userPoints.textContent = points;
                }
            } catch (error) {
                console.error('å•†åŸç³»ç»Ÿï¼šæ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºå¤±è´¥', error);
            }
        }
        
        // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º - ä¿®å¤ç‰ˆ
        function updatePointsDisplay(points) {
            console.log('å•†åŸç³»ç»Ÿï¼šæ›´æ–°ç§¯åˆ†æ˜¾ç¤º', points);
            
            // æ›´æ–°æ‰€æœ‰æ˜¾ç¤ºç§¯åˆ†çš„å…ƒç´ 
            const pointsElements = document.querySelectorAll('[id*="userPoints"], [class*="user-points"]');
            pointsElements.forEach(element => {
                if (element.tagName === 'SPAN') {
                    element.textContent = points;
                } else if (element.tagName === 'DIV') {
                    const span = element.querySelector('span');
                    if (span) {
                        span.textContent = points;
                    } else {
                        element.textContent = `ğŸ’° ${points}`;
                    }
                }
            });
            
            // è§¦å‘ç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶
            window.dispatchEvent(new CustomEvent('pointsDisplayUpdated', { points }));
        }
        
        // å¤©åˆ›å•†åŸç³»ç»Ÿ - å®Œå…¨ä¿®å¤ç‰ˆ
        window.MallSystem = {
            // å½“å‰çŠ¶æ€
            currentCategory: 'all',
            products: [],
            cart: [],
            currentUser: null,
            isInitialized: false,
            
            // åˆå§‹åŒ–
            init() {
                console.log('=== å¤©åˆ›å•†åŸç³»ç»Ÿåˆå§‹åŒ– ===');
                
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                if (!checkLoginStatus()) {
                    return;
                }
                
                // åˆå§‹åŒ–ç²’å­æ•ˆæœ
                this.initParticles();
                
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
                this.initEventListeners();
                
                // ç­‰å¾…å…¶ä»–ç³»ç»ŸåŠ è½½å®Œæˆ
                this.waitForSystems(() => {
                    // åŠ è½½å•†å“æ•°æ®
                    this.loadProducts();
                    
                    // åŠ è½½è´­ç‰©è½¦
                    this.loadCart();
                    
                    // æ›´æ–°UI
                    this.updateUI();
                    
                    // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
                    this.initPointsSystem();
                    
                    this.isInitialized = true;
                    console.log('å¤©åˆ›å•†åŸç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                });
            },
            
            // ç­‰å¾…å…¶ä»–ç³»ç»ŸåŠ è½½å®Œæˆ
            waitForSystems(callback) {
                let attempts = 0;
                const maxAttempts = 50;
                
                const checkSystems = () => {
                    attempts++;
                    
                    if (window.pointsSystem && window.pointsSystem.isInitialized && 
                        window.userSystem && window.userSystem.isLoggedIn) {
                        console.log('å•†åŸç³»ç»Ÿï¼šæ‰€æœ‰ç³»ç»Ÿå·²åŠ è½½å®Œæˆ');
                        callback();
                    } else if (attempts < maxAttempts) {
                        console.log(`å•†åŸç³»ç»Ÿï¼šç­‰å¾…ç³»ç»ŸåŠ è½½... (${attempts}/${maxAttempts})`);
                        setTimeout(checkSystems, 100);
                    } else {
                        console.error('å•†åŸç³»ç»Ÿï¼šç³»ç»ŸåŠ è½½è¶…æ—¶');
                        callback();
                    }
                };
                
                checkSystems();
            },
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkLoginStatus() {
                try {
                    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                    const currentUser = localStorage.getItem('currentUser');
                    
                    if (!isLoggedIn || !currentUser) {
                        console.log('å•†åŸç³»ç»Ÿï¼šç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                        window.location.href = 'login.html';
                        return false;
                    }
                    
                    this.currentUser = JSON.parse(currentUser);
                    
                    // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
                    this.updateUserInfo(this.currentUser);
                    
                    return true;
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥', error);
                    return false;
                }
            },
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
            updateUserInfo(user) {
                try {
                    const userName = document.getElementById('userName');
                    const userPoints = document.getElementById('userPoints');
                    
                    if (userName) {
                        userName.textContent = user.name || 'ç”¨æˆ·';
                    }
                    
                    if (userPoints) {
                        // ä½¿ç”¨ç§¯åˆ†ç³»ç»Ÿè·å–ç§¯åˆ†
                        const points = window.pointsSystem ? 
                            window.pointsSystem.getPoints() : 
                            (user.points || 0);
                        userPoints.textContent = points;
                    }
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šæ›´æ–°ç”¨æˆ·ä¿¡æ¯å¤±è´¥', error);
                }
            },
            
            // åˆå§‹åŒ–ç²’å­æ•ˆæœ
            initParticles() {
                try {
                    const particlesContainer = document.getElementById('particles');
                    const particleCount = 25;
                    
                    for (let i = 0; i < particleCount; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 10 + 's';
                        particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                        particlesContainer.appendChild(particle);
                    }
                    
                    // æ·»åŠ äº¤äº’ç²’å­
                    for (let i = 0; i < 5; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle interactive';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 5 + 's';
                        particle.style.animationDuration = (10 + Math.random() * 5) + 's';
                        particlesContainer.appendChild(particle);
                    }
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šåˆå§‹åŒ–ç²’å­æ•ˆæœå¤±è´¥', error);
                }
            },
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners() {
                try {
                    // ç”¨æˆ·ä¸‹æ‹‰èœå•
                    const userInfo = document.getElementById('userInfo');
                    if (userInfo) {
                        userInfo.addEventListener('click', (e) => {
                            e.stopPropagation();
                            userInfo.classList.toggle('active');
                        });
                        
                        document.addEventListener('click', () => {
                            userInfo.classList.remove('active');
                        });
                    }
                    
                    // é€€å‡ºç™»å½•
                    const logoutBtn = document.getElementById('logoutBtn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            this.logout();
                        });
                    }
                    
                    // è®¾ç½®æŒ‰é’®
                    const settingsBtn = document.getElementById('settingsBtn');
                    if (settingsBtn) {
                        settingsBtn.addEventListener('click', () => {
                            this.showNotification('info', 'è®¾ç½®', 'è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
                        });
                    }
                    
                    // ä¾§è¾¹æ èœå•é¡¹
                    const menuItems = document.querySelectorAll('.menu-item');
                    menuItems.forEach(item => {
                        item.addEventListener('click', (e) => {
                            e.preventDefault();
                            const category = item.dataset.category;
                            if (category) {
                                this.filterByCategory(category);
                                // æ›´æ–°æ´»åŠ¨çŠ¶æ€
                                menuItems.forEach(mi => mi.classList.remove('active'));
                                item.classList.add('active');
                            }
                        });
                    });
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šåˆå§‹åŒ–äº‹ä»¶ç›‘å¬å¤±è´¥', error);
                }
            },
            
            // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
            initPointsSystem() {
                console.log('å•†åŸç³»ç»Ÿï¼šåˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ');
                
                if (window.pointsSystem) {
                    // è®¢é˜…ç§¯åˆ†å˜åŠ¨äº‹ä»¶
                    window.pointsSystem.subscribe((data) => {
                        console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿè®¢é˜…äº‹ä»¶', data);
                        this.updatePointsDisplay(data.newPoints);
                    });
                    
                    // ç›‘å¬ç§¯åˆ†æ›´æ–°äº‹ä»¶
                    window.addEventListener('pointsUpdated', (e) => {
                        console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†æ›´æ–°äº‹ä»¶', e.detail);
                        this.updatePointsDisplay(e.detail.newPoints);
                    });
                    
                    // ç›‘å¬ç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶
                    window.addEventListener('pointsDisplayUpdated', (e) => {
                        console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶', e.detail);
                        this.updatePointsDisplay(e.detail.points);
                    });
                    
                    // åˆå§‹æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
                    const currentPoints = window.pointsSystem.getPoints();
                    this.updatePointsDisplay(currentPoints);
                    
                    console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼Œå½“å‰ç§¯åˆ†', currentPoints);
                } else {
                    console.error('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†ç³»ç»Ÿæœªæ‰¾åˆ°');
                }
            },
            
            // åŠ è½½å•†å“æ•°æ®
            loadProducts() {
                try {
                    // ä»localStorageåŠ è½½å•†å“æ•°æ®
                    const savedProducts = localStorage.getItem('mallProducts');
                    if (savedProducts) {
                        this.products = JSON.parse(savedProducts);
                    } else {
                        // å¦‚æœæ²¡æœ‰å•†å“æ•°æ®ï¼Œåˆ›å»ºé»˜è®¤å•†å“
                        this.products = this.createDefaultProducts();
                        localStorage.setItem('mallProducts', JSON.stringify(this.products));
                    }
                    
                    // æ˜¾ç¤ºå•†å“
                    this.displayProducts();
                    
                    console.log('å•†å“æ•°æ®åŠ è½½å®Œæˆ:', this.products.length, 'ä¸ªå•†å“');
                } catch (error) {
                    console.error('åŠ è½½å•†å“æ•°æ®å¤±è´¥:', error);
                }
            },
            
            // åˆ›å»ºé»˜è®¤å•†å“
            createDefaultProducts() {
                return [
                    {
                        id: 'product_1',
                        name: 'VIPä¼šå‘˜',
                        description: 'äº«å—VIPç‰¹æƒï¼Œè·å¾—ä¸“å±æ ‡è¯†å’Œç‰¹æ®ŠåŠŸèƒ½',
                        category: 'virtual',
                        price: 1000,
                        stock: 999,
                        icon: 'ğŸ‘‘',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_2',
                        name: 'ç§¯åˆ†ç¿»å€å¡',
                        description: 'ä½¿ç”¨åè·å¾—åŒå€ç§¯åˆ†å¥–åŠ±',
                        category: 'virtual',
                        price: 500,
                        stock: 100,
                        icon: 'ğŸ’',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_3',
                        name: 'å¹¸è¿éª°å­åˆ¸',
                        description: 'å…è´¹å‚ä¸å¹¸è¿éª°å­æ¸¸æˆ',
                        category: 'virtual',
                        price: 200,
                        stock: 200,
                        icon: 'ğŸ²',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_4',
                        name: 'å®šåˆ¶å¤´åƒæ¡†',
                        description: 'ä¸ªæ€§åŒ–ä½ çš„å¤´åƒï¼Œå½°æ˜¾ç‹¬ç‰¹é£æ ¼',
                        category: 'virtual',
                        price: 300,
                        stock: 50,
                        icon: 'ğŸ–¼ï¸',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_5',
                        name: 'é™é‡ç‰ˆæ‰‹åŠ',
                        description: 'ç²¾ç¾æ”¶è—å“ï¼Œé™é‡å‘å”®',
                        category: 'physical',
                        price: 2000,
                        stock: 10,
                        icon: 'ğŸ',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_6',
                        name: 'ä¸“å±å®¢æœ',
                        description: '7x24å°æ—¶ä¸“å±å®¢æœæœåŠ¡',
                        category: 'service',
                        price: 1500,
                        stock: 20,
                        icon: 'ğŸ§',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    }
                ];
            },
            
            // æ˜¾ç¤ºå•†å“
            displayProducts() {
                try {
                    const productsGrid = document.getElementById('productsGrid');
                    if (!productsGrid) return;
                    
                    // è¿‡æ»¤å•†å“
                    let filteredProducts = this.products;
                    if (this.currentCategory !== 'all') {
                        filteredProducts = this.products.filter(product => product.category === this.currentCategory);
                    }
                    
                    if (filteredProducts.length === 0) {
                        productsGrid.innerHTML = `
                            <div style="text-align: center; padding: 3rem; color: var(--text-light);">
                                <i class="fas fa-box" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                <p style="font-size: 1.2rem;">æš‚æ— å•†å“</p>
                                <p style="font-size: 0.9rem; opacity: 0.7;">è¯¥åˆ†ç±»ä¸‹æš‚æ—¶æ²¡æœ‰å•†å“</p>
                            </div>
                        `;
                        return;
                    }
                    
                    productsGrid.innerHTML = filteredProducts.map(product => {
                        return `
                            <div class="product-card" onclick="viewProduct('${product.id}')">
                                <div class="product-image">
                                    ${product.icon || 'ğŸ“¦'}
                                </div>
                                <div class="product-info">
                                    <div class="product-name">${product.name}</div>
                                    <div class="product-description">${product.description}</div>
                                    <div class="product-meta">
                                        <div class="product-price">ğŸ’° ${product.price}</div>
                                        <div class="product-stock">åº“å­˜: ${product.stock}</div>
                                    </div>
                                    <div class="product-actions">
                                        <button class="product-btn" onclick="event.stopPropagation(); addToCart('${product.id}')">
                                            <i class="fas fa-cart-plus"></i>
                                            <span>åŠ å…¥è´­ç‰©è½¦</span>
                                        </button>
                                        <button class="product-btn secondary" onclick="event.stopPropagation(); viewProduct('${product.id}')">
                                            <i class="fas fa-eye"></i>
                                            <span>æŸ¥çœ‹è¯¦æƒ…</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('æ˜¾ç¤ºå•†å“å¤±è´¥:', error);
                }
            },
            
            // æŒ‰åˆ†ç±»è¿‡æ»¤å•†å“
            filterByCategory(category) {
                this.currentCategory = category;
                this.displayProducts();
            },
            
            // åŠ è½½è´­ç‰©è½¦
            loadCart() {
                try {
                    const savedCart = localStorage.getItem('mallCart');
                    if (savedCart) {
                        this.cart = JSON.parse(savedCart);
                    } else {
                        this.cart = [];
                    }
                    
                    this.updateCartUI();
                } catch (error) {
                    console.error('åŠ è½½è´­ç‰©è½¦å¤±è´¥:', error);
                }
            },
            
            // ä¿å­˜è´­ç‰©è½¦
            saveCart() {
                try {
                    localStorage.setItem('mallCart', JSON.stringify(this.cart));
                    this.updateCartUI();
                } catch (error) {
                    console.error('ä¿å­˜è´­ç‰©è½¦å¤±è´¥:', error);
                }
            },
            
            // æ›´æ–°è´­ç‰©è½¦UI
            updateCartUI() {
                try {
                    const cartCount = document.getElementById('cartCount');
                    const cartTotal = document.getElementById('cartTotal');
                    const cartContent = document.getElementById('cartContent');
                    
                    if (cartCount) {
                        cartCount.textContent = this.cart.length;
                    }
                    
                    if (cartTotal) {
                        const total = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                        cartTotal.textContent = total;
                    }
                    
                    if (cartContent) {
                        if (this.cart.length === 0) {
                            cartContent.innerHTML = `
                                <div style="text-align: center; padding: 2rem; color: var(--text-light);">
                                    <i class="fas fa-shopping-cart" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                    <p>è´­ç‰©è½¦æ˜¯ç©ºçš„</p>
                                    <p style="font-size: 0.9rem; opacity: 0.7;">å¿«å»æ·»åŠ å•†å“å§ï¼</p>
                                </div>
                            `;
                        } else {
                            cartContent.innerHTML = this.cart.map(item => `
                                <div class="cart-item">
                                    <div class="cart-item-image">
                                        ${item.icon || 'ğŸ“¦'}
                                    </div>
                                    <div class="cart-item-info">
                                        <div class="cart-item-name">${item.name}</div>
                                        <div class="cart-item-price">ğŸ’° ${item.price}</div>
                                        <div class="cart-item-quantity">
                                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="${item.stock}" onchange="updateQuantity('${item.id}', this.value)">
                                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button class="cart-item-remove" onclick="removeFromCart('${item.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            `).join('');
                        }
                    }
                } catch (error) {
                    console.error('æ›´æ–°è´­ç‰©è½¦UIå¤±è´¥:', error);
                }
            },
            
            // æ·»åŠ åˆ°è´­ç‰©è½¦
            addToCart(productId) {
                try {
                    const product = this.products.find(p => p.id === productId);
                    if (!product) {
                        this.showNotification('error', 'é”™è¯¯', 'å•†å“ä¸å­˜åœ¨');
                        return;
                    }
                    
                    if (product.stock <= 0) {
                        this.showNotification('error', 'åº“å­˜ä¸è¶³', 'è¯¥å•†å“åº“å­˜ä¸è¶³');
                        return;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦å·²åœ¨è´­ç‰©è½¦ä¸­
                    const existingItem = this.cart.find(item => item.id === productId);
                    if (existingItem) {
                        if (existingItem.quantity >= product.stock) {
                            this.showNotification('warning', 'åº“å­˜é™åˆ¶', 'å·²è¾¾åˆ°æœ€å¤§åº“å­˜æ•°é‡');
                            return;
                        }
                        existingItem.quantity += 1;
                    } else {
                        this.cart.push({
                            ...product,
                            quantity: 1
                        });
                    }
                    
                    this.saveCart();
                    this.showNotification('success', 'æ·»åŠ æˆåŠŸ', `${product.name} å·²æ·»åŠ åˆ°è´­ç‰©è½¦`);
                } catch (error) {
                    console.error('æ·»åŠ åˆ°è´­ç‰©è½¦å¤±è´¥:', error);
                }
            },
            
            // æ›´æ–°æ•°é‡
            updateQuantity(productId, quantity) {
                try {
                    const product = this.products.find(p => p.id === productId);
                    if (!product) return;
                    
                    if (quantity < 1) quantity = 1;
                    if (quantity > product.stock) quantity = product.stock;
                    
                    const cartItem = this.cart.find(item => item.id === productId);
                    if (cartItem) {
                        cartItem.quantity = quantity;
                        this.saveCart();
                    }
                } catch (error) {
                    console.error('æ›´æ–°æ•°é‡å¤±è´¥:', error);
                }
            },
            
            // ä»è´­ç‰©è½¦ç§»é™¤
            removeFromCart(productId) {
                try {
                    this.cart = this.cart.filter(item => item.id !== productId);
                    this.saveCart();
                } catch (error) {
                    console.error('ä»è´­ç‰©è½¦ç§»é™¤å¤±è´¥:', error);
                }
            },
            
            // åˆ‡æ¢è´­ç‰©è½¦æ˜¾ç¤º
            toggleCart() {
                try {
                    const cartSidebar = document.getElementById('cartSidebar');
                    if (cartSidebar) {
                        cartSidebar.classList.toggle('active');
                    }
                } catch (error) {
                    console.error('åˆ‡æ¢è´­ç‰©è½¦æ˜¾ç¤ºå¤±è´¥:', error);
                }
            },
            
            // æŸ¥çœ‹å•†å“è¯¦æƒ…
            viewProduct(productId) {
                try {
                    const product = this.products.find(p => p.id === productId);
                    if (!product) {
                        this.showNotification('error', 'é”™è¯¯', 'å•†å“ä¸å­˜åœ¨');
                        return;
                    }
                    
                    this.showNotification('info', 'å•†å“è¯¦æƒ…', `
                        å•†å“åç§°ï¼š${product.name}
                        æè¿°ï¼š${product.description}
                        ä»·æ ¼ï¼šğŸ’° ${product.price}
                        åº“å­˜ï¼š${product.stock}
                        åˆ†ç±»ï¼š${product.category}
                        çŠ¶æ€ï¼š${product.status}
                    `);
                } catch (error) {
                    console.error('æŸ¥çœ‹å•†å“è¯¦æƒ…å¤±è´¥:', error);
                }
            },
            
            // åˆ·æ–°å•†å“
            refreshProducts() {
                try {
                    this.loadProducts();
                    this.showNotification('success', 'åˆ·æ–°æˆåŠŸ', 'å•†å“åˆ—è¡¨å·²æ›´æ–°');
                } catch (error) {
                    console.error('åˆ·æ–°å•†å“å¤±è´¥:', error);
                }
            },
            
            // ç»“ç®— - å®Œå…¨ä¿®å¤ç‰ˆ
            checkout() {
                try {
                    console.log('å•†åŸç³»ç»Ÿï¼šå¼€å§‹ç»“ç®—æµç¨‹');
                    
                    if (this.cart.length === 0) {
                        this.showNotification('warning', 'è´­ç‰©è½¦ä¸ºç©º', 'è¯·å…ˆæ·»åŠ å•†å“åˆ°è´­ç‰©è½¦');
                        return;
                    }
                    
                    const total = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    
                    // ä¿®å¤ï¼šç›´æ¥ä»ç§¯åˆ†ç³»ç»Ÿè·å–ç§¯åˆ†
                    let userPoints = 0;
                    if (window.pointsSystem) {
                        userPoints = window.pointsSystem.getPoints();
                        console.log('å•†åŸç³»ç»Ÿï¼šä»ç§¯åˆ†ç³»ç»Ÿè·å–ç§¯åˆ†', userPoints);
                    } else {
                        // å¤‡ç”¨æ–¹æ¡ˆ
                        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                        userPoints = currentUser.points || 0;
                    }
                    
                    console.log('å•†åŸç³»ç»Ÿï¼šç»“ç®—ä¿¡æ¯', { total, userPoints });
                    
                    if (userPoints < total) {
                        this.showNotification('error', 'ç§¯åˆ†ä¸è¶³', `éœ€è¦ ${total} ç§¯åˆ†ï¼Œå½“å‰åªæœ‰ ${userPoints} ç§¯åˆ†`);
                        return;
                    }
                    
                    // ç¡®è®¤ç»“ç®—
                    if (confirm(`ç¡®è®¤ç»“ç®—ï¼Ÿæ€»è®¡ï¼š${total} ç§¯åˆ†`)) {
                        console.log('å•†åŸç³»ç»Ÿï¼šç”¨æˆ·ç¡®è®¤ç»“ç®—ï¼Œå¼€å§‹æ‰£é™¤ç§¯åˆ†');
                        
                        // æ‰£é™¤ç§¯åˆ†
                        if (window.pointsSystem) {
                            const result = window.pointsSystem.deductPoints(total, 'å•†åŸè´­ä¹°');
                            
                            if (result.success) {
                                console.log('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†æ‰£é™¤æˆåŠŸ', result);
                                
                                // æ¸…ç©ºè´­ç‰©è½¦
                                this.cart = [];
                                this.saveCart();
                                
                                // å…³é—­è´­ç‰©è½¦
                                const cartSidebar = document.getElementById('cartSidebar');
                                if (cartSidebar) {
                                    cartSidebar.classList.remove('active');
                                }
                                
                                this.showNotification('success', 'è´­ä¹°æˆåŠŸ', `å·²æˆåŠŸè´­ä¹°å•†å“ï¼Œæ‰£é™¤ ${total} ç§¯åˆ†`);
                                
                                // è®°å½•è´­ä¹°å†å²
                                this.recordPurchaseHistory();
                                
                                // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
                                this.updatePointsDisplay(result.newPoints);
                                
                            } else {
                                console.error('å•†åŸç³»ç»Ÿï¼šç§¯åˆ†æ‰£é™¤å¤±è´¥', result);
                                this.showNotification('error', 'è´­ä¹°å¤±è´¥', result.error);
                            }
                        } else {
                            this.showNotification('error', 'ç³»ç»Ÿé”™è¯¯', 'ç§¯åˆ†ç³»ç»Ÿä¸å¯ç”¨');
                        }
                    }
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šç»“ç®—å¤±è´¥', error);
                    this.showNotification('error', 'ç»“ç®—å¤±è´¥', 'ç»“ç®—æ—¶å‘ç”Ÿé”™è¯¯');
                }
            },
            
            // è®°å½•è´­ä¹°å†å²
            recordPurchaseHistory() {
                try {
                    const purchaseHistory = JSON.parse(localStorage.getItem('purchaseHistory') || '[]');
                    const purchase = {
                        id: 'purchase_' + Date.now(),
                        items: this.cart,
                        total: this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                        timestamp: new Date().toISOString(),
                        userId: JSON.parse(localStorage.getItem('currentUser') || '{}').id || 'unknown'
                    };
                    
                    purchaseHistory.unshift(purchase);
                    
                    // é™åˆ¶å†å²è®°å½•æ•°é‡
                    if (purchaseHistory.length > 1000) {
                        purchaseHistory.splice(1000);
                    }
                    
                    localStorage.setItem('purchaseHistory', JSON.stringify(purchaseHistory));
                    
                    // åˆ›å»ºè®¢å•æ•°æ®å¹¶åŒæ­¥åˆ°admin
                    this.createOrderAndSync(purchase);
                    
                    console.log('å•†åŸç³»ç»Ÿï¼šè´­ä¹°å†å²å·²è®°å½•');
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šè®°å½•è´­ä¹°å†å²å¤±è´¥', error);
                }
            },
            
            // åˆ›å»ºè®¢å•å¹¶åŒæ­¥åˆ°admin
            createOrderAndSync(purchase) {
                try {
                    // åˆ›å»ºè®¢å•æ•°æ®
                    const order = {
                        id: 'ORDER' + Date.now(),
                        buyer: purchase.userId || 'unknown',
                        item: purchase.items.map(item => item.name).join(', '),
                        quantity: purchase.items.reduce((sum, item) => sum + item.quantity, 0),
                        totalPrice: purchase.total,
                        status: 'completed',
                        timestamp: purchase.timestamp,
                        createdAt: purchase.timestamp,
                        items: purchase.items,
                        source: 'mall_purchase'
                    };
                    
                    // ä¿å­˜åˆ° userOrders
                    const userOrders = JSON.parse(localStorage.getItem('userOrders') || '[]');
                    userOrders.unshift(order);
                    
                    // é™åˆ¶è®¢å•æ•°é‡
                    if (userOrders.length > 1000) {
                        userOrders.splice(1000);
                    }
                    
                    localStorage.setItem('userOrders', JSON.stringify(userOrders));
                    
                    // ä¿å­˜åˆ°ç”¨æˆ·ä¸ªäººè®¢å•
                    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    const userOrdersKey = `orders_${currentUser.id || currentUser.username}`;
                    const userPersonalOrders = JSON.parse(localStorage.getItem(userOrdersKey) || '[]');
                    userPersonalOrders.unshift(order);
                    
                    if (userPersonalOrders.length > 1000) {
                        userPersonalOrders.splice(1000);
                    }
                    
                    localStorage.setItem(userOrdersKey, JSON.stringify(userPersonalOrders));
                    
                    // åŒæ­¥åˆ°admin.html
                    this.syncOrderToAdmin(order);
                    
                    console.log('å•†åŸç³»ç»Ÿï¼šè®¢å•å·²åˆ›å»ºå¹¶åŒæ­¥åˆ°admin', order.id);
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šåˆ›å»ºè®¢å•å¹¶åŒæ­¥å¤±è´¥', error);
                }
            },
            
            // åŒæ­¥è®¢å•åˆ°admin
            syncOrderToAdmin(order) {
                try {
                    console.log('å•†åŸç³»ç»Ÿï¼šåŒæ­¥è®¢å•åˆ°adminå¼€å§‹', order.id);
                    
                    // è§¦å‘æ•°æ®åŒæ­¥äº‹ä»¶
                    this.triggerDataSync('order', 'create', order);
                    
                    // è§¦å‘è®¢å•åŒæ­¥äº‹ä»¶
                    const orderSyncEvent = new CustomEvent('orderSync', {
                        detail: {
                            type: 'order',
                            action: 'create',
                            data: order
                        }
                    });
                    
                    window.dispatchEvent(orderSyncEvent);
                    
                    // è§¦å‘æœ¬åœ°å­˜å‚¨äº‹ä»¶
                    const localEvent = new CustomEvent('localStorageSync', {
                        detail: {
                            type: 'order',
                            action: 'create',
                            data: order
                        }
                    });
                    
                    window.dispatchEvent(localEvent);
                    
                    console.log('å•†åŸç³»ç»Ÿï¼šè®¢å•å·²åŒæ­¥åˆ°admin', order.id);
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šåŒæ­¥è®¢å•åˆ°adminå¤±è´¥', error);
                }
            },
            
            // è§¦å‘æ•°æ®åŒæ­¥äº‹ä»¶
            triggerDataSync(type, action, data) {
                try {
                    const syncEvent = new CustomEvent('dataSync', {
                        detail: {
                            type: type,
                            action: action,
                            data: data
                        }
                    });
                    
                    // è§¦å‘äº‹ä»¶
                    window.dispatchEvent(syncEvent);
                    
                    // è§¦å‘æœ¬åœ°å­˜å‚¨äº‹ä»¶
                    const localEvent = new CustomEvent('localStorageSync', {
                        detail: {
                            type: type,
                            action: action,
                            data: data
                        }
                    });
                    
                    window.dispatchEvent(localEvent);
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šè§¦å‘æ•°æ®åŒæ­¥äº‹ä»¶å¤±è´¥', error);
                }
            },
            
            // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º - ä¿®å¤ç‰ˆ
            updatePointsDisplay(points) {
                console.log('å•†åŸç³»ç»Ÿï¼šæ›´æ–°ç§¯åˆ†æ˜¾ç¤º', points);
                
                // æ›´æ–°æ‰€æœ‰æ˜¾ç¤ºç§¯åˆ†çš„å…ƒç´ 
                const pointsElements = document.querySelectorAll('[id*="userPoints"], [class*="user-points"]');
                pointsElements.forEach(element => {
                    if (element.tagName === 'SPAN') {
                        element.textContent = points;
                    } else if (element.tagName === 'DIV') {
                        const span = element.querySelector('span');
                        if (span) {
                            span.textContent = points;
                        } else {
                            element.textContent = `ğŸ’° ${points}`;
                        }
                    }
                });
                
                // è§¦å‘ç§¯åˆ†æ˜¾ç¤ºæ›´æ–°äº‹ä»¶
                window.dispatchEvent(new CustomEvent('pointsDisplayUpdated', { points }));
            },
            
            // é€€å‡ºç™»å½•
            logout() {
                try {
                    // ä½¿ç”¨ç”¨æˆ·ç³»ç»Ÿé€€å‡º
                    if (window.userSystem) {
                        window.userSystem.logout();
                    } else {
                        // å¤‡ç”¨æ–¹æ¡ˆ
                        localStorage.removeItem('isLoggedIn');
                        localStorage.removeItem('currentUser');
                        this.showNotification('info', 'é€€å‡ºç™»å½•', 'æ‚¨å·²æˆåŠŸé€€å‡ºç™»å½•');
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 1000);
                    }
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šé€€å‡ºç™»å½•å¤±è´¥', error);
                }
            },
            
            // æ˜¾ç¤ºé€šçŸ¥
            showNotification(type, title, message) {
                try {
                    // ç§»é™¤ç°æœ‰é€šçŸ¥
                    const existing = document.querySelector('.notification');
                    if (existing) existing.remove();
                    
                    // åˆ›å»ºæ–°é€šçŸ¥
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    notification.innerHTML = `
                        <div class="notification-icon">${type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â„¹ï¸'}</div>
                        <div class="notification-content">
                            <div class="notification-title">${title}</div>
                            <div class="notification-message">${message}</div>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // æ˜¾ç¤ºåŠ¨ç”»
                    setTimeout(() => notification.classList.add('show'), 100);
                    
                    // è‡ªåŠ¨éšè—
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                } catch (error) {
                    console.error('å•†åŸç³»ç»Ÿï¼šæ˜¾ç¤ºé€šçŸ¥å¤±è´¥', error);
                }
            }
        };
        
        // å…¨å±€å‡½æ•°
        function filterByCategory(category) {
            if (window.MallSystem) {
                window.MallSystem.filterByCategory(category);
            }
        }
        
        function addToCart(productId) {
            if (window.MallSystem) {
                window.MallSystem.addToCart(productId);
            }
        }
        
        function updateQuantity(productId, quantity) {
            if (window.MallSystem) {
                window.MallSystem.updateQuantity(productId, quantity);
            }
        }
        
        function removeFromCart(productId) {
            if (window.MallSystem) {
                window.MallSystem.removeFromCart(productId);
            }
        }
        
        function toggleCart() {
            if (window.MallSystem) {
                window.MallSystem.toggleCart();
            }
        }
        
        function viewProduct(productId) {
            if (window.MallSystem) {
                window.MallSystem.viewProduct(productId);
            }
        }
        
        function refreshProducts() {
            if (window.MallSystem) {
                window.MallSystem.refreshProducts();
            }
        }
        
        function checkout() {
            if (window.MallSystem) {
                window.MallSystem.checkout();
            }
        }
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== å¤©åˆ›å•†åŸé¡µé¢åˆå§‹åŒ– ===');
            window.MallSystem.init();
        });
    </script>
</body>
</html>
