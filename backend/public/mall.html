<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â§©ÂàõÂïÜÂüé - Â§©ÂàõÊó∂‰ª£</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ‰øùÊåÅÂéüÊúâCSSÊ†∑Âºè */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF7043;
            --secondary: #FFB74D;
            --accent: #FFC107;
            --bg-dark: #2C3E50;
            --bg-light: #34495E;
            --text-light: #ECF0F1;
            --gradient: linear-gradient(135deg, #FF7043, #FFB74D, #FFC107);
            --shadow: 0 8px 25px rgba(255, 112, 67, 0.3);
            --transition: all 0.3s ease;
            --border-radius: 20px;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #2C3E50, #34495E);
            min-height: 100vh;
            color: var(--text-light);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Âä®ÊÄÅËÉåÊôØÁ≤íÂ≠ê */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gradient);
            border-radius: 50%;
            opacity: 0.6;
            animation: particleFloat 20s linear infinite;
        }
        
        .particle.interactive {
            width: 6px;
            height: 6px;
            opacity: 0.8;
            animation: particleFloat 15s linear infinite;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-10vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* ÂØºËà™Ê†è */
        .navbar {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--primary);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 2.2rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: logoGlow 3s ease-in-out infinite;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            animation: logoRotate 10s linear infinite;
        }
        
        @keyframes logoGlow {
            0%, 100% {
                filter: drop-shadow(0 0 20px rgba(255, 112, 67, 0.5));
            }
            50% {
                filter: drop-shadow(0 0 30px rgba(255, 112, 67, 0.8));
            }
        }
        
        @keyframes logoRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .settings-btn {
            background: rgba(255, 112, 67, 0.1);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .settings-btn:hover {
            background: rgba(255, 112, 67, 0.2);
            transform: rotate(30deg);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 112, 67, 0.1);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            border: 2px solid rgba(255, 112, 67, 0.3);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }
        
        .user-info:hover {
            background: rgba(255, 112, 67, 0.2);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            color: white;
            font-size: 0.95rem;
        }
        
        .user-points {
            background: var(--gradient);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1rem;
            margin-top: 0.5rem;
            min-width: 200px;
            box-shadow: var(--shadow);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 1001;
        }
        
        .user-info.active .user-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            color: var(--text-light);
            text-decoration: none;
        }
        
        .user-dropdown-item:hover {
            background: rgba(255, 112, 67, 0.1);
        }
        
        .user-dropdown-divider {
            height: 1px;
            background: rgba(255, 112, 67, 0.3);
            margin: 0.5rem 0;
        }
        
        /* ‰∏ªÂÜÖÂÆπ */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* È°µÈù¢Ê†áÈ¢ò */
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .page-title {
            font-size: 3rem;
            font-weight: 900;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            animation: fadeInDown 1s ease;
        }
        
        .page-subtitle {
            font-size: 1.3rem;
            color: var(--text-light);
            margin-bottom: 1rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease 0.3s;
        }
        
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ÂïÜÂüéÂ∏ÉÂ±Ä */
        .mall-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 200px);
        }
        
        /* ‰æßËæπÊ†è */
        .mall-sidebar {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 112, 67, 0.3);
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .sidebar-subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .menu-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-light);
            text-decoration: none;
        }
        
        .menu-item:hover {
            background: rgba(255, 112, 67, 0.2);
            border-color: rgba(255, 112, 67, 0.4);
            transform: translateX(5px);
        }
        
        .menu-item.active {
            background: var(--gradient);
            border-color: var(--primary);
            color: white;
        }
        
        .menu-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        
        .menu-text {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* ‰∏ªÂÜÖÂÆπÂå∫ */
        .mall-main {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: var(--border-radius);
            padding: 2rem;
            overflow-y: auto;
        }
        
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 112, 67, 0.3);
        }
        
        .main-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .main-actions {
            display: flex;
            gap: 1rem;
        }
        
        .action-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .action-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .action-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* ÂïÜÂìÅÁΩëÊ†º */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .product-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .product-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: var(--text-light);
        }
        
        .product-info {
            padding: 1.5rem;
        }
        
        .product-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .product-description {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .product-price {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent);
        }
        
        .product-stock {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .product-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .product-btn {
            flex: 1;
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .product-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .product-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .product-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Ë¥≠Áâ©ËΩ¶ */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border-left: 2px solid var(--primary);
            z-index: 1000;
            transition: var(--transition);
            overflow-y: auto;
        }
        
        .cart-sidebar.active {
            right: 0;
        }
        
        .cart-header {
            background: rgba(255, 112, 67, 0.2);
            padding: 1.5rem;
            border-bottom: 2px solid rgba(255, 112, 67, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }
        
        .cart-close {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-close:hover {
            background: rgba(255, 112, 67, 0.2);
            color: white;
        }
        
        .cart-content {
            padding: 1.5rem;
        }
        
        .cart-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .cart-item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--text-light);
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: 600;
            color: white;
            margin-bottom: 0.25rem;
        }
        
        .cart-item-price {
            color: var(--accent);
            font-weight: 600;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .quantity-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .quantity-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .quantity-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 50px;
            text-align: center;
            border-radius: 4px;
            padding: 0.25rem;
        }
        
        .cart-item-remove {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid rgba(231, 76, 60, 0.3);
            color: #e74c3c;
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .cart-item-remove:hover {
            background: rgba(231, 76, 60, 0.3);
        }
        
        .cart-footer {
            background: rgba(255, 112, 67, 0.2);
            padding: 1.5rem;
            border-top: 2px solid rgba(255, 112, 67, 0.3);
            margin-top: auto;
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }
        
        .cart-checkout {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            text-align: center;
        }
        
        .cart-checkout:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* ÈÄöÁü• */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-dark);
            backdrop-filter: blur(20px);
            padding: 1rem 1.5rem;
            border-radius: 15px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(400px);
            transition: var(--transition);
            max-width: 350px;
            border-left: 4px solid var(--accent);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left-color: #27AE60;
        }
        
        .notification.error {
            border-left-color: #E74C3C;
        }
        
        .notification.info {
            border-left-color: #3498DB;
        }
        
        .notification-icon {
            font-size: 1.3rem;
            color: var(--accent);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 600;
            color: white;
            margin-bottom: 0.2rem;
        }
        
        .notification-message {
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1024px) {
            .mall-layout {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .mall-sidebar {
                display: none;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .main-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .main-actions {
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
            
            .cart-sidebar.active {
                right: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Âä®ÊÄÅËÉåÊôØÁ≤íÂ≠ê -->
    <div class="particles" id="particles"></div>
    
    <!-- È°∂ÈÉ®ÂØºËà™ -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">üõí</div>
                <div class="logo-text">Â§©ÂàõÂïÜÂüé</div>
            </div>
            
            <div class="nav-right">
                <div class="settings-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                </div>
                
                <div class="user-info" id="userInfo">
                    <div class="user-avatar">üë§</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Áî®Êà∑</div>
                        <div class="user-points">üí∞ <span id="userPoints">0</span></div>
                    </div>
                    
                    <div class="user-dropdown">
                        <a href="index.html" class="user-dropdown-item">
                            <i class="fas fa-home"></i>
                            <span>ËøîÂõûÈ¶ñÈ°µ</span>
                        </a>
                        <a href="user-center.html" class="user-dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>‰∏™‰∫∫ËµÑÊñô</span>
                        </a>
                        <a href="achievements.html" class="user-dropdown-item">
                            <i class="fas fa-trophy"></i>
                            <span>ÊàêÂ∞±</span>
                        </a>
                        <a href="inventory.html" class="user-dropdown-item">
                            <i class="fas fa-box"></i>
                            <span>Áâ©ÂìÅÊ†è</span>
                        </a>
                        <a href="bag.html" class="user-dropdown-item">
                            <i class="fas fa-shopping-bag"></i>
                            <span>ÊàëÁöÑËÉåÂåÖ</span>
                        </a>
                        <a href="mall.html" class="user-dropdown-item">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Â§©ÂàõÂïÜÂüé</span>
                        </a>
                        <a href="market.html" class="user-dropdown-item">
                            <i class="fas fa-store"></i>
                            <span>‰∫§ÊòìÂ∏ÇÂú∫</span>
                        </a>
                        <a href="dice.html" class="user-dropdown-item">
                            <i class="fas fa-dice"></i>
                            <span>Âπ∏ËøêÈ™∞Â≠ê</span>
                        </a>
                        <a href="doll.html" class="user-dropdown-item">
                            <i class="fas fa-doll"></i>
                            <span>Â®ÉÂ®ÉÁ≥ªÁªü</span>
                        </a>
                        
                        <div class="user-dropdown-divider"></div>
                        
                        <a href="#" class="user-dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>ÈÄÄÂá∫ÁôªÂΩï</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- ‰∏ªÂÜÖÂÆπ -->
    <main class="main-content">
        <!-- È°µÈù¢Ê†áÈ¢ò -->
        <section class="page-header">
            <h1 class="page-title">Â§©ÂàõÂïÜÂüé</h1>
            <p class="page-subtitle">Á≤æÈÄâÂïÜÂìÅÔºåÁßØÂàÜÂÖëÊç¢</p>
        </section>
        
        <!-- ÂïÜÂüéÂ∏ÉÂ±Ä -->
        <div class="mall-layout">
            <!-- ‰æßËæπÊ†è -->
            <aside class="mall-sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">ÂïÜÂìÅÂàÜÁ±ª</div>
                    <div class="sidebar-subtitle">Âø´ÈÄüÂØºËà™</div>
                </div>
                
                <div class="sidebar-menu">
                    <a href="#" class="menu-item active" data-category="all" onclick="filterByCategory('all')">
                        <div class="menu-icon">üì¶</div>
                        <div class="menu-text">ÂÖ®ÈÉ®ÂïÜÂìÅ</div>
                    </a>
                    
                    <a href="#" class="menu-item" data-category="virtual" onclick="filterByCategory('virtual')">
                        <div class="menu-icon">üì±</div>
                        <div class="menu-text">ËôöÊãüÂïÜÂìÅ</div>
                    </a>
                    
                    <a href="#" class="menu-item" data-category="physical" onclick="filterByCategory('physical')">
                        <div class="menu-icon">üì¶</div>
                        <div class="menu-text">ÂÆû‰ΩìÂïÜÂìÅ</div>
                    </a>
                    
                    <a href="#" class="menu-item" data-category="service" onclick="filterByCategory('service')">
                        <div class="menu-icon">üíº</div>
                        <div class="menu-text">ÊúçÂä°</div>
                    </a>
                </div>
            </aside>
            
            <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
            <div class="mall-main">
                <div class="main-header">
                    <div class="main-title">
                        <i class="fas fa-shopping-cart"></i>
                        <span>ÂïÜÂìÅÂàóË°®</span>
                    </div>
                    <div class="main-actions">
                        <button class="action-btn" onclick="refreshProducts()">
                            <i class="fas fa-sync"></i>
                            <span>Âà∑Êñ∞ÂïÜÂìÅ</span>
                        </button>
                        <button class="action-btn secondary" onclick="toggleCart()">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Ë¥≠Áâ©ËΩ¶ (<span id="cartCount">0</span>)</span>
                        </button>
                    </div>
                </div>
                
                <div class="products-grid" id="productsGrid">
                    <!-- ÂïÜÂìÅÂç°ÁâáÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>
    </main>
    
    <!-- Ë¥≠Áâ©ËΩ¶‰æßËæπÊ†è -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <div class="cart-title">Ë¥≠Áâ©ËΩ¶</div>
            <button class="cart-close" onclick="toggleCart()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-content" id="cartContent">
            <!-- Ë¥≠Áâ©ËΩ¶ÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
        </div>
        
        <div class="cart-footer">
            <div class="cart-total">
                <span>ÊÄªËÆ°Ôºö</span>
                <span>üí∞ <span id="cartTotal">0</span></span>
            </div>
            <button class="cart-checkout" onclick="checkout()">
                ÁªìÁÆó
            </button>
        </div>
    </div>

    <!-- ‰øÆÂ§çÂêéÁöÑËÑöÊú¨ÂºïÁî® -->
    <script src="/js/api-config.js"></script>
    <script src="/js/api-service.js"></script>
    <script src="/js/data-adapter.js"></script>
    <script src="/js/points-system.js"></script>
    <script src="/js/user-system.js"></script>
    <script src="/js/common.js"></script>
    
    <script>
        // Â§©ÂàõÂïÜÂüéÁ≥ªÁªü - ÂÆåÂÖ®‰øÆÂ§çÁâà
        const MallSystem = {
            // ÂΩìÂâçÁä∂ÊÄÅ
            currentCategory: 'all',
            products: [],
            cart: [],
            currentUser: null,
            isInitialized: false,
            
            // ÂàùÂßãÂåñ
            init() {
                console.log('=== Â§©ÂàõÂïÜÂüéÁ≥ªÁªüÂàùÂßãÂåñ ===');
                
                // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
                if (!this.checkLoginStatus()) {
                    return;
                }
                
                // ÂàùÂßãÂåñÁ≤íÂ≠êÊïàÊûú
                this.initParticles();
                
                // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨
                this.initEventListeners();
                
                // Á≠âÂæÖÂÖ∂‰ªñÁ≥ªÁªüÂä†ËΩΩÂÆåÊàê
                this.waitForSystems(() => {
                    // Âä†ËΩΩÂïÜÂìÅÊï∞ÊçÆ
                    this.loadProducts();
                    
                    // Âä†ËΩΩË¥≠Áâ©ËΩ¶
                    this.loadCart();
                    
                    // Êõ¥Êñ∞UI
                    this.updateUI();
                    
                    // ÂàùÂßãÂåñÁßØÂàÜÁ≥ªÁªü
                    this.initPointsSystem();
                    
                    this.isInitialized = true;
                    console.log('Â§©ÂàõÂïÜÂüéÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàê');
                });
            },
            
            // Á≠âÂæÖÂÖ∂‰ªñÁ≥ªÁªüÂä†ËΩΩÂÆåÊàê
            waitForSystems(callback) {
                let attempts = 0;
                const maxAttempts = 50;
                
                const checkSystems = () => {
                    attempts++;
                    
                    if (window.pointsSystem && window.pointsSystem.isInitialized && 
                        window.userSystem && window.userSystem.isLoggedIn) {
                        console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÊâÄÊúâÁ≥ªÁªüÂ∑≤Âä†ËΩΩÂÆåÊàê');
                        callback();
                    } else if (attempts < maxAttempts) {
                        console.log(`ÂïÜÂüéÁ≥ªÁªüÔºöÁ≠âÂæÖÁ≥ªÁªüÂä†ËΩΩ... (${attempts}/${maxAttempts})`);
                        setTimeout(checkSystems, 100);
                    } else {
                        console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÁ≥ªÁªüÂä†ËΩΩË∂ÖÊó∂');
                        callback();
                    }
                };
                
                checkSystems();
            },
            
            // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
            checkLoginStatus() {
                try {
                    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                    const currentUser = localStorage.getItem('currentUser');
                    
                    if (!isLoggedIn || !currentUser) {
                        console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÁî®Êà∑Êú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢');
                        window.location.href = 'login.html';
                        return false;
                    }
                    
                    this.currentUser = JSON.parse(currentUser);
                    
                    // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÊòæÁ§∫
                    this.updateUserInfo(this.currentUser);
                    
                    return true;
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÊ£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅÂ§±Ë¥•', error);
                    return false;
                }
            },
            
            // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÊòæÁ§∫
            updateUserInfo(user) {
                try {
                    const userName = document.getElementById('userName');
                    const userPoints = document.getElementById('userPoints');
                    
                    if (userName) {
                        userName.textContent = user.name || 'Áî®Êà∑';
                    }
                    
                    if (userPoints) {
                        // ‰ΩøÁî®ÁßØÂàÜÁ≥ªÁªüËé∑ÂèñÁßØÂàÜ
                        const points = window.pointsSystem ? 
                            window.pointsSystem.getPoints() : 
                            (user.points || 0);
                        userPoints.textContent = points;
                    }
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÊõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØÂ§±Ë¥•', error);
                }
            },
            
            // ÂàùÂßãÂåñÁ≤íÂ≠êÊïàÊûú
            initParticles() {
                try {
                    const particlesContainer = document.getElementById('particles');
                    const particleCount = 25;
                    
                    for (let i = 0; i < particleCount; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 10 + 's';
                        particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                        particlesContainer.appendChild(particle);
                    }
                    
                    // Ê∑ªÂä†‰∫§‰∫íÁ≤íÂ≠ê
                    for (let i = 0; i < 5; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle interactive';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 5 + 's';
                        particle.style.animationDuration = (10 + Math.random() * 5) + 's';
                        particlesContainer.appendChild(particle);
                    }
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÂàùÂßãÂåñÁ≤íÂ≠êÊïàÊûúÂ§±Ë¥•', error);
                }
            },
            
            // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨
            initEventListeners() {
                try {
                    // Áî®Êà∑‰∏ãÊãâËèúÂçï
                    const userInfo = document.getElementById('userInfo');
                    if (userInfo) {
                        userInfo.addEventListener('click', (e) => {
                            e.stopPropagation();
                            userInfo.classList.toggle('active');
                        });
                        
                        document.addEventListener('click', () => {
                            userInfo.classList.remove('active');
                        });
                    }
                    
                    // ÈÄÄÂá∫ÁôªÂΩï
                    const logoutBtn = document.getElementById('logoutBtn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', (e) => {
                            e.preventDefault();
                            this.logout();
                        });
                    }
                    
                    // ËÆæÁΩÆÊåâÈíÆ
                    const settingsBtn = document.getElementById('settingsBtn');
                    if (settingsBtn) {
                        settingsBtn.addEventListener('click', () => {
                            this.showNotification('info', 'ËÆæÁΩÆ', 'ËÆæÁΩÆÂäüËÉΩÂºÄÂèë‰∏≠...');
                        });
                    }
                    
                    // ‰æßËæπÊ†èËèúÂçïÈ°π
                    const menuItems = document.querySelectorAll('.menu-item');
                    menuItems.forEach(item => {
                        item.addEventListener('click', (e) => {
                            e.preventDefault();
                            const category = item.dataset.category;
                            if (category) {
                                this.filterByCategory(category);
                                // Êõ¥Êñ∞Ê¥ªÂä®Áä∂ÊÄÅ
                                menuItems.forEach(mi => mi.classList.remove('active'));
                                item.classList.add('active');
                            }
                        });
                    });
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨Â§±Ë¥•', error);
                }
            },
            
            // ÂàùÂßãÂåñÁßØÂàÜÁ≥ªÁªü
            initPointsSystem() {
                console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÂàùÂßãÂåñÁßØÂàÜÁ≥ªÁªü');
                
                if (window.pointsSystem) {
                    // ËÆ¢ÈòÖÁßØÂàÜÂèòÂä®‰∫ã‰ª∂
                    window.pointsSystem.subscribe((data) => {
                        console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÁßØÂàÜÁ≥ªÁªüËÆ¢ÈòÖ‰∫ã‰ª∂', data);
                        this.updatePointsDisplay(data.newPoints);
                    });
                    
                    // ÁõëÂê¨ÁßØÂàÜÊõ¥Êñ∞‰∫ã‰ª∂
                    window.addEventListener('pointsUpdated', (e) => {
                        console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÁßØÂàÜÊõ¥Êñ∞‰∫ã‰ª∂', e.detail);
                        this.updatePointsDisplay(e.detail.newPoints);
                    });
                    
                    // ÁõëÂê¨ÁßØÂàÜÊòæÁ§∫Êõ¥Êñ∞‰∫ã‰ª∂
                    window.addEventListener('pointsDisplayUpdated', (e) => {
                        console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÁßØÂàÜÊòæÁ§∫Êõ¥Êñ∞‰∫ã‰ª∂', e.detail);
                        this.updatePointsDisplay(e.detail.points);
                    });
                    
                    // ÂàùÂßãÊõ¥Êñ∞ÁßØÂàÜÊòæÁ§∫
                    const currentPoints = window.pointsSystem.getPoints();
                    this.updatePointsDisplay(currentPoints);
                    
                    console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÁßØÂàÜÁ≥ªÁªüÂàùÂßãÂåñÂÆåÊàêÔºåÂΩìÂâçÁßØÂàÜ', currentPoints);
                } else {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÁßØÂàÜÁ≥ªÁªüÊú™ÊâæÂà∞');
                }
            },
            
            // Âä†ËΩΩÂïÜÂìÅÊï∞ÊçÆ
            loadProducts() {
                try {
                    // ‰ªélocalStorageÂä†ËΩΩÂïÜÂìÅÊï∞ÊçÆ
                    const savedProducts = localStorage.getItem('mallProducts');
                    if (savedProducts) {
                        this.products = JSON.parse(savedProducts);
                    } else {
                        // Â¶ÇÊûúÊ≤°ÊúâÂïÜÂìÅÊï∞ÊçÆÔºåÂàõÂª∫ÈªòËÆ§ÂïÜÂìÅ
                        this.products = this.createDefaultProducts();
                        localStorage.setItem('mallProducts', JSON.stringify(this.products));
                    }
                    
                    // ÊòæÁ§∫ÂïÜÂìÅ
                    this.displayProducts();
                    
                    console.log('ÂïÜÂìÅÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê:', this.products.length, '‰∏™ÂïÜÂìÅ');
                } catch (error) {
                    console.error('Âä†ËΩΩÂïÜÂìÅÊï∞ÊçÆÂ§±Ë¥•:', error);
                }
            },
            
            // ÂàõÂª∫ÈªòËÆ§ÂïÜÂìÅ
            createDefaultProducts() {
                return [
                    {
                        id: 'product_1',
                        name: 'VIP‰ºöÂëò',
                        description: '‰∫´ÂèóVIPÁâπÊùÉÔºåËé∑Âæó‰∏ìÂ±ûÊ†áËØÜÂíåÁâπÊÆäÂäüËÉΩ',
                        category: 'virtual',
                        price: 1000,
                        stock: 999,
                        icon: 'üëë',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_2',
                        name: 'ÁßØÂàÜÁøªÂÄçÂç°',
                        description: '‰ΩøÁî®ÂêéËé∑ÂæóÂèåÂÄçÁßØÂàÜÂ•ñÂä±',
                        category: 'virtual',
                        price: 500,
                        stock: 100,
                        icon: 'üíé',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_3',
                        name: 'Âπ∏ËøêÈ™∞Â≠êÂà∏',
                        description: 'ÂÖçË¥πÂèÇ‰∏éÂπ∏ËøêÈ™∞Â≠êÊ∏∏Êàè',
                        category: 'virtual',
                        price: 200,
                        stock: 200,
                        icon: 'üé≤',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_4',
                        name: 'ÂÆöÂà∂Â§¥ÂÉèÊ°Ü',
                        description: '‰∏™ÊÄßÂåñ‰Ω†ÁöÑÂ§¥ÂÉèÔºåÂΩ∞ÊòæÁã¨ÁâπÈ£éÊ†º',
                        category: 'virtual',
                        price: 300,
                        stock: 50,
                        icon: 'üñºÔ∏è',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_5',
                        name: 'ÈôêÈáèÁâàÊâãÂäû',
                        description: 'Á≤æÁæéÊî∂ËóèÂìÅÔºåÈôêÈáèÂèëÂîÆ',
                        category: 'physical',
                        price: 2000,
                        stock: 10,
                        icon: 'üéÅ',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'product_6',
                        name: '‰∏ìÂ±ûÂÆ¢Êúç',
                        description: '7x24Â∞èÊó∂‰∏ìÂ±ûÂÆ¢ÊúçÊúçÂä°',
                        category: 'service',
                        price: 1500,
                        stock: 20,
                        icon: 'üéß',
                        status: 'active',
                        createdAt: new Date().toISOString()
                    }
                ];
            },
            
            // ÊòæÁ§∫ÂïÜÂìÅ
            displayProducts() {
                try {
                    const productsGrid = document.getElementById('productsGrid');
                    if (!productsGrid) return;
                    
                    // ËøáÊª§ÂïÜÂìÅ
                    let filteredProducts = this.products;
                    if (this.currentCategory !== 'all') {
                        filteredProducts = this.products.filter(product => product.category === this.currentCategory);
                    }
                    
                    if (filteredProducts.length === 0) {
                        productsGrid.innerHTML = `
                            <div style="text-align: center; padding: 3rem; color: var(--text-light);">
                                <i class="fas fa-box" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                <p style="font-size: 1.2rem;">ÊöÇÊó†ÂïÜÂìÅ</p>
                                <p style="font-size: 0.9rem; opacity: 0.7;">ËØ•ÂàÜÁ±ª‰∏ãÊöÇÊó∂Ê≤°ÊúâÂïÜÂìÅ</p>
                            </div>
                        `;
                        return;
                    }
                    
                    productsGrid.innerHTML = filteredProducts.map(product => {
                        return `
                            <div class="product-card" onclick="viewProduct('${product.id}')">
                                <div class="product-image">
                                    ${product.icon || 'üì¶'}
                                </div>
                                <div class="product-info">
                                    <div class="product-name">${product.name}</div>
                                    <div class="product-description">${product.description}</div>
                                    <div class="product-meta">
                                        <div class="product-price">üí∞ ${product.price}</div>
                                        <div class="product-stock">Â∫ìÂ≠ò: ${product.stock}</div>
                                    </div>
                                    <div class="product-actions">
                                        <button class="product-btn" onclick="event.stopPropagation(); addToCart('${product.id}')">
                                            <i class="fas fa-cart-plus"></i>
                                            <span>Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶</span>
                                        </button>
                                        <button class="product-btn secondary" onclick="event.stopPropagation(); viewProduct('${product.id}')">
                                            <i class="fas fa-eye"></i>
                                            <span>Êü•ÁúãËØ¶ÊÉÖ</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('ÊòæÁ§∫ÂïÜÂìÅÂ§±Ë¥•:', error);
                }
            },
            
            // ÊåâÂàÜÁ±ªËøáÊª§ÂïÜÂìÅ
            filterByCategory(category) {
                this.currentCategory = category;
                this.displayProducts();
            },
            
            // Âä†ËΩΩË¥≠Áâ©ËΩ¶
            loadCart() {
                try {
                    const savedCart = localStorage.getItem('mallCart');
                    if (savedCart) {
                        this.cart = JSON.parse(savedCart);
                    } else {
                        this.cart = [];
                    }
                    
                    this.updateCartUI();
                } catch (error) {
                    console.error('Âä†ËΩΩË¥≠Áâ©ËΩ¶Â§±Ë¥•:', error);
                }
            },
            
            // ‰øùÂ≠òË¥≠Áâ©ËΩ¶
            saveCart() {
                try {
                    localStorage.setItem('mallCart', JSON.stringify(this.cart));
                    this.updateCartUI();
                } catch (error) {
                    console.error('‰øùÂ≠òË¥≠Áâ©ËΩ¶Â§±Ë¥•:', error);
                }
            },
            
            // Êõ¥Êñ∞Ë¥≠Áâ©ËΩ¶UI
            updateCartUI() {
                try {
                    const cartCount = document.getElementById('cartCount');
                    const cartTotal = document.getElementById('cartTotal');
                    const cartContent = document.getElementById('cartContent');
                    
                    if (cartCount) {
                        cartCount.textContent = this.cart.length;
                    }
                    
                    if (cartTotal) {
                        const total = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                        cartTotal.textContent = total;
                    }
                    
                    if (cartContent) {
                        if (this.cart.length === 0) {
                            cartContent.innerHTML = `
                                <div style="text-align: center; padding: 2rem; color: var(--text-light);">
                                    <i class="fas fa-shopping-cart" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                    <p>Ë¥≠Áâ©ËΩ¶ÊòØÁ©∫ÁöÑ</p>
                                    <p style="font-size: 0.9rem; opacity: 0.7;">Âø´ÂéªÊ∑ªÂä†ÂïÜÂìÅÂêßÔºÅ</p>
                                </div>
                            `;
                        } else {
                            cartContent.innerHTML = this.cart.map(item => `
                                <div class="cart-item">
                                    <div class="cart-item-image">
                                        ${item.icon || 'üì¶'}
                                    </div>
                                    <div class="cart-item-info">
                                        <div class="cart-item-name">${item.name}</div>
                                        <div class="cart-item-price">üí∞ ${item.price}</div>
                                        <div class="cart-item-quantity">
                                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity - 1})">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                            <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="${item.stock}" onchange="updateQuantity('${item.id}', this.value)">
                                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', ${item.quantity + 1})">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button class="cart-item-remove" onclick="removeFromCart('${item.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            `).join('');
                        }
                    }
                } catch (error) {
                    console.error('Êõ¥Êñ∞Ë¥≠Áâ©ËΩ¶UIÂ§±Ë¥•:', error);
                }
            },
            
            // Ê∑ªÂä†Âà∞Ë¥≠Áâ©ËΩ¶
            addToCart(productId) {
                try {
                    const product = this.products.find(p => p.id === productId);
                    if (!product) {
                        this.showNotification('error', 'ÈîôËØØ', 'ÂïÜÂìÅ‰∏çÂ≠òÂú®');
                        return;
                    }
                    
                    if (product.stock <= 0) {
                        this.showNotification('error', 'Â∫ìÂ≠ò‰∏çË∂≥', 'ËØ•ÂïÜÂìÅÂ∫ìÂ≠ò‰∏çË∂≥');
                        return;
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Âú®Ë¥≠Áâ©ËΩ¶‰∏≠
                    const existingItem = this.cart.find(item => item.id === productId);
                    if (existingItem) {
                        if (existingItem.quantity >= product.stock) {
                            this.showNotification('warning', 'Â∫ìÂ≠òÈôêÂà∂', 'Â∑≤ËææÂà∞ÊúÄÂ§ßÂ∫ìÂ≠òÊï∞Èáè');
                            return;
                        }
                        existingItem.quantity += 1;
                    } else {
                        this.cart.push({
                            ...product,
                            quantity: 1
                        });
                    }
                    
                    this.saveCart();
                    this.showNotification('success', 'Ê∑ªÂä†ÊàêÂäü', `${product.name} Â∑≤Ê∑ªÂä†Âà∞Ë¥≠Áâ©ËΩ¶`);
                } catch (error) {
                    console.error('Ê∑ªÂä†Âà∞Ë¥≠Áâ©ËΩ¶Â§±Ë¥•:', error);
                }
            },
            
            // Êõ¥Êñ∞Êï∞Èáè
            updateQuantity(productId, quantity) {
                try {
                    const product = this.products.find(p => p.id === productId);
                    if (!product) return;
                    
                    if (quantity < 1) quantity = 1;
                    if (quantity > product.stock) quantity = product.stock;
                    
                    const cartItem = this.cart.find(item => item.id === productId);
                    if (cartItem) {
                        cartItem.quantity = quantity;
                        this.saveCart();
                    }
                } catch (error) {
                    console.error('Êõ¥Êñ∞Êï∞ÈáèÂ§±Ë¥•:', error);
                }
            },
            
            // ‰ªéË¥≠Áâ©ËΩ¶ÁßªÈô§
            removeFromCart(productId) {
                try {
                    this.cart = this.cart.filter(item => item.id !== productId);
                    this.saveCart();
                } catch (error) {
                    console.error('‰ªéË¥≠Áâ©ËΩ¶ÁßªÈô§Â§±Ë¥•:', error);
                }
            },
            
            // ÂàáÊç¢Ë¥≠Áâ©ËΩ¶ÊòæÁ§∫
            toggleCart() {
                try {
                    const cartSidebar = document.getElementById('cartSidebar');
                    if (cartSidebar) {
                        cartSidebar.classList.toggle('active');
                    }
                } catch (error) {
                    console.error('ÂàáÊç¢Ë¥≠Áâ©ËΩ¶ÊòæÁ§∫Â§±Ë¥•:', error);
                }
            },
            
            // Êü•ÁúãÂïÜÂìÅËØ¶ÊÉÖ
            viewProduct(productId) {
                try {
                    const product = this.products.find(p => p.id === productId);
                    if (!product) {
                        this.showNotification('error', 'ÈîôËØØ', 'ÂïÜÂìÅ‰∏çÂ≠òÂú®');
                        return;
                    }
                    
                    this.showNotification('info', 'ÂïÜÂìÅËØ¶ÊÉÖ', `
                        ÂïÜÂìÅÂêçÁß∞Ôºö${product.name}
                        ÊèèËø∞Ôºö${product.description}
                        ‰ª∑Ê†ºÔºöüí∞ ${product.price}
                        Â∫ìÂ≠òÔºö${product.stock}
                        ÂàÜÁ±ªÔºö${product.category}
                        Áä∂ÊÄÅÔºö${product.status}
                    `);
                } catch (error) {
                    console.error('Êü•ÁúãÂïÜÂìÅËØ¶ÊÉÖÂ§±Ë¥•:', error);
                }
            },
            
            // Âà∑Êñ∞ÂïÜÂìÅ
            refreshProducts() {
                try {
                    this.loadProducts();
                    this.showNotification('success', 'Âà∑Êñ∞ÊàêÂäü', 'ÂïÜÂìÅÂàóË°®Â∑≤Êõ¥Êñ∞');
                } catch (error) {
                    console.error('Âà∑Êñ∞ÂïÜÂìÅÂ§±Ë¥•:', error);
                }
            },
            
            // ÁªìÁÆó - ÂÆåÂÖ®‰øÆÂ§çÁâà
            checkout() {
                try {
                    console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÂºÄÂßãÁªìÁÆóÊµÅÁ®ã');
                    
                    if (this.cart.length === 0) {
                        this.showNotification('warning', 'Ë¥≠Áâ©ËΩ¶‰∏∫Á©∫', 'ËØ∑ÂÖàÊ∑ªÂä†ÂïÜÂìÅÂà∞Ë¥≠Áâ©ËΩ¶');
                        return;
                    }
                    
                    const total = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    
                    // ‰øÆÂ§çÔºöÁõ¥Êé•‰ªéÁßØÂàÜÁ≥ªÁªüËé∑ÂèñÁßØÂàÜ
                    let userPoints = 0;
                    if (window.pointsSystem) {
                        userPoints = window.pointsSystem.getPoints();
                        console.log('ÂïÜÂüéÁ≥ªÁªüÔºö‰ªéÁßØÂàÜÁ≥ªÁªüËé∑ÂèñÁßØÂàÜ', userPoints);
                    } else {
                        // Â§áÁî®ÊñπÊ°à
                        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                        userPoints = currentUser.points || 0;
                        console.log('ÂïÜÂüéÁ≥ªÁªüÔºö‰ªéÁî®Êà∑Êï∞ÊçÆËé∑ÂèñÁßØÂàÜ', userPoints);
                    }
                    
                    console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÁªìÁÆó‰ø°ÊÅØ', { total, userPoints });
                    
                    if (userPoints < total) {
                        this.showNotification('error', 'ÁßØÂàÜ‰∏çË∂≥', `ÈúÄË¶Å ${total} ÁßØÂàÜÔºåÂΩìÂâçÂè™Êúâ ${userPoints} ÁßØÂàÜ`);
                        return;
                    }
                    
                    // Á°ÆËÆ§ÁªìÁÆó
                    if (confirm(`Á°ÆËÆ§ÁªìÁÆóÔºüÊÄªËÆ°Ôºö${total} ÁßØÂàÜ`)) {
                        console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÁî®Êà∑Á°ÆËÆ§ÁªìÁÆóÔºåÂºÄÂßãÊâ£Èô§ÁßØÂàÜ');
                        
                        // Êâ£Èô§ÁßØÂàÜ
                        if (window.pointsSystem) {
                            const result = window.pointsSystem.deductPoints(total, 'ÂïÜÂüéË¥≠‰π∞');
                            
                            if (result.success) {
                                console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÁßØÂàÜÊâ£Èô§ÊàêÂäü', result);
                                
                                // Ê∏ÖÁ©∫Ë¥≠Áâ©ËΩ¶
                                this.cart = [];
                                this.saveCart();
                                
                                // ÂÖ≥Èó≠Ë¥≠Áâ©ËΩ¶
                                const cartSidebar = document.getElementById('cartSidebar');
                                if (cartSidebar) {
                                    cartSidebar.classList.remove('active');
                                }
                                
                                this.showNotification('success', 'Ë¥≠‰π∞ÊàêÂäü', `Â∑≤ÊàêÂäüË¥≠‰π∞ÂïÜÂìÅÔºåÊâ£Èô§ ${total} ÁßØÂàÜ`);
                                
                                // ËÆ∞ÂΩïË¥≠‰π∞ÂéÜÂè≤
                                this.recordPurchaseHistory();
                                
                                // Êõ¥Êñ∞ÁßØÂàÜÊòæÁ§∫
                                this.updatePointsDisplay(result.newPoints);
                                
                            } else {
                                console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÁßØÂàÜÊâ£Èô§Â§±Ë¥•', result);
                                this.showNotification('error', 'Ë¥≠‰π∞Â§±Ë¥•', result.error);
                            }
                        } else {
                            this.showNotification('error', 'Á≥ªÁªüÈîôËØØ', 'ÁßØÂàÜÁ≥ªÁªü‰∏çÂèØÁî®');
                        }
                    }
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÁªìÁÆóÂ§±Ë¥•', error);
                    this.showNotification('error', 'ÁªìÁÆóÂ§±Ë¥•', 'ÁªìÁÆóÊó∂ÂèëÁîüÈîôËØØ');
                }
            },
            
            // ËÆ∞ÂΩïË¥≠‰π∞ÂéÜÂè≤
            recordPurchaseHistory() {
                try {
                    const purchaseHistory = JSON.parse(localStorage.getItem('purchaseHistory') || '[]');
                    const purchase = {
                        id: 'purchase_' + Date.now(),
                        items: [...this.cart],
                        total: this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                        timestamp: new Date().toISOString(),
                        userId: JSON.parse(localStorage.getItem('currentUser') || '{}').id || 'unknown'
                    };
                    
                    purchaseHistory.unshift(purchase);
                    
                    // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè
                    if (purchaseHistory.length > 1000) {
                        purchaseHistory.splice(1000);
                    }
                    
                    localStorage.setItem('purchaseHistory', JSON.stringify(purchaseHistory));
                    
                    // ÂàõÂª∫ËÆ¢ÂçïÊï∞ÊçÆÂπ∂ÂêåÊ≠•Âà∞admin
                    this.createOrderAndSync(purchase);
                    
                    console.log('ÂïÜÂüéÁ≥ªÁªüÔºöË¥≠‰π∞ÂéÜÂè≤Â∑≤ËÆ∞ÂΩï');
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöËÆ∞ÂΩïË¥≠‰π∞ÂéÜÂè≤Â§±Ë¥•', error);
                }
            },
            
            // ÂàõÂª∫ËÆ¢ÂçïÂπ∂ÂêåÊ≠•Âà∞admin
            createOrderAndSync(purchase) {
                try {
                    // ÂàõÂª∫ËÆ¢ÂçïÊï∞ÊçÆ
                    const order = {
                        id: 'ORDER' + Date.now(),
                        buyer: purchase.userId || 'unknown',
                        item: purchase.items.map(item => item.name).join(', '),
                        quantity: purchase.items.reduce((sum, item) => sum + item.quantity, 0),
                        totalPrice: purchase.total,
                        status: 'completed',
                        timestamp: purchase.timestamp,
                        createdAt: purchase.timestamp,
                        items: purchase.items,
                        source: 'mall_purchase'
                    };
                    
                    // ‰øùÂ≠òÂà∞ userOrders
                    const userOrders = JSON.parse(localStorage.getItem('userOrders') || '[]');
                    userOrders.unshift(order);
                    
                    // ÈôêÂà∂ËÆ¢ÂçïÊï∞Èáè
                    if (userOrders.length > 1000) {
                        userOrders.splice(1000);
                    }
                    
                    localStorage.setItem('userOrders', JSON.stringify(userOrders));
                    
                    // ‰øùÂ≠òÂà∞Áî®Êà∑‰∏™‰∫∫ËÆ¢Âçï
                    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    const userOrdersKey = `orders_${currentUser.id || currentUser.username}`;
                    const userPersonalOrders = JSON.parse(localStorage.getItem(userOrdersKey) || '[]');
                    userPersonalOrders.unshift(order);
                    
                    if (userPersonalOrders.length > 1000) {
                        userPersonalOrders.splice(1000);
                    }
                    
                    localStorage.setItem(userOrdersKey, JSON.stringify(userPersonalOrders));
                    
                    // ÂêåÊ≠•Âà∞admin.html
                    this.syncOrderToAdmin(order);
                    
                    console.log('ÂïÜÂüéÁ≥ªÁªüÔºöËÆ¢ÂçïÂ∑≤ÂàõÂª∫Âπ∂ÂêåÊ≠•Âà∞admin', order.id);
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÂàõÂª∫ËÆ¢ÂçïÂπ∂ÂêåÊ≠•Â§±Ë¥•', error);
                }
            },
            
            // ÂêåÊ≠•ËÆ¢ÂçïÂà∞admin
            syncOrderToAdmin(order) {
                try {
                    console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÂêåÊ≠•ËÆ¢ÂçïÂà∞adminÂºÄÂßã', order.id);
                    
                    // Ëß¶ÂèëÊï∞ÊçÆÂêåÊ≠•‰∫ã‰ª∂
                    this.triggerDataSync('order', 'create', order);
                    
                    // Ëß¶ÂèëËÆ¢ÂçïÂêåÊ≠•‰∫ã‰ª∂
                    const orderSyncEvent = new CustomEvent('orderSync', {
                        detail: {
                            type: 'order',
                            action: 'create',
                            data: order
                        }
                    });
                    
                    window.dispatchEvent(orderSyncEvent);
                    
                    // Ëß¶ÂèëÊú¨Âú∞Â≠òÂÇ®‰∫ã‰ª∂
                    const localEvent = new CustomEvent('localStorageSync', {
                        detail: {
                            type: 'order',
                            action: 'create',
                            data: order
                        }
                    });
                    
                    window.dispatchEvent(localEvent);
                    
                    console.log('ÂïÜÂüéÁ≥ªÁªüÔºöËÆ¢ÂçïÂ∑≤ÂêåÊ≠•Âà∞admin', order.id);
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÂêåÊ≠•ËÆ¢ÂçïÂà∞adminÂ§±Ë¥•', error);
                }
            },
            
            // Ëß¶ÂèëÊï∞ÊçÆÂêåÊ≠•‰∫ã‰ª∂
            triggerDataSync(type, action, data) {
                try {
                    const syncEvent = new CustomEvent('dataSync', {
                        detail: {
                            type: type,
                            action: action,
                            data: data
                        }
                    });
                    
                    // Ëß¶Âèë‰∫ã‰ª∂
                    window.dispatchEvent(syncEvent);
                    
                    // Ëß¶ÂèëÊú¨Âú∞Â≠òÂÇ®‰∫ã‰ª∂
                    const localEvent = new CustomEvent('localStorageSync', {
                        detail: {
                            type: type,
                            action: action,
                            data: data
                        }
                    });
                    
                    window.dispatchEvent(localEvent);
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöËß¶ÂèëÊï∞ÊçÆÂêåÊ≠•‰∫ã‰ª∂Â§±Ë¥•', error);
                }
            },
            
            // Êõ¥Êñ∞UI
            updateUI() {
                try {
                    // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
                    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                    this.updateUserInfo(currentUser);
                    
                    // Êõ¥Êñ∞Ë¥≠Áâ©ËΩ¶
                    this.updateCartUI();
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÊõ¥Êñ∞UIÂ§±Ë¥•', error);
                }
            },
            
            // Êõ¥Êñ∞ÁßØÂàÜÊòæÁ§∫ - ‰øÆÂ§çÁâà
            updatePointsDisplay(points) {
                console.log('ÂïÜÂüéÁ≥ªÁªüÔºöÊõ¥Êñ∞ÁßØÂàÜÊòæÁ§∫', points);
                
                // Êõ¥Êñ∞ÊâÄÊúâÊòæÁ§∫ÁßØÂàÜÁöÑÂÖÉÁ¥†
                const pointsElements = document.querySelectorAll('[id*="userPoints"], [class*="user-points"]');
                pointsElements.forEach(element => {
                    if (element.tagName === 'SPAN') {
                        element.textContent = points;
                    } else if (element.tagName === 'DIV') {
                        const span = element.querySelector('span');
                        if (span) {
                            span.textContent = points;
                        } else {
                            element.textContent = `üí∞ ${points}`;
                        }
                    }
                });
                
                // Ëß¶ÂèëÁßØÂàÜÊòæÁ§∫Êõ¥Êñ∞‰∫ã‰ª∂
                window.dispatchEvent(new CustomEvent('pointsDisplayUpdated', { points }));
            },
            
            // ÈÄÄÂá∫ÁôªÂΩï
            logout() {
                try {
                    // ‰ΩøÁî®Áî®Êà∑Á≥ªÁªüÈÄÄÂá∫
                    if (window.userSystem) {
                        window.userSystem.logout();
                    } else {
                        // Â§áÁî®ÊñπÊ°à
                        localStorage.removeItem('isLoggedIn');
                        localStorage.removeItem('currentUser');
                        this.showNotification('info', 'ÈÄÄÂá∫ÁôªÂΩï', 'ÊÇ®Â∑≤ÊàêÂäüÈÄÄÂá∫ÁôªÂΩï');
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 1000);
                    }
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÈÄÄÂá∫ÁôªÂΩïÂ§±Ë¥•', error);
                }
            },
            
            // ÊòæÁ§∫ÈÄöÁü•
            showNotification(type, title, message) {
                try {
                    // ÁßªÈô§Áé∞ÊúâÈÄöÁü•
                    const existing = document.querySelector('.notification');
                    if (existing) existing.remove();
                    
                    // ÂàõÂª∫Êñ∞ÈÄöÁü•
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    notification.innerHTML = `
                        <div class="notification-icon">${type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚ÑπÔ∏è'}</div>
                        <div class="notification-content">
                            <div class="notification-title">${title}</div>
                            <div class="notification-message">${message}</div>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // ÊòæÁ§∫Âä®Áîª
                    setTimeout(() => notification.classList.add('show'), 100);
                    
                    // Ëá™Âä®ÈöêËóè
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                } catch (error) {
                    console.error('ÂïÜÂüéÁ≥ªÁªüÔºöÊòæÁ§∫ÈÄöÁü•Â§±Ë¥•', error);
                }
            }
        };
        
        // ÂÖ®Â±ÄÂáΩÊï∞
        function filterByCategory(category) {
            MallSystem.filterByCategory(category);
        }
        
        function addToCart(productId) {
            MallSystem.addToCart(productId);
        }
        
        function updateQuantity(productId, quantity) {
            MallSystem.updateQuantity(productId, quantity);
        }
        
        function removeFromCart(productId) {
            MallSystem.removeFromCart(productId);
        }
        
        function toggleCart() {
            MallSystem.toggleCart();
        }
        
        function viewProduct(productId) {
            MallSystem.viewProduct(productId);
        }
        
        function refreshProducts() {
            MallSystem.refreshProducts();
        }
        
        function checkout() {
            MallSystem.checkout();
        }
        
        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== Â§©ÂàõÂïÜÂüéÁ≥ªÁªüÂàùÂßãÂåñ ===');
            MallSystem.init();
        });
    </script>
</body>
</html>
