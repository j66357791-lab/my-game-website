<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âπ∏ËøêÈ™∞Â≠ê - Â§©ÂàõÊ∏∏ÊàèÂπ≥Âè∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF7043;
            --secondary: #FFB74D;
            --accent: #FFC107;
            --bg-dark: #2C3E50;
            --bg-light: #34495E;
            --text-light: #ECF0F1;
            --gradient: linear-gradient(135deg, #FF7043, #FFB74D, #FFC107);
            --shadow: 0 8px 25px rgba(255, 112, 67, 0.3);
            --transition: all 0.3s ease;
            --border-radius: 20px;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b1b 50%, #0f0f0f 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* ÊÅêÊÄñËÉåÊôØ - ÂêåÊ≠•‰∏ªÈ°µ */
        .horror-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(139, 0, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(75, 0, 130, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 0, 0, 0.2) 0%, transparent 50%);
            animation: horrorPulse 4s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes horrorPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        /* Èó™ÁîµÊïàÊûú */
        .lightning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0);
            pointer-events: none;
            z-index: 100;
        }
        
        .lightning.flash {
            animation: lightningFlash 0.3s ease-out;
        }
        
        @keyframes lightningFlash {
            0% { background: rgba(255, 255, 255, 0); }
            50% { background: rgba(255, 255, 255, 0.8); }
            100% { background: rgba(255, 255, 255, 0); }
        }
        
        /* Âä®ÊÄÅËÉåÊôØÁ≤íÂ≠ê */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gradient);
            border-radius: 50%;
            opacity: 0.6;
            animation: particleFloat 20s linear infinite;
        }
        
        .particle.interactive {
            width: 6px;
            height: 6px;
            opacity: 0.8;
            animation: particleFloat 15s linear infinite;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-10vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* Â®±‰πêÊÄßËÉåÊôØÂÖÉÁ¥† */
        .bg-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }
        
        .bg-element {
            position: absolute;
            font-size: 2rem;
            opacity: 0.1;
            animation: bgFloat 25s linear infinite;
        }
        
        @keyframes bgFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.1;
            }
            90% {
                opacity: 0.1;
            }
            100% {
                transform: translateY(-10vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* ÂØºËà™Ê†è */
        .header {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: var(--shadow);
            animation: avatarGlow 3s ease-in-out infinite;
        }
        
        @keyframes avatarGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 112, 67, 0.5);
            }
            50% {
                box-shadow: 0 0 30px rgba(255, 112, 67, 0.8);
            }
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            color: white;
            font-size: 1.1rem;
        }
        
        .user-points {
            background: var(--gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(255, 112, 67, 0.3);
        }
        
        .user-dropdown {
            position: relative;
        }
        
        .user-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1rem;
            margin-top: 0.5rem;
            min-width: 200px;
            box-shadow: var(--shadow);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 1001;
        }
        
        .user-dropdown.active .user-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            color: var(--text-light);
            text-decoration: none;
        }
        
        .user-dropdown-item:hover {
            background: rgba(255, 112, 67, 0.1);
        }
        
        .user-dropdown-divider {
            height: 1px;
            background: rgba(255, 112, 67, 0.3);
            margin: 0.5rem 0;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }
        
        /* ‰∏ªÂÆπÂô® */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }
        
        /* Ê∏∏ÊàèÂÆπÂô® */
        .game-container {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
            position: relative;
            z-index: 10;
            overflow: hidden;
            border: 2px solid rgba(255, 0, 0, 0.3);
        }
        
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient);
            opacity: 0.05;
            z-index: -1;
        }
        
        .game-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 2rem;
            animation: titleGlow 3s ease-in-out infinite;
            text-shadow: 0 3px 6px rgba(255, 0, 0, 0.5);
        }
        
        @keyframes titleGlow {
            0%, 100% {
                text-shadow: 0 3px 6px rgba(255, 0, 0, 0.5);
            }
            50% {
                text-shadow: 0 3px 15px rgba(255, 0, 0, 0.8);
            }
        }
        
        /* Ê∏∏ÊàèËÆæÁΩÆÂå∫Âüü */
        .game-settings {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255, 112, 67, 0.3);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .game-settings::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient);
            opacity: 0.05;
            z-index: -1;
        }
        
        .settings-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .setting-item {
            text-align: center;
        }
        
        .setting-label {
            color: white;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        
        .setting-value {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 10px;
            padding: 0.75rem;
            color: white;
            font-size: 1rem;
            text-align: center;
        }
        
        .rounds-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        
        .rounds-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 112, 67, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .rounds-btn:hover {
            background: rgba(255, 112, 67, 0.2);
        }
        
        .rounds-btn.active {
            background: var(--gradient);
            border-color: var(--primary);
        }
        
        .play-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .play-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .play-btn:hover::before {
            left: 100%;
        }
        
        .play-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .play-btn:disabled {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            cursor: not-allowed;
            transform: none;
        }
        
        /* Ê∏∏ÊàèÂå∫Âüü */
        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }
        
        /* È™∞Â≠êÂå∫Âüü */
        .dice-section {
            text-align: center;
            position: relative;
        }
        
        .dice-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            position: relative;
            perspective: 1000px;
        }
        
        .dice {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #e67e22, #d35400);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            color: white;
            box-shadow: 0 20px 40px rgba(230, 126, 34, 0.4);
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
        }
        
        .dice::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF69B4, #FF1493);
            border-radius: 20px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .dice:hover::before {
            opacity: 0.6;
        }
        
        .dice.rolling {
            animation: rollDice 1.5s ease-in-out;
        }
        
        @keyframes rollDice {
            0% { 
                transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); 
            }
            25% { 
                transform: rotateX(180deg) rotateY(90deg) rotateZ(90deg); 
            }
            50% { 
                transform: rotateX(360deg) rotateY(180deg) rotateZ(180deg); 
            }
            75% { 
                transform: rotateX(540deg) rotateY(270deg) rotateZ(270deg); 
            }
            100% { 
                transform: rotateX(720deg) rotateY(360deg) rotateZ(360deg); 
            }
        }
        
        .round-result {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1rem;
            margin: 1rem 0;
            color: white;
            font-weight: 600;
        }
        
        .round-result.win {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }
        
        .round-result.lose {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }
        
        /* ÊäïÊ≥®Âå∫Âüü */
        .bet-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255, 112, 67, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .bet-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient);
            opacity: 0.05;
            z-index: -1;
        }
        
        .bet-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .bet-info {
            background: rgba(255, 112, 67, 0.1);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .bet-amount {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .bet-description {
            color: #ddd;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        .multiplier-info {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 1rem;
            animation: keyGlow 2s ease-in-out infinite;
        }
        
        @keyframes keyGlow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }
        }
        
        /* ÂÆùÁÆ±Âå∫Âüü */
        .treasure-section {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .treasure-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            opacity: 0.05;
            z-index: -1;
            animation: treasureGlow 3s ease-in-out infinite;
        }
        
        @keyframes treasureGlow {
            0%, 100% { opacity: 0.05; }
            50% { opacity: 0.1; }
        }
        
        .treasure-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
        }
        
        .treasure-box-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .treasure-box {
            width: 140px;
            height: 140px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            color: white;
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            animation: treasureFloat 3s ease-in-out infinite;
        }
        
        @keyframes treasureFloat {
            0%, 100% { 
                transform: translateY(0px) scale(1); 
            }
            50% { 
                transform: translateY(-10px) scale(1.05); 
            }
        }
        
        .treasure-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF69B4, #FF1493);
            border-radius: 20px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .treasure-box:hover::before {
            opacity: 0.8;
        }
        
        .treasure-box:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 25px 50px rgba(255, 215, 0, 0.5);
        }
        
        .treasure-box.opening {
            animation: boxOpen 2s ease-in-out forwards;
        }
        
        @keyframes boxOpen {
            0% { 
                transform: scale(1) rotate(0deg); 
            }
            25% { 
                transform: scale(1.1) rotate(5deg); 
            }
            50% { 
                transform: scale(1.2) rotate(-5deg); 
            }
            75% { 
                transform: scale(1.1) rotate(5deg); 
            }
            100% { 
                transform: scale(0) rotate(360deg); 
                opacity: 0; 
            }
        }
        
        .key-count {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 15px;
            padding: 0.75rem 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
        }
        
        .open-treasure-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .open-treasure-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
        }
        
        .open-treasure-btn:disabled {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            cursor: not-allowed;
            transform: none;
        }
        
        /* ÂéÜÂè≤ËÆ∞ÂΩï */
        .history-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .history-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }
        
        .history-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .history-item:last-child {
            margin-bottom: 0;
        }
        
        .history-dice {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e67e22;
        }
        
        .history-details {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .history-amount {
            font-weight: bold;
            color: white;
        }
        
        .history-multiplier {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .history-result {
            font-weight: bold;
        }
        
        .history-result.win {
            color: #28a745;
        }
        
        .history-result.lose {
            color: #dc3545;
        }
        
        .history-key {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* ÁªüËÆ°Êï∞ÊçÆ */
        .stats-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .stats-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #ddd;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        
        .stat-value.positive {
            color: #28a745;
        }
        
        .stat-value.negative {
            color: #dc3545;
        }
        
        /* Ê∂àÊÅØÊèêÁ§∫ */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: var(--shadow);
            max-width: 350px;
            backdrop-filter: blur(10px);
        }
        
        .message.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .message.error {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .message.info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }
        
        .message.treasure {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        .message.key {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            animation: keyPulse 2s ease-in-out infinite;
        }
        
        @keyframes keyPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* ÁªìÁÆóÂºπÁ™ó */
        .settlement-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .settlement-modal.active {
            display: flex;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .settlement-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 30px;
            padding: 3rem;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid rgba(255, 112, 67, 0.5);
            position: relative;
            animation: modalSlideUp 0.3s ease-out;
        }
        
        @keyframes modalSlideUp {
            from { 
                transform: translateY(50px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }
        
        .settlement-title {
            font-size: 2rem;
            font-weight: bold;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 2rem;
        }
        
        .settlement-summary {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .summary-item:last-child {
            border-bottom: none;
            font-size: 1.2rem;
            font-weight: bold;
            padding-top: 1rem;
            margin-top: 0.5rem;
            border-top: 2px solid rgba(255, 112, 67, 0.3);
        }
        
        .summary-item.profit {
            color: #28a745;
        }
        
        .summary-item.loss {
            color: #dc3545;
        }
        
        .summary-label {
            color: #ddd;
            font-weight: 600;
        }
        
        .summary-value {
            color: white;
            font-weight: bold;
        }
        
        .rounds-results {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 2rem;
        }
        
        .round-result-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .round-result-item.win {
            border-left: 4px solid #28a745;
        }
        
        .round-result-item.lose {
            border-left: 4px solid #dc3545;
        }
        
        .round-dice {
            font-size: 1.2rem;
            color: #e67e22;
            font-weight: bold;
        }
        
        .round-points {
            color: white;
            font-weight: 600;
        }
        
        .round-points.win {
            color: #28a745;
        }
        
        .round-points.lose {
            color: #dc3545;
        }
        
        .settlement-close-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .settlement-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .dice-container {
                gap: 1rem;
            }
            
            .dice {
                width: 100px;
                height: 100px;
                font-size: 3rem;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .treasure-box-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .treasure-box {
                width: 120px;
                height: 120px;
                font-size: 3rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .settlement-content {
                padding: 2rem;
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- ÊÅêÊÄñËÉåÊôØ - ÂêåÊ≠•‰∏ªÈ°µ -->
    <div class="horror-bg"></div>
    <div class="lightning" id="lightning"></div>
    
    <!-- Âä®ÊÄÅËÉåÊôØÁ≤íÂ≠ê -->
    <div class="particles" id="particles"></div>
    
    <!-- Â®±‰πêÊÄßËÉåÊôØÂÖÉÁ¥† -->
    <div class="bg-elements" id="bgElements"></div>
    
    <!-- È°∂ÈÉ®ÂØºËà™ -->
    <div class="header">
        <div class="user-info" id="userInfo">
            <div class="user-avatar">üë§</div>
            <div class="user-details">
                <div class="user-name" id="userName">Âä†ËΩΩ‰∏≠...</div>
                <div class="user-points">üí∞ <span id="userPoints">0</span></div>
            </div>
            <div class="user-dropdown-menu">
                <a href="user-center.html" class="user-dropdown-item">
                    <i class="fas fa-user"></i>
                    ‰∏™‰∫∫‰∏≠ÂøÉ
                </a>
                <a href="user-center.html?tab=orders" class="user-dropdown-item">
                    <i class="fas fa-shopping-cart"></i>
                    ÊàëÁöÑËÆ¢Âçï
                </a>
                <div class="user-dropdown-divider"></div>
                <a href="#" class="user-dropdown-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    ÈÄÄÂá∫ÁôªÂΩï
                </a>
            </div>
        </div>
        <a href="games.html" class="back-btn">üè† ËøîÂõûÊ∏∏Êàè‰∏≠ÂøÉ</a>
    </div>
    
    <!-- ‰∏ªÂÆπÂô® -->
    <div class="main-container">
        <div class="game-container">
            <h1 class="game-title">üé≤ Âπ∏ËøêÈ™∞Â≠ê</h1>
            
            <!-- Ê∏∏ÊàèËÆæÁΩÆÂå∫Âüü -->
            <div class="game-settings">
                <div class="settings-title">‚öôÔ∏è Ê∏∏ÊàèËÆæÁΩÆ</div>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-label">ÊäïÊ≥®ÁßØÂàÜ</div>
                        <div class="setting-value">5 ÁßØÂàÜ/Â±Ä</div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">ÂÄçÁéáËßÑÂàô</div>
                        <div class="setting-value">0.6 √ó ÊÄªÁÇπÊï∞</div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Ê∏∏ÊàèÂ±ÄÊï∞</div>
                        <div class="rounds-selector">
                            <button class="rounds-btn" data-rounds="1">1Â±Ä</button>
                            <button class="rounds-btn" data-rounds="3">3Â±Ä</button>
                            <button class="rounds-btn" data-rounds="5">5Â±Ä</button>
                            <button class="rounds-btn" data-rounds="10">10Â±Ä</button>
                        </div>
                    </div>
                </div>
                <button class="play-btn" id="playBtn">üé≤ ÂºÄÂßãÊ∏∏Êàè</button>
            </div>
            
            <!-- Ê∏∏ÊàèÂå∫Âüü -->
            <div class="game-area">
                <!-- È™∞Â≠êÂå∫Âüü -->
                <div class="dice-section">
                    <div class="dice-container" id="diceContainer">
                        <!-- ‰øùÁïôÂéüÊúâÁöÑ‰∏â‰∏™È™∞Â≠ê -->
                        <div class="dice" id="dice1">üé≤</div>
                        <div class="dice" id="dice2">üé≤</div>
                        <div class="dice" id="dice3">üé≤</div>
                    </div>
                    <div class="round-result" id="roundResult">ÂáÜÂ§áÂºÄÂßã</div>
                </div>
                
                <!-- ÊäïÊ≥®Âå∫Âüü -->
                <div class="bet-section">
                    <div class="bet-title">üí∞ ÊäïÊ≥®‰ø°ÊÅØ</div>
                    <div class="bet-info">
                        <div class="bet-amount">5 ÁßØÂàÜ/Â±Ä</div>
                        <div class="bet-description">ÊØèÂ±ÄÊäïÊ≥®5ÁßØÂàÜÔºåËé∑ÂæóÁßØÂàÜ = 0.6 √ó ÊÄªÁÇπÊï∞</div>
                        <div class="multiplier-info">üéØ ÂÄçÁéá: 0.6 √ó ÁÇπÊï∞</div>
                    </div>
                </div>
            </div>
            
            <!-- ÂÆùÁÆ±Âå∫Âüü -->
            <div class="treasure-section">
                <div class="treasure-title">üéÅ ÂÆùÁÆ±Á≥ªÁªü</div>
                <div class="treasure-box-container">
                    <div class="treasure-box" id="treasureBox">üéÅ</div>
                </div>
                <div class="key-count">üîë ÈáëÈí•Âåô: <span id="keyCount">0</span> Êää</div>
                <button class="open-treasure-btn" id="openTreasureBtn">üéÅ ÊâìÂºÄÂÆùÁÆ± (Ê∂àËÄó1ÊääÈí•Âåô)</button>
            </div>
            
            <!-- ÂéÜÂè≤ËÆ∞ÂΩï -->
            <div class="history-section">
                <div class="history-title">üìä Ê∏∏ÊàèËÆ∞ÂΩï</div>
                <div class="history-list" id="historyList">
                    <div class="history-item">
                        <div class="history-dice">üé≤üé≤üé≤</div>
                        <div class="history-details">
                            <span class="history-amount">ÊäïÊ≥®: 5</span>
                            <span class="history-multiplier">ÂÄçÁéá: 0.6x</span>
                            <span class="history-result win">Ëµ¢Âæó: 3</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÁªüËÆ°Êï∞ÊçÆ -->
            <div class="stats-section">
                <div class="stats-title">üìà Ê∏∏ÊàèÁªüËÆ°</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ÊÄªÂ±ÄÊï∞</div>
                        <div class="stat-value" id="totalRounds">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ÊÄªÊäïÊ≥®</div>
                        <div class="stat-value" id="totalBet">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ÊÄªËé∑Âæó</div>
                        <div class="stat-value positive" id="totalWin">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ÂáÄÁõàÂà©</div>
                        <div class="stat-value" id="netProfit">0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÁªìÁÆóÂºπÁ™ó -->
    <div class="settlement-modal" id="settlementModal">
        <div class="settlement-content">
            <h2 class="settlement-title">üé≤ Ê∏∏ÊàèÁªìÁÆó</h2>
            <div class="settlement-summary">
                <div class="summary-item">
                    <span class="summary-label">Ê∏∏ÊàèÂ±ÄÊï∞Ôºö</span>
                    <span class="summary-value" id="summaryRounds">0</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ÊÄªÊäïÊ≥®Ôºö</span>
                    <span class="summary-value" id="summaryBet">0</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">ÊÄªËé∑ÂæóÔºö</span>
                    <span class="summary-value" id="summaryWin">0</span>
                </div>
                <div class="summary-item" id="summaryProfitItem">
                    <span class="summary-label">ÂáÄÁõàÂà©Ôºö</span>
                    <span class="summary-value" id="summaryProfit">0</span>
                </div>
            </div>
            <div class="rounds-results" id="roundsResults">
                <!-- ÂêÑÂ±ÄÁªìÊûúÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
            </div>
            <button class="settlement-close-btn" id="settlementCloseBtn">Á°ÆÂÆö</button>
        </div>
    </div>

    <!-- Ê†∏ÂøÉÁ≥ªÁªüÊñá‰ª∂ -->
    <script src="js/api-config.js"></script>
    <script src="js/api-service.js"></script>
    <script src="js/data-adapter.js"></script>
    <script src="js/points-system.js"></script>
    <script src="js/user-system.js"></script>
    <script src="js/common.js"></script>

    <!-- Ê∏∏ÊàèÈÄªËæë -->
    <script>
        // Á≠âÂæÖÊâÄÊúâÁ≥ªÁªüÂä†ËΩΩÂÆåÊàê
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== DOMÂä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÂàùÂßãÂåñÊ∏∏ÊàèÁ≥ªÁªü ===');
            
            // Âª∂ËøüÂàùÂßãÂåñÔºåÁ°Æ‰øùÊâÄÊúâÁ≥ªÁªüÈÉΩÂ∑≤Âä†ËΩΩ
            setTimeout(() => {
                // Ê£ÄÊü•ÂÖ≥ÈîÆÁ≥ªÁªüÊòØÂê¶Âä†ËΩΩ
                if (typeof window.dataAdapter === 'undefined') {
                    console.error('dataAdapterÊú™Âä†ËΩΩ');
                    return;
                }
                
                if (typeof window.pointsSystem === 'undefined') {
                    console.error('pointsSystemÊú™Âä†ËΩΩ');
                    return;
                }
                
                if (typeof window.userSystem === 'undefined') {
                    console.error('userSystemÊú™Âä†ËΩΩ');
                    return;
                }
                
                console.log('‚úÖ ÊâÄÊúâÁ≥ªÁªüÂä†ËΩΩÊ≠£Â∏∏ÔºåÂºÄÂßãÂàùÂßãÂåñÊ∏∏Êàè');
                
                // Âπ∏ËøêÈ™∞Â≠êÊ∏∏ÊàèÁ≥ªÁªü - ÊúÄÁªàÁâàÊú¨
                window.DiceGame = {
                    // Ê∏∏ÊàèÁä∂ÊÄÅ
                    gameState: {
                        currentBet: 5,
                        multiplier: 0.6,
                        selectedRounds: 1,
                        isPlaying: false,
                        history: [],
                        goldKeys: 0,
                        stats: {
                            totalRounds: 0,
                            totalBet: 0,
                            totalWin: 0,
                            netProfit: 0
                        }
                    },
                    
                    // È™∞Â≠êÊ¶ÇÁéáÈÖçÁΩÆ - Êñ∞ÁöÑÊ¶ÇÁéá
                    diceProbability: [
                        { value: 1, probability: 0.35 },  // 1ÁÇπ35%
                        { value: 2, probability: 0.15 },  // 2ÁÇπ15%
                        { value: 3, probability: 0.25 },  // 3ÁÇπ25%
                        { value: 4, probability: 0.15 },  // 4ÁÇπ15%
                        { value: 5, probability: 0.06 },  // 5ÁÇπ6%
                        { value: 6, probability: 0.04 }   // 6ÁÇπ4%
                    ],
                    
                    // ÂÆùÁÆ±Â•ñÂä±ÈÖçÁΩÆ - Êñ∞ÁöÑÂ•ñÂä±
                    treasureRewards: [
                        { value: 88, type: 'points', probability: 0.01, description: 'Ëé∑Âæó88ÁßØÂàÜ' },      // 1%
                        { value: 58, type: 'points', probability: 0.015, description: 'Ëé∑Âæó58ÁßØÂàÜ' },     // 1.5%
                        { value: 28, type: 'points', probability: 0.025, description: 'Ëé∑Âæó28ÁßØÂàÜ' },     // 2.5%
                        { value: 8.88, type: 'crutch', probability: 0.15, description: 'Ëé∑Âæó8.88‰∏™ÊãêÊùñ' },   // 15%
                        { value: 6.66, type: 'crutch', probability: 0.20, description: 'Ëé∑Âæó6.66‰∏™ÊãêÊùñ' },   // 20%
                        { value: 2.88, type: 'crutch', probability: 0.25, description: 'Ëé∑Âæó2.88‰∏™ÊãêÊùñ' },   // 25%
                        { value: 1.88, type: 'crutch', probability: 0.35, description: 'Ëé∑Âæó1.88‰∏™ÊãêÊùñ' }    // 35%
                    ],
                    
                    // ÂàùÂßãÂåñ
                    init() {
                        console.log('=== Âπ∏ËøêÈ™∞Â≠êÊ∏∏ÊàèÂàùÂßãÂåñ ===');
                        
                        // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
                        if (!this.checkLogin()) {
                            return;
                        }
                        
                        // ÂàùÂßãÂåñËÉåÊôØ
                        this.initBackground();
                        
                        // Âä†ËΩΩÊ∏∏ÊàèÊï∞ÊçÆ
                        this.loadGameData();
                        
                        // Êõ¥Êñ∞UI
                        this.updateUI();
                        
                        // Ê∑ªÂä†ÈöèÊú∫Èó™ÁîµÊïàÊûú
                        this.initLightning();
                        
                        // ÁªëÂÆö‰∫ã‰ª∂
                        this.bindEvents();
                        
                        console.log('Âπ∏ËøêÈ™∞Â≠êÊ∏∏ÊàèÂàùÂßãÂåñÂÆåÊàê');
                    },
                    
                    // ÁªëÂÆö‰∫ã‰ª∂
                    bindEvents() {
                        // Â±ÄÊï∞ÈÄâÊã©ÊåâÈíÆ
                        document.querySelectorAll('.rounds-btn').forEach(btn => {
                            btn.addEventListener('click', (e) => {
                                this.selectRounds(parseInt(e.target.dataset.rounds));
                            });
                        });
                        
                        // ÂºÄÂßãÊ∏∏ÊàèÊåâÈíÆ
                        const playBtn = document.getElementById('playBtn');
                        if (playBtn) {
                            playBtn.addEventListener('click', () => {
                                this.playGame();
                            });
                        }
                        
                        // ÂÆùÁÆ±ÊåâÈíÆ
                        const treasureBox = document.getElementById('treasureBox');
                        if (treasureBox) {
                            treasureBox.addEventListener('click', () => {
                                this.openTreasureBox();
                            });
                        }
                        
                        const openTreasureBtn = document.getElementById('openTreasureBtn');
                        if (openTreasureBtn) {
                            openTreasureBtn.addEventListener('click', () => {
                                this.openTreasureBox();
                            });
                        }
                        
                        // ÂÖ≥Èó≠ÁªìÁÆóÂºπÁ™óÊåâÈíÆ
                        const settlementCloseBtn = document.getElementById('settlementCloseBtn');
                        if (settlementCloseBtn) {
                            settlementCloseBtn.addEventListener('click', () => {
                                this.closeSettlementModal();
                            });
                        }
                    },
                    
                    // ÈÄâÊã©Â±ÄÊï∞
                    selectRounds(rounds) {
                        this.gameState.selectedRounds = rounds;
                        
                        // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                        document.querySelectorAll('.rounds-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        document.querySelector(`[data-rounds="${rounds}"]`).classList.add('active');
                        
                        console.log(`ÈÄâÊã©Ê∏∏ÊàèÂ±ÄÊï∞: ${rounds}`);
                    },
                    
                    // Êõ¥Êñ∞ÁßØÂàÜÊòæÁ§∫
                    updatePointsDisplay(points) {
                        const userPoints = document.getElementById('userPoints');
                        if (userPoints) {
                            userPoints.textContent = points;
                            console.log('ÁßØÂàÜÊòæÁ§∫Â∑≤Êõ¥Êñ∞:', points);
                        }
                    },
                    
                    // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
                    updateUserInfo() {
                        console.log('Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ...');
                        
                        // Ëé∑ÂèñÂΩìÂâçÁî®Êà∑
                        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                        const userName = document.getElementById('userName');
                        const userPoints = document.getElementById('userPoints');
                        
                        if (userName) {
                            userName.textContent = currentUser.name || 'Êú™Áü•Áî®Êà∑';
                            console.log('Áî®Êà∑ÂêçÂ∑≤Êõ¥Êñ∞:', currentUser.name);
                        }
                        
                        // ÁßØÂàÜÊòæÁ§∫Áî±ÁßØÂàÜÁ≥ªÁªüÂ§ÑÁêÜ
                        if (window.pointsSystem) {
                            const points = window.pointsSystem.getPoints();
                            this.updatePointsDisplay(points);
                        } else {
                            // Â§áÁî®ÊñπÊ°à
                            if (userPoints) {
                                userPoints.textContent = currentUser.points || 0;
                                console.log('Â§áÁî®ÁßØÂàÜÊòæÁ§∫Â∑≤Êõ¥Êñ∞:', currentUser.points);
                            }
                        }
                    },
                    
                    // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
                    checkLogin() {
                        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                        const currentUser = localStorage.getItem('currentUser');
                        
                        console.log('Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ:', { isLoggedIn, currentUser });
                        
                        if (!isLoggedIn || !currentUser) {
                            console.log('Áî®Êà∑Êú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢');
                            window.location.href = 'login.html';
                            return false;
                        }
                        
                        // È™åËØÅÁî®Êà∑Êï∞ÊçÆÊ†ºÂºè
                        try {
                            const user = JSON.parse(currentUser);
                            if (!user || !user.name) {
                                console.log('Áî®Êà∑Êï∞ÊçÆÊ†ºÂºèÈîôËØØÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µÈù¢');
                                window.location.href = 'login.html';
                                return false;
                            }
                        } catch (error) {
                            console.error('Áî®Êà∑Êï∞ÊçÆËß£ÊûêÂ§±Ë¥•:', error);
                            window.location.href = 'login.html';
                            return false;
                        }
                        
                        return true;
                    },
                    
                    // ÂàùÂßãÂåñËÉåÊôØ
                    initBackground() {
                        // Á≤íÂ≠êÊïàÊûú
                        const particlesContainer = document.getElementById('particles');
                        const particleCount = 30;
                        
                        for (let i = 0; i < particleCount; i++) {
                            const particle = document.createElement('div');
                            particle.className = 'particle';
                            particle.style.left = Math.random() * 100 + '%';
                            particle.style.animationDelay = Math.random() * 10 + 's';
                            particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                            particlesContainer.appendChild(particle);
                        }
                        
                        // ‰∫§‰∫íÁ≤íÂ≠ê
                        for (let i = 0; i < 10; i++) {
                            const particle = document.createElement('div');
                            particle.className = 'particle interactive';
                            particle.style.left = Math.random() * 100 + '%';
                            particle.style.animationDelay = Math.random() * 5 + 's';
                            particle.style.animationDuration = (10 + Math.random() * 5) + 's';
                            particlesContainer.appendChild(particle);
                        }
                        
                        // Â®±‰πêÊÄßËÉåÊôØÂÖÉÁ¥†
                        const bgElements = document.getElementById('bgElements');
                        const elements = ['üé≤', 'üéØ', 'üéÅ', 'üí∞', 'üîë', '‚≠ê', 'üéä', 'üéà', 'üéÆ'];
                        
                        for (let i = 0; i < 20; i++) {
                            const element = document.createElement('div');
                            element.className = 'bg-element';
                            element.textContent = elements[i % elements.length];
                            element.style.left = Math.random() * 100 + '%';
                            element.style.animationDelay = Math.random() * 5 + 's';
                            element.style.animationDuration = (20 + Math.random() * 10) + 's';
                            bgElements.appendChild(element);
                        }
                    },
                    
                    // ÂàùÂßãÂåñÈó™ÁîµÊïàÊûú
                    initLightning() {
                        setInterval(() => {
                            if (Math.random() < 0.1) {
                                const lightning = document.getElementById('lightning');
                                lightning.classList.add('flash');
                                setTimeout(() => {
                                    lightning.classList.remove('flash');
                                }, 300);
                            }
                        }, 5000);
                    },
                    
                    // Âä†ËΩΩÊ∏∏ÊàèÊï∞ÊçÆ
                    loadGameData() {
                        const savedData = localStorage.getItem('diceGameData');
                        if (savedData) {
                            const data = JSON.parse(savedData);
                            this.gameState.history = data.history || [];
                            this.gameState.goldKeys = data.goldKeys || 0;
                            this.gameState.stats = data.stats || this.gameState.stats;
                        }
                        
                        // ÈªòËÆ§ÈÄâÊã©1Â±Ä
                        this.selectRounds(1);
                    },
                    
                    // ‰øùÂ≠òÊ∏∏ÊàèÊï∞ÊçÆ
                    saveGameData() {
                        const data = {
                            history: this.gameState.history,
                            goldKeys: this.gameState.goldKeys,
                            stats: this.gameState.stats
                        };
                        localStorage.setItem('diceGameData', JSON.stringify(data));
                    },
                    
                    // Êõ¥Êñ∞UI
                    updateUI() {
                        // Êõ¥Êñ∞Èí•ÂåôÊï∞Èáè
                        document.getElementById('keyCount').textContent = this.gameState.goldKeys;
                        
                        // Êõ¥Êñ∞ÂÆùÁÆ±ÊåâÈíÆÁä∂ÊÄÅ
                        const openBtn = document.getElementById('openTreasureBtn');
                        if (this.gameState.goldKeys > 0) {
                            openBtn.disabled = false;
                            openBtn.textContent = `üéÅ ÊâìÂºÄÂÆùÁÆ± (Ê∂àËÄó1ÊääÈí•Âåô)`;
                        } else {
                            openBtn.disabled = true;
                            openBtn.textContent = 'üéÅ ÊâìÂºÄÂÆùÁÆ± (ÈúÄË¶ÅÈí•Âåô)';
                        }
                        
                        // Êõ¥Êñ∞ÁªüËÆ°
                        this.updateStats();
                    },
                    
                    // ÁîüÊàêÈ™∞Â≠êÁÇπÊï∞ÔºàÊåâÊ¶ÇÁéáÔºâ
                    generateDiceValue() {
                        const random = Math.random();
                        let cumulativeProbability = 0;
                        
                        for (const dice of this.diceProbability) {
                            cumulativeProbability += dice.probability;
                            if (random <= cumulativeProbability) {
                                return dice.value;
                            }
                        }
                        
                        return 1; // ÈªòËÆ§ËøîÂõû1
                    },
                    
                    // ÁîüÊàêÈ™∞Â≠êÁªìÊûú
                    generateDiceResults(rounds) {
                        const results = [];
                        
                        for (let i = 0; i < rounds; i++) {
                            const round = {
                                roundNumber: i + 1,
                                dice: [],
                                totalPoints: 0,
                                winAmount: 0,
                                isLoss: false
                            };
                            
                            // ÁîüÊàê3‰∏™È™∞Â≠ê
                            for (let j = 0; j < 3; j++) {
                                const value = this.generateDiceValue();
                                round.dice.push(value);
                                round.totalPoints += value;
                            }
                            
                            // ËÆ°ÁÆóËé∑ÂæóÁßØÂàÜ
                            round.winAmount = Math.round(round.totalPoints * this.gameState.multiplier);
                            
                            // Âà§Êñ≠ÊòØÂê¶‰∫èÊçü
                            round.isLoss = round.winAmount < this.gameState.currentBet;
                            
                            results.push(round);
                        }
                        
                        return results;
                    },
                    
                    // Ëé∑ÂèñÈ™∞Â≠êÈù¢
                    getDiceFace(value) {
                        const faces = ['', '‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
                        return faces[value];
                    },
                    
                    // ÂºÄÂßãÊ∏∏Êàè
                    async playGame() {
                        console.log('=== ÂºÄÂßãÊ∏∏Êàè ===');
                        
                        if (this.gameState.isPlaying) {
                            console.log('Ê∏∏ÊàèÊ≠£Âú®ËøõË°å‰∏≠ÔºåÂøΩÁï•Êìç‰Ωú');
                            return;
                        }
                        
                        // Ê£ÄÊü•ÁßØÂàÜÁ≥ªÁªü
                        if (!window.pointsSystem) {
                            this.showMessage('ÁßØÂàÜÁ≥ªÁªüÊú™ÂàùÂßãÂåñ', 'error');
                            return;
                        }
                        
                        const totalBet = this.gameState.currentBet * this.gameState.selectedRounds;
                        
                        // Ê£ÄÊü•ÁßØÂàÜÊòØÂê¶Ë∂≥Â§ü
                        if (!window.pointsSystem.hasEnoughPoints(totalBet)) {
                            this.showMessage(`ÁßØÂàÜ‰∏çË∂≥ÔºÅÈúÄË¶Å ${totalBet} ÁßØÂàÜ`, 'error');
                            return;
                        }
                        
                        console.log(`ÂºÄÂßãÊ∏∏ÊàèÔºåÂ±ÄÊï∞: ${this.gameState.selectedRounds}, ÊÄªÊäïÊ≥®: ${totalBet}`);
                        
                        this.gameState.isPlaying = true;
                        const playBtn = document.getElementById('playBtn');
                        playBtn.disabled = true;
                        playBtn.textContent = 'Ê∏∏ÊàèËøõË°å‰∏≠...';
                        
                        // ‰ΩøÁî®PromiseÂåÖË£ÖÂºÇÊ≠•Êìç‰Ωú
                        this.performGame(totalBet)
                            .then(() => {
                                // ÈáçÁΩÆÁä∂ÊÄÅ
                                this.gameState.isPlaying = false;
                                playBtn.disabled = false;
                                playBtn.textContent = 'üé≤ ÂºÄÂßãÊ∏∏Êàè';
                            })
                            .catch((error) => {
                                console.error('Ê∏∏ÊàèËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:', error);
                                this.showMessage('Ê∏∏ÊàèÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error');
                                
                                // ÈáçÁΩÆÁä∂ÊÄÅ
                                this.gameState.isPlaying = false;
                                playBtn.disabled = false;
                                playBtn.textContent = 'üé≤ ÂºÄÂßãÊ∏∏Êàè';
                            });
                    },
                    
                    // ÊâßË°åÊ∏∏ÊàèÈÄªËæë
                    async performGame(totalBet) {
                        try {
                            // Êâ£Èô§ÁßØÂàÜ
                            const deductResult = await window.pointsSystem.updatePoints(
                                -totalBet, 
                                `Âπ∏ËøêÈ™∞Â≠êÊäïÊ≥®(${this.gameState.selectedRounds}Â±Ä)`,
                                { 
                                    rounds: this.gameState.selectedRounds,
                                    betAmount: this.gameState.currentBet,
                                    totalBet: totalBet,
                                    gameAction: 'play_dice'
                                }
                            );
                            
                            if (!deductResult.success) {
                                console.error('ÁßØÂàÜÊâ£Èô§Â§±Ë¥•:', deductResult.error);
                                this.showMessage(deductResult.error || 'ÁßØÂàÜÊâ£Èô§Â§±Ë¥•', 'error');
                                return;
                            }
                            
                            console.log('ÁßØÂàÜÊâ£Èô§ÊàêÂäü:', deductResult);
                            
                            // ÁîüÊàêÊ∏∏ÊàèÁªìÊûú
                            const results = this.generateDiceResults(this.gameState.selectedRounds);
                            
                            // ÊòæÁ§∫È™∞Â≠êÂä®Áîª
                            await this.showDiceAnimation(results);
                            
                            // ËÆ°ÁÆóÊÄªËé∑ÂæóÁßØÂàÜ
                            const totalWin = results.reduce((sum, round) => sum + round.winAmount, 0);
                            
                            // Â¢ûÂä†ÁßØÂàÜ
                            if (totalWin > 0) {
                                const addResult = await window.pointsSystem.updatePoints(
                                    totalWin, 
                                    `Âπ∏ËøêÈ™∞Â≠êËé∑Âæó(${this.gameState.selectedRounds}Â±Ä)`,
                                    { 
                                        rounds: this.gameState.selectedRounds,
                                        winAmount: totalWin,
                                        gameAction: 'win_dice'
                                    }
                                );
                                
                                if (!addResult.success) {
                                    console.error('ÁßØÂàÜÂ¢ûÂä†Â§±Ë¥•:', addResult.error);
                                    this.showMessage('ÁßØÂàÜÂ¢ûÂä†Â§±Ë¥•', 'error');
                                } else {
                                    console.log('ÁßØÂàÜÂ¢ûÂä†ÊàêÂäü:', addResult);
                                }
                            }
                            
                            // ËÆ°ÁÆóÈáëÈí•ÂåôÊéâËêΩ
                            const lossRounds = results.filter(round => round.isLoss);
                            let keysDropped = 0;
                            
                            for (const lossRound of lossRounds) {
                                if (Math.random() < 0.05) { // 5%Ê¶ÇÁéá
                                    keysDropped++;
                                }
                            }
                            
                            if (keysDropped > 0) {
                                this.gameState.goldKeys += keysDropped;
                                this.showMessage(`üîë ÊÅ≠ÂñúÔºÅËé∑Âæó ${keysDropped} ÊääÈáëÈí•ÂåôÔºÅ`, 'key');
                            }
                            
                            // Êõ¥Êñ∞ÁªüËÆ°
                            this.gameState.stats.totalRounds += this.gameState.selectedRounds;
                            this.gameState.stats.totalBet += totalBet;
                            this.gameState.stats.totalWin += totalWin;
                            this.gameState.stats.netProfit = this.gameState.stats.totalWin - this.gameState.stats.totalBet;
                            
                            // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                            this.addToHistory(results, totalBet, totalWin, keysDropped);
                            
                            // ÊòæÁ§∫ÁªìÁÆóÂºπÁ™ó
                            this.showSettlementModal(results, totalBet, totalWin, keysDropped);
                            
                            // ‰øùÂ≠òÊ∏∏ÊàèÊï∞ÊçÆ
                            this.saveGameData();
                            this.updateUI();
                            
                        } catch (error) {
                            console.error('ÊâßË°åÊ∏∏ÊàèÂ§±Ë¥•:', error);
                            throw error;
                        }
                    },
                    
                    // ÊòæÁ§∫È™∞Â≠êÂä®Áîª
                    async showDiceAnimation(results) {
                        const dice1 = document.getElementById('dice1');
                        const dice2 = document.getElementById('dice2');
                        const dice3 = document.getElementById('dice3');
                        
                        // Ëé∑ÂèñÊúÄÂêé‰∏ÄÂ±ÄÁöÑÁªìÊûú
                        const lastResult = results[results.length - 1];
                        
                        // Ê∑ªÂä†3DÊóãËΩ¨Âä®Áîª
                        dice1.style.animation = 'none';
                        dice2.style.animation = 'none';
                        dice3.style.animation = 'none';
                        
                        // Âº∫Âà∂ÈáçÁªò
                        dice1.offsetHeight;
                        dice2.offsetHeight;
                        dice3.offsetHeight;
                        
                        // ËÆæÁΩÆÂä®Áîª
                        dice1.style.animation = 'rollDice 1.5s ease-in-out';
                        dice2.style.animation = 'rollDice 1.5s ease-in-out 0.2s';
                        dice3.style.animation = 'rollDice 1.5s ease-in-out 0.4s';
                        
                        // Á≠âÂæÖÂä®ÁîªÂÆåÊàê
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // ÊòæÁ§∫ÊúÄÁªàÁªìÊûú
                        dice1.textContent = this.getDiceFace(lastResult.dice[0]);
                        dice2.textContent = this.getDiceFace(lastResult.dice[1]);
                        dice3.textContent = this.getDiceFace(lastResult.dice[2]);
                        
                        // ÁßªÈô§Âä®Áîª
                        dice1.style.animation = '';
                        dice2.style.animation = '';
                        dice3.style.animation = '';
                        
                        // Êõ¥Êñ∞ÁªìÊûúÊòæÁ§∫
                        const roundResult = document.getElementById('roundResult');
                        roundResult.textContent = `ÁÇπÊï∞: ${lastResult.totalPoints} | Ëé∑Âæó: ${lastResult.winAmount} ÁßØÂàÜ`;
                        
                        if (lastResult.winAmount > 0) {
                            roundResult.className = 'round-result win';
                        } else {
                            roundResult.className = 'round-result lose';
                        }
                    },
                    
                    // ÊòæÁ§∫ÁªìÁÆóÂºπÁ™ó
                    showSettlementModal(results, totalBet, totalWin, keysDropped) {
                        const modal = document.getElementById('settlementModal');
                        const netProfit = totalWin - totalBet;
                        
                        // Êõ¥Êñ∞Ê±áÊÄª‰ø°ÊÅØ
                        document.getElementById('summaryRounds').textContent = results.length;
                        document.getElementById('summaryBet').textContent = totalBet;
                        document.getElementById('summaryWin').textContent = totalWin;
                        document.getElementById('summaryProfit').textContent = netProfit;
                        
                        // Êõ¥Êñ∞ÁõàÂà©Ê†∑Âºè
                        const profitItem = document.getElementById('summaryProfitItem');
                        const profitValue = document.getElementById('summaryProfit');
                        if (netProfit > 0) {
                            profitItem.className = 'summary-item profit';
                            profitValue.className = 'summary-value';
                        } else if (netProfit < 0) {
                            profitItem.className = 'summary-item loss';
                            profitValue.className = 'summary-value';
                        } else {
                            profitItem.className = 'summary-item';
                            profitValue.className = 'summary-value';
                        }
                        
                        // ÊòæÁ§∫ÂêÑÂ±ÄÁªìÊûú
                        const roundsResults = document.getElementById('roundsResults');
                        roundsResults.innerHTML = results.map(round => {
                            const isWin = round.winAmount > 0;
                            const diceFaces = round.dice.map(d => this.getDiceFace(d)).join('');
                            
                            return `
                                <div class="round-result-item ${isWin ? 'win' : 'lose'}">
                                    <div class="round-dice">${diceFaces}</div>
                                    <div class="round-points ${isWin ? 'win' : 'lose'}">
                                        ${isWin ? '+' : ''}${round.winAmount} ÁßØÂàÜ
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        // ÊòæÁ§∫ÂºπÁ™ó
                        modal.classList.add('active');
                    },
                    
                    // ÂÖ≥Èó≠ÁªìÁÆóÂºπÁ™ó
                    closeSettlementModal() {
                        document.getElementById('settlementModal').classList.remove('active');
                    },
                    
                    // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                    addToHistory(results, totalBet, totalWin, keysDropped) {
                        const historyItem = {
                            timestamp: new Date().toISOString(),
                            rounds: results.length,
                            dice: results.map(r => r.dice),
                            totalBet: totalBet,
                            totalWin: totalWin,
                            netProfit: totalWin - totalBet,
                            keysDropped: keysDropped,
                            result: totalWin > totalBet ? 'win' : 'lose'
                        };
                        
                        this.gameState.history.unshift(historyItem);
                        
                        // Âè™‰øùÁïôÊúÄËøë50Êù°ËÆ∞ÂΩï
                        if (this.gameState.history.length > 50) {
                            this.gameState.history = this.gameState.history.slice(0, 50);
                        }
                        
                        this.renderHistory();
                    },
                    
                    // Ê∏≤ÊüìÂéÜÂè≤ËÆ∞ÂΩï
                    renderHistory() {
                        const historyList = document.getElementById('historyList');
                        
                        if (this.gameState.history.length === 0) {
                            historyList.innerHTML = `
                                <div class="history-item">
                                    <div class="history-dice">ÊöÇÊó†ËÆ∞ÂΩï</div>
                                    <div class="history-details">
                                        <span class="history-amount">ÂºÄÂßãÊ∏∏ÊàèÊü•ÁúãÂéÜÂè≤</span>
                                    </div>
                                </div>
                            `;
                            return;
                        }
                        
                        historyList.innerHTML = this.gameState.history.map(item => {
                            // ‰øÆÂ§çÔºöÁ°Æ‰øù item.dice ÊòØÊï∞ÁªÑ
                            const diceArray = Array.isArray(item.dice) ? item.dice : [];
                            const diceFaces = diceArray.map(round => 
                                Array.isArray(round) ? round.map(d => this.getDiceFace(d)).join('') : this.getDiceFace(round)
                            ).join(' | ');
                            const resultClass = item.result === 'win' ? 'win' : 'lose';
                            const resultText = item.result === 'win' ? 
                                `ÁõàÂà©: ${item.netProfit}` : 
                                `‰∫èÊçü: ${Math.abs(item.netProfit)}`;
                            
                            return `
                                <div class="history-item">
                                    <div class="history-dice">${diceFaces}</div>
                                    <div class="history-details">
                                        <span class="history-amount">${item.rounds}Â±Ä</span>
                                        <span class="history-multiplier">0.6x</span>
                                        ${item.keysDropped > 0 ? `<span class="history-key">üîë${item.keysDropped}</span>` : ''}
                                        <span class="history-result ${resultClass}">${resultText}</span>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    },
                    
                    // ÊâìÂºÄÂÆùÁÆ±
                    async openTreasureBox() {
                        console.log('=== ÊâìÂºÄÂÆùÁÆ± ===');
                        
                        if (this.gameState.goldKeys <= 0) {
                            this.showMessage('ÈáëÈí•Âåô‰∏çË∂≥ÔºÅ', 'error');
                            return;
                        }
                        
                        const treasureBox = document.getElementById('treasureBox');
                        treasureBox.classList.add('opening');
                        
                        // ‰ΩøÁî®PromiseÂåÖË£ÖÂºÇÊ≠•Êìç‰Ωú
                        this.performOpenTreasureBox()
                            .then(() => {
                                treasureBox.classList.remove('opening');
                            })
                            .catch((error) => {
                                console.error('ÊâìÂºÄÂÆùÁÆ±ËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ:', error);
                                this.showMessage('ÊâìÂºÄÂÆùÁÆ±Â§±Ë¥•', 'error');
                                treasureBox.classList.remove('opening');
                            });
                    },
                    
                    // ÊâßË°åÊâìÂºÄÂÆùÁÆ±ÈÄªËæë
                    async performOpenTreasureBox() {
                        try {
                            // Á≠âÂæÖÂä®ÁîªÂÆåÊàê
                            await new Promise(resolve => setTimeout(resolve, 2000));
                            
                            // Ê†πÊçÆÊ¶ÇÁéáÈÄâÊã©Â•ñÂä±
                            const random = Math.random();
                            let cumulativeProbability = 0;
                            let selectedReward = null;
                            
                            for (const reward of this.treasureRewards) {
                                cumulativeProbability += reward.probability;
                                if (random <= cumulativeProbability) {
                                    selectedReward = reward;
                                    break;
                                }
                            }
                            
                            if (!selectedReward) {
                                selectedReward = this.treasureRewards[this.treasureRewards.length - 1];
                            }
                            
                            console.log('ÂÆùÁÆ±Â•ñÂä±:', selectedReward);
                            
                            // Â§ÑÁêÜÂ•ñÂä±
                            if (selectedReward.type === 'points') {
                                // ÁßØÂàÜÂ•ñÂä±
                                const addResult = await window.pointsSystem.updatePoints(
                                    selectedReward.value, 
                                    'Âπ∏ËøêÈ™∞Â≠êÂÆùÁÆ±Â•ñÂä±',
                                    { 
                                        rewardType: 'treasure_box',
                                        rewardAmount: selectedReward.value,
                                        rewardDescription: selectedReward.description
                                    }
                                );
                                
                                if (!addResult.success) {
                                    console.error('ÁßØÂàÜÂ¢ûÂä†Â§±Ë¥•:', addResult.error);
                                    this.showMessage('ÁßØÂàÜÂ¢ûÂä†Â§±Ë¥•', 'error');
                                } else {
                                    console.log('ÁßØÂàÜÂ¢ûÂä†ÊàêÂäü:', addResult);
                                    this.showMessage(`üéÅ ${selectedReward.description}ÔºÅ`, 'treasure');
                                }
                            } else if (selectedReward.type === 'crutch') {
                                // ÊãêÊùñÂ•ñÂä± - ËøôÈáåÈúÄË¶Å‰∏éËÉåÂåÖÁ≥ªÁªüÈõÜÊàê
                                this.showMessage(`üéÅ ${selectedReward.description}ÔºÅ`, 'treasure');
                                // TODO: Ê∑ªÂä†ÊãêÊùñÂà∞ËÉåÂåÖ
                                console.log('Ëé∑ÂæóÊãêÊùñ:', selectedReward.value, '‰∏™');
                            }
                            
                            // Ê∂àËÄóÈí•Âåô
                            this.gameState.goldKeys--;
                            
                            // Êõ¥Êñ∞UI
                            this.updateUI();
                            this.saveGameData();
                            
                        } catch (error) {
                            console.error('ÊâßË°åÊâìÂºÄÂÆùÁÆ±Â§±Ë¥•:', error);
                            throw error;
                        }
                    },
                    
                    // Êõ¥Êñ∞ÁªüËÆ°
                    updateStats() {
                        document.getElementById('totalRounds').textContent = this.gameState.stats.totalRounds;
                        document.getElementById('totalBet').textContent = this.gameState.stats.totalBet;
                        document.getElementById('totalWin').textContent = this.gameState.stats.totalWin;
                        
                        const netProfitElement = document.getElementById('netProfit');
                        netProfitElement.textContent = this.gameState.stats.netProfit;
                        netProfitElement.className = this.gameState.stats.netProfit >= 0 ? 'stat-value positive' : 'stat-value negative';
                    },
                    
                    // ÊòæÁ§∫Ê∂àÊÅØ
                    showMessage(text, type) {
                        const existingMessage = document.querySelector('.message');
                        if (existingMessage) {
                            existingMessage.remove();
                        }
                        
                        const message = document.createElement('div');
                        message.className = `message ${type}`;
                        message.textContent = text;
                        document.body.appendChild(message);
                        
                        setTimeout(() => {
                            message.remove();
                        }, 3000);
                    }
                };
                
                // ÂàùÂßãÂåñÊ∏∏Êàè
                if (window.DiceGame) {
                    window.DiceGame.init();
                    
                    // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
                    window.DiceGame.updateUserInfo();
                } else {
                    console.error('DiceGameÊú™ÂÆö‰πâ');
                }
            }, 1000); // Âª∂Ëøü1ÁßíÁ°Æ‰øùÊâÄÊúâÁ≥ªÁªüÂä†ËΩΩÂÆåÊàê
        });
    </script>
</body>
</html>
