<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸è¿éª°å­ - å¤©åˆ›æ¸¸æˆå¹³å°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #FF7043;
            --secondary: #FFB74D;
            --accent: #FFC107;
            --bg-dark: #2C3E50;
            --bg-light: #34495E;
            --text-light: #ECF0F1;
            --gradient: linear-gradient(135deg, #FF7043, #FFB74D, #FFC107);
            --shadow: 0 8px 25px rgba(255, 112, 67, 0.3);
            --transition: all 0.3s ease;
            --border-radius: 20px;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b1b 50%, #0f0f0f 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* ææ€–èƒŒæ™¯ - åŒæ­¥ä¸»é¡µ */
        .horror-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(139, 0, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(75, 0, 130, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 0, 0, 0.2) 0%, transparent 50%);
            animation: horrorPulse 4s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes horrorPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }
        
        /* é—ªç”µæ•ˆæœ */
        .lightning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0);
            pointer-events: none;
            z-index: 100;
        }
        
        .lightning.flash {
            animation: lightningFlash 0.3s ease-out;
        }
        
        @keyframes lightningFlash {
            0% { background: rgba(255, 255, 255, 0); }
            50% { background: rgba(255, 255, 255, 0.8); }
            100% { background: rgba(255, 255, 255, 0); }
        }
        
        /* åŠ¨æ€èƒŒæ™¯ç²’å­ */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--gradient);
            border-radius: 50%;
            opacity: 0.6;
            animation: particleFloat 20s linear infinite;
        }
        
        .particle.interactive {
            width: 6px;
            height: 6px;
            opacity: 0.8;
            animation: particleFloat 15s linear infinite;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-10vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        /* å¨±ä¹æ€§èƒŒæ™¯å…ƒç´  */
        .bg-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }
        
        .bg-element {
            position: absolute;
            font-size: 2rem;
            opacity: 0.1;
            animation: bgFloat 25s linear infinite;
        }
        
        @keyframes bgFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.1;
            }
            90% {
                opacity: 0.1;
            }
            100% {
                transform: translateY(-10vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* å¯¼èˆªæ  */
        .header {
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: var(--shadow);
            animation: avatarGlow 3s ease-in-out infinite;
        }
        
        @keyframes avatarGlow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 112, 67, 0.5);
            }
            50% {
                box-shadow: 0 0 30px rgba(255, 112, 67, 0.8);
            }
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            color: white;
            font-size: 1.1rem;
        }
        
        .user-points {
            background: var(--gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(255, 112, 67, 0.3);
        }
        
        .user-dropdown {
            position: relative;
        }
        
        .user-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1rem;
            margin-top: 0.5rem;
            min-width: 200px;
            box-shadow: var(--shadow);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 1001;
        }
        
        .user-dropdown.active .user-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            transition: var(--transition);
            cursor: pointer;
            color: var(--text-light);
            text-decoration: none;
        }
        
        .user-dropdown-item:hover {
            background: rgba(255, 112, 67, 0.1);
        }
        
        .user-dropdown-divider {
            height: 1px;
            background: rgba(255, 112, 67, 0.3);
            margin: 0.5rem 0;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            text-decoration: none;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.3);
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }
        
        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius);
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
            position: relative;
            z-index: 10;
            overflow: hidden;
            border: 2px solid rgba(255, 0, 0, 0.3);
        }
        
        .game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient);
            opacity: 0.05;
            z-index: -1;
        }
        
        .game-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 2rem;
            animation: titleGlow 3s ease-in-out infinite;
            text-shadow: 0 3px 6px rgba(255, 0, 0, 0.5);
        }
        
        @keyframes titleGlow {
            0%, 100% {
                text-shadow: 0 3px 6px rgba(255, 0, 0, 0.5);
            }
            50% {
                text-shadow: 0 3px 15px rgba(255, 0, 0, 0.8);
            }
        }
        
        /* æ¸¸æˆåŒºåŸŸ */
        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }
        
        /* éª°å­åŒºåŸŸ - ä¼˜åŒ–UI */
        .dice-section {
            text-align: center;
            position: relative;
        }
        
        .dice-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            position: relative;
            perspective: 1000px;
        }
        
        .dice {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #e67e22, #d35400);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            color: white;
            box-shadow: 0 20px 40px rgba(230, 126, 34, 0.4);
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
        }
        
        .dice::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF69B4, #FF1493);
            border-radius: 20px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .dice:hover::before {
            opacity: 0.6;
        }
        
        .dice.rolling {
            animation: rollDice 1.5s ease-in-out;
        }
        
        @keyframes rollDice {
            0% { 
                transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); 
            }
            25% { 
                transform: rotateX(180deg) rotateY(90deg) rotateZ(90deg); 
            }
            50% { 
                transform: rotateX(360deg) rotateY(180deg) rotateZ(180deg); 
            }
            75% { 
                transform: rotateX(540deg) rotateY(270deg) rotateZ(270deg); 
            }
            100% { 
                transform: rotateX(720deg) rotateY(360deg) rotateZ(360deg); 
            }
        }
        
        .dice-result {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e67e22;
            margin: 1.5rem 0;
            text-shadow: 0 2px 4px rgba(230, 126, 34, 0.3);
            animation: resultPulse 2s ease-in-out infinite;
        }
        
        @keyframes resultPulse {
            0%, 100% { 
                transform: scale(1); 
                filter: drop-shadow(0 2px 4px rgba(230, 126, 34, 0.3));
            }
            50% { 
                transform: scale(1.05); 
                filter: drop-shadow(0 4px 8px rgba(230, 126, 34, 0.5));
            }
        }
        
        /* æŠ•æ³¨åŒºåŸŸ - ä¼˜åŒ–UI */
        .bet-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255, 112, 67, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .bet-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient);
            opacity: 0.05;
            z-index: -1;
        }
        
        .bet-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .bet-info {
            background: rgba(255, 112, 67, 0.1);
            border: 2px solid rgba(255, 112, 67, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .bet-amount {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .bet-description {
            color: #ddd;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        .key-chance {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 1rem;
            animation: keyGlow 2s ease-in-out infinite;
        }
        
        @keyframes keyGlow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
            }
        }
        
        .roll-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .roll-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .roll-btn:hover::before {
            left: 100%;
        }
        
        .roll-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }
        
        .roll-btn:disabled {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            cursor: not-allowed;
            transform: none;
        }
        
        /* å®ç®±åŒºåŸŸ - ä¼˜åŒ–UI */
        .treasure-section {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .treasure-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            opacity: 0.05;
            z-index: -1;
            animation: treasureGlow 3s ease-in-out infinite;
        }
        
        @keyframes treasureGlow {
            0%, 100% { opacity: 0.05; }
            50% { opacity: 0.1; }
        }
        
        .treasure-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
        }
        
        .treasure-box-container {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }
        
        .treasure-box {
            width: 140px;
            height: 140px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            color: white;
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            animation: treasureFloat 3s ease-in-out infinite;
        }
        
        @keyframes treasureFloat {
            0%, 100% { 
                transform: translateY(0px) scale(1); 
            }
            50% { 
                transform: translateY(-10px) scale(1.05); 
            }
        }
        
        .treasure-box::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF69B4, #FF1493);
            border-radius: 20px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .treasure-box:hover::before {
            opacity: 0.8;
        }
        
        .treasure-box:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 25px 50px rgba(255, 215, 0, 0.5);
        }
        
        .treasure-box.opening {
            animation: boxOpen 2s ease-in-out forwards;
        }
        
        @keyframes boxOpen {
            0% { 
                transform: scale(1) rotate(0deg); 
            }
            25% { 
                transform: scale(1.1) rotate(5deg); 
            }
            50% { 
                transform: scale(1.2) rotate(-5deg); 
            }
            75% { 
                transform: scale(1.1) rotate(5deg); 
            }
            100% { 
                transform: scale(0) rotate(360deg); 
                opacity: 0; 
            }
        }
        
        .key-count {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 15px;
            padding: 0.75rem 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
        }
        
        .open-treasure-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .open-treasure-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
        }
        
        .open-treasure-btn:disabled {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            cursor: not-allowed;
            transform: none;
        }
        
        /* å†å²åŒºåŸŸ - ä¼˜åŒ–UI */
        .history-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .history-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }
        
        .history-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .history-item:last-child {
            margin-bottom: 0;
        }
        
        .history-dice {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e67e22;
        }
        
        .history-details {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .history-amount {
            font-weight: bold;
            color: white;
        }
        
        .history-multiplier {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .history-result {
            font-weight: bold;
        }
        
        .history-result.win {
            color: #28a745;
        }
        
        .history-result.lose {
            color: #dc3545;
        }
        
        .history-key {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* ç»Ÿè®¡åŒºåŸŸ - ä¼˜åŒ–UI */
        .stats-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .stats-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #ddd;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        
        .stat-value.positive {
            color: #28a745;
        }
        
        .stat-value.negative {
            color: #dc3545;
        }
        
        /* æ¶ˆæ¯æç¤º - ä¼˜åŒ–UI */
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: var(--shadow);
            max-width: 350px;
            backdrop-filter: blur(10px);
        }
        
        .message.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        
        .message.error {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .message.info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }
        
        .message.treasure {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* å®ç®±å¥–åŠ±æ¨¡æ€æ¡† - ä¼˜åŒ–UI */
        .treasure-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .treasure-modal.active {
            display: flex;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .treasure-modal-content {
            background: linear-gradient(135deg, #FFF0F5, #FFE4E1);
            border-radius: 30px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 215, 0, 0.5);
            position: relative;
            animation: modalSlideUp 0.3s ease-out;
        }
        
        @keyframes modalSlideUp {
            from { 
                transform: translateY(50px); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0); 
                opacity: 1; 
            }
        }
        
        .treasure-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            animation: treasureBounce 2s ease-in-out infinite;
        }
        
        @keyframes treasureBounce {
            0%, 20%, 50%, 80%, 100% { 
                transform: translateY(0); 
            }
            40% { 
                transform: translateY(-10px); 
            }
            60% { 
                transform: translateY(-5px); 
            }
        }
        
        .treasure-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
        }
        
        .treasure-reward {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }
        
        .treasure-description {
            color: #666;
            margin-bottom: 1.5rem;
            line-height: 1.4;
        }
        
        .treasure-close-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .treasure-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-area {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .dice-container {
                gap: 1rem;
            }
            
            .dice {
                width: 100px;
                height: 100px;
                font-size: 3rem;
            }
            
            .treasure-box-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .treasure-box {
                width: 120px;
                height: 120px;
                font-size: 3rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ææ€–èƒŒæ™¯ - åŒæ­¥ä¸»é¡µ -->
    <div class="horror-bg"></div>
    <div class="lightning" id="lightning"></div>
    
    <!-- åŠ¨æ€èƒŒæ™¯ç²’å­ -->
    <div class="particles" id="particles"></div>
    
    <!-- å¨±ä¹æ€§èƒŒæ™¯å…ƒç´  -->
    <div class="bg-elements" id="bgElements"></div>
    
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <div class="header">
        <div class="user-info">
            <div class="user-avatar">ğŸ‘¤</div>
            <div class="user-details">
                <div class="user-name" id="userName">åŠ è½½ä¸­...</div>
                <div class="user-points">ğŸ’° <span id="userPoints">0</span></div>
            </div>
        </div>
        <a href="games.html" class="back-btn">ğŸ  è¿”å›æ¸¸æˆä¸­å¿ƒ</a>
    </div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <div class="game-container">
            <h1 class="game-title">ğŸ² å¹¸è¿éª°å­</h1>
            
            <div class="game-area">
                <!-- éª°å­åŒºåŸŸ -->
                <div class="dice-section">
                    <div class="dice-container">
                        <div class="dice" id="dice1">ğŸ²</div>
                        <div class="dice" id="dice2">ğŸ²</div>
                        <div class="dice" id="dice3">ğŸ²</div>
                    </div>
                    <div class="dice-result" id="diceResult">å‡†å¤‡å¼€å§‹</div>
                </div>
                
                <!-- æŠ•æ³¨åŒºåŸŸ -->
                <div class="bet-section">
                    <div class="bet-title">ğŸ’° æŠ•æ³¨ä¿¡æ¯</div>
                    <div class="bet-info">
                        <div class="bet-amount">5 ç§¯åˆ†/æ¬¡</div>
                        <div class="bet-description">æ¯æ¬¡æŠ•æ³¨å›ºå®š5ç§¯åˆ†ï¼Œ5%æ¦‚ç‡è·å¾—é‡‘é’¥åŒ™ï¼</div>
                        <div class="key-chance">ğŸ”‘ é‡‘é’¥åŒ™æ¦‚ç‡: 5%</div>
                    </div>
                    <button class="roll-btn" id="rollBtn" onclick="rollDice()">ğŸ² æ‘‡éª°å­ (5ç§¯åˆ†)</button>
                </div>
            </div>
            
            <!-- å®ç®±åŒºåŸŸ -->
            <div class="treasure-section">
                <div class="treasure-title">ğŸ å®ç®±ç³»ç»Ÿ</div>
                <div class="treasure-box-container">
                    <div class="treasure-box" id="treasureBox" onclick="openTreasureBox()">ğŸ</div>
                </div>
                <div class="key-count">ğŸ”‘ é‡‘é’¥åŒ™: <span id="keyCount">0</span> æŠŠ</div>
                <button class="open-treasure-btn" id="openTreasureBtn" onclick="openTreasureBox()">ğŸ æ‰“å¼€å®ç®± (æ¶ˆè€—1æŠŠé’¥åŒ™)</button>
            </div>
            
            <!-- å†å²è®°å½• -->
            <div class="history-section">
                <div class="history-title">ğŸ“Š æ¸¸æˆè®°å½•</div>
                <div class="history-list" id="historyList">
                    <div class="history-item">
                        <div class="history-dice">ğŸ²ğŸ²ğŸ²</div>
                        <div class="history-details">
                            <span class="history-amount">æŠ•æ³¨: 5</span>
                            <span class="history-multiplier">å€ç‡: 1.6x</span>
                            <span class="history-result win">èµ¢å¾—: 8</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="stats-section">
                <div class="stats-title">ğŸ“ˆ æ¸¸æˆç»Ÿè®¡</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">æ€»æŠ•æ³¨</div>
                        <div class="stat-value" id="totalBet">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ€»èµ¢å¾—</div>
                        <div class="stat-value positive" id="totalWin">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">é‡‘é’¥åŒ™</div>
                        <div class="stat-value" id="totalKeys">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">èƒœç‡</div>
                        <div class="stat-value" id="winRate">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å®ç®±å¥–åŠ±æ¨¡æ€æ¡† -->
    <div class="treasure-modal" id="treasureModal">
        <div class="treasure-modal-content">
            <div class="treasure-icon">ğŸ</div>
            <h2 class="treasure-title">æ­å–œè·å¾—å®ç®±å¥–åŠ±ï¼</h2>
            <div class="treasure-reward" id="treasureReward">è·å¾— 100 ç§¯åˆ†</div>
            <div class="treasure-description" id="treasureDescription">å®ç®±ä¸­è—ç€ä¸°å¯Œçš„å¥–åŠ±ï¼Œç»§ç»­åŠªåŠ›è·å¾—æ›´å¤šé’¥åŒ™å§ï¼</div>
            <button class="treasure-close-btn" onclick="closeTreasureModal()">ç¡®å®š</button>
        </div>
    </div>

    <!-- å¼•å…¥ç§¯åˆ†ç³»ç»Ÿ -->
    <script src="points-system.js"></script>
    
    <script>
        // å¹¸è¿éª°å­æ¸¸æˆç³»ç»Ÿ - å®Œæ•´ç”¨æˆ·ç³»ç»Ÿå’Œç§¯åˆ†ç³»ç»Ÿæ¥å…¥
        const DiceGame = {
            // æ¸¸æˆçŠ¶æ€
            gameState: {
                currentBet: 5,
                isRolling: false,
                history: [],
                goldKeys: 0,
                stats: {
                    totalBet: 0,
                    totalWin: 0,
                    totalGames: 0,
                    totalWins: 0,
                    totalKeys: 0
                }
            },
            
            // å®ç®±å¥–åŠ±é…ç½®
            treasureRewards: [
                { min: 50, max: 100, description: 'è·å¾—å°‘é‡ç§¯åˆ†å¥–åŠ±' },
                { min: 100, max: 200, description: 'è·å¾—ä¸­ç­‰ç§¯åˆ†å¥–åŠ±' },
                { min: 200, max: 500, description: 'è·å¾—å¤§é‡ç§¯åˆ†å¥–åŠ±' },
                { min: 500, max: 1000, description: 'è·å¾—å·¨é¢ç§¯åˆ†å¥–åŠ±' },
                { min: 1000, max: 2000, description: 'è·å¾—è¶…çº§ç§¯åˆ†å¥–åŠ±' }
            ],
            
            // åˆå§‹åŒ–
            init() {
                console.log('=== å¹¸è¿éª°å­æ¸¸æˆåˆå§‹åŒ– ===');
                
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                if (!this.checkLogin()) {
                    return;
                }
                
                // åˆå§‹åŒ–èƒŒæ™¯
                this.initBackground();
                
                // åˆå§‹åŒ–ç”¨æˆ·ç³»ç»Ÿ
                this.initUserSystem();
                
                // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
                this.initPointsSystem();
                
                // åŠ è½½æ¸¸æˆæ•°æ®
                this.loadGameData();
                
                // æ›´æ–°UI
                this.updateUI();
                
                // æ·»åŠ éšæœºé—ªç”µæ•ˆæœ
                this.initLightning();
                
                console.log('å¹¸è¿éª°å­æ¸¸æˆåˆå§‹åŒ–å®Œæˆ');
            },
            
            // åˆå§‹åŒ–ç”¨æˆ·ç³»ç»Ÿ
            initUserSystem() {
                console.log('åˆå§‹åŒ–ç”¨æˆ·ç³»ç»Ÿ...');
                
                // åˆå§‹åŒ–ç”¨æˆ·ä¸‹æ‹‰èœå•
                const userInfo = document.getElementById('userInfo');
                const dropdown = userInfo.querySelector('.user-dropdown-menu');
                
                if (userInfo && dropdown) {
                    userInfo.addEventListener('click', (e) => {
                        e.stopPropagation();
                        userInfo.classList.toggle('active');
                    });
                    
                    // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
                    document.addEventListener('click', () => {
                        userInfo.classList.remove('active');
                    });
                }
                
                // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                this.updateUserInfo();
                
                // å®šæœŸæ›´æ–°ç”¨æˆ·ä¿¡æ¯
                setInterval(() => {
                    this.updateUserInfo();
                }, 5000);
            },
            
            // åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ
            initPointsSystem() {
                console.log('åˆå§‹åŒ–ç§¯åˆ†ç³»ç»Ÿ...');
                
                if (window.pointsSystem) {
                    // è®¢é˜…ç§¯åˆ†å˜åŠ¨äº‹ä»¶
                    window.pointsSystem.subscribe((data) => {
                        console.log('ç§¯åˆ†ç³»ç»Ÿè®¢é˜…äº‹ä»¶:', data);
                        this.updatePointsDisplay(data.newPoints);
                    });
                    
                    // ç›‘å¬ç§¯åˆ†æ›´æ–°äº‹ä»¶
                    window.addEventListener('pointsUpdated', (e) => {
                        console.log('ç§¯åˆ†æ›´æ–°äº‹ä»¶:', e.detail);
                        this.updatePointsDisplay(e.detail.newPoints);
                    });
                    
                    // åˆå§‹æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
                    const currentPoints = window.pointsSystem.getPoints();
                    this.updatePointsDisplay(currentPoints);
                } else {
                    console.error('ç§¯åˆ†ç³»ç»Ÿæœªæ‰¾åˆ°');
                }
            },
            
            // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
            updatePointsDisplay(points) {
                const userPoints = document.getElementById('userPoints');
                if (userPoints) {
                    userPoints.textContent = points;
                    console.log('ç§¯åˆ†æ˜¾ç¤ºå·²æ›´æ–°:', points);
                }
            },
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            updateUserInfo() {
                console.log('æ›´æ–°ç”¨æˆ·ä¿¡æ¯...');
                
                // è·å–å½“å‰ç”¨æˆ·
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const userName = document.getElementById('userName');
                const userPoints = document.getElementById('userPoints');
                
                if (userName) {
                    userName.textContent = currentUser.name || 'æœªçŸ¥ç”¨æˆ·';
                    console.log('ç”¨æˆ·åå·²æ›´æ–°:', currentUser.name);
                }
                
                // ç§¯åˆ†æ˜¾ç¤ºç”±ç§¯åˆ†ç³»ç»Ÿå¤„ç†
                if (window.pointsSystem) {
                    const points = window.pointsSystem.getPoints();
                    this.updatePointsDisplay(points);
                } else {
                    // å¤‡ç”¨æ–¹æ¡ˆ
                    if (userPoints) {
                        userPoints.textContent = currentUser.points || 0;
                        console.log('å¤‡ç”¨ç§¯åˆ†æ˜¾ç¤ºå·²æ›´æ–°:', currentUser.points);
                    }
                }
            },
            
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            checkLogin() {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                const currentUser = localStorage.getItem('currentUser');
                
                console.log('æ£€æŸ¥ç™»å½•çŠ¶æ€:', { isLoggedIn, currentUser });
                
                if (!isLoggedIn || !currentUser) {
                    console.log('ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                    window.location.href = 'login.html';
                    return false;
                }
                
                // éªŒè¯ç”¨æˆ·æ•°æ®æ ¼å¼
                try {
                    const user = JSON.parse(currentUser);
                    if (!user || !user.name) {
                        console.log('ç”¨æˆ·æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
                        window.location.href = 'login.html';
                        return false;
                    }
                } catch (error) {
                    console.error('ç”¨æˆ·æ•°æ®è§£æå¤±è´¥:', error);
                    window.location.href = 'login.html';
                    return false;
                }
                
                return true;
            },
            
            // åˆå§‹åŒ–èƒŒæ™¯
            initBackground() {
                // ç²’å­æ•ˆæœ
                const particlesContainer = document.getElementById('particles');
                const particleCount = 30;
                
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 10 + 's';
                    particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                    particlesContainer.appendChild(particle);
                }
                
                // äº¤äº’ç²’å­
                for (let i = 0; i < 10; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle interactive';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 5 + 's';
                    particle.style.animationDuration = (10 + Math.random() * 5) + 's';
                    particlesContainer.appendChild(particle);
                }
                
                // å¨±ä¹æ€§èƒŒæ™¯å…ƒç´ 
                const bgElements = document.getElementById('bgElements');
                const elements = ['ğŸ²', 'ğŸ¯', 'ğŸ', 'ğŸ’°', 'ğŸ”‘', 'â­', 'ğŸŠ', 'ğŸˆ', 'ğŸ®'];
                
                for (let i = 0; i < 20; i++) {
                    const element = document.createElement('div');
                    element.className = 'bg-element';
                    element.textContent = elements[i % elements.length];
                    element.style.left = Math.random() * 100 + '%';
                    element.style.animationDelay = Math.random() * 5 + 's';
                    element.style.animationDuration = (20 + Math.random() * 10) + 's';
                    bgElements.appendChild(element);
                }
            },
            
            // åˆå§‹åŒ–é—ªç”µæ•ˆæœ
            initLightning() {
                setInterval(() => {
                    if (Math.random() < 0.1) {
                        const lightning = document.getElementById('lightning');
                        lightning.classList.add('flash');
                        setTimeout(() => {
                            lightning.classList.remove('flash');
                        }, 300);
                    }
                }, 5000);
            },
            
            // åŠ è½½æ¸¸æˆæ•°æ®
            loadGameData() {
                const savedData = localStorage.getItem('diceGameData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    this.gameState.history = data.history || [];
                    this.gameState.goldKeys = data.goldKeys || 0;
                    this.gameState.stats = data.stats || this.gameState.stats;
                }
            },
            
            // ä¿å­˜æ¸¸æˆæ•°æ®
            saveGameData() {
                const data = {
                    history: this.gameState.history,
                    goldKeys: this.gameState.goldKeys,
                    stats: this.gameState.stats
                };
                localStorage.setItem('diceGameData', JSON.stringify(data));
            },
            
            // æ›´æ–°UI
            updateUI() {
                // æ›´æ–°é’¥åŒ™æ•°é‡
                document.getElementById('keyCount').textContent = this.gameState.goldKeys;
                
                // æ›´æ–°å®ç®±æŒ‰é’®çŠ¶æ€
                const openBtn = document.getElementById('openTreasureBtn');
                if (this.gameState.goldKeys > 0) {
                    openBtn.disabled = false;
                    openBtn.textContent = `ğŸ æ‰“å¼€å®ç®± (æ¶ˆè€—1æŠŠé’¥åŒ™)`;
                } else {
                    openBtn.disabled = true;
                    openBtn.textContent = 'ğŸ æ‰“å¼€å®ç®± (éœ€è¦é’¥åŒ™)';
                }
                
                // æ›´æ–°ç»Ÿè®¡
                this.updateStats();
            },
            
            // æ‘‡éª°å­ - ä¼˜åŒ–ç‰ˆ
            async rollDice() {
                console.log('=== å¼€å§‹æ‘‡éª°å­ ===');
                
                if (this.gameState.isRolling) {
                    console.log('æ¸¸æˆæ­£åœ¨æ‘‡éª°ä¸­ï¼Œå¿½ç•¥æ“ä½œ');
                    return;
                }
                
                // æ£€æŸ¥ç§¯åˆ†ç³»ç»Ÿ
                if (!window.pointsSystem) {
                    this.showMessage('ç§¯åˆ†ç³»ç»Ÿæœªåˆå§‹åŒ–', 'error');
                    return;
                }
                
                // æ£€æŸ¥ç§¯åˆ†æ˜¯å¦è¶³å¤Ÿ
                if (!window.pointsSystem.hasEnoughPoints(this.gameState.currentBet)) {
                    this.showMessage('ç§¯åˆ†ä¸è¶³ï¼', 'error');
                    return;
                }
                
                console.log('å¼€å§‹æ‘‡éª°å­ï¼ŒæŠ•æ³¨é‡‘é¢:', this.gameState.currentBet);
                
                this.gameState.isRolling = true;
                const rollBtn = document.getElementById('rollBtn');
                rollBtn.disabled = true;
                rollBtn.textContent = 'æ‘‡éª°ä¸­...';
                
                try {
                    // ä½¿ç”¨ç§¯åˆ†ç³»ç»Ÿæ‰£é™¤ç§¯åˆ†
                    const deductResult = await window.pointsSystem.updatePoints(
                        -this.gameState.currentBet, 
                        'å¹¸è¿éª°å­æŠ•æ³¨',
                        { 
                            betAmount: this.gameState.currentBet,
                            gameAction: 'roll_dice'
                        }
                    );
                    
                    if (!deductResult.success) {
                        console.error('ç§¯åˆ†æ‰£é™¤å¤±è´¥:', deductResult.error);
                        this.showMessage(deductResult.error || 'ç§¯åˆ†æ‰£é™¤å¤±è´¥', 'error');
                        
                        // é‡ç½®çŠ¶æ€
                        this.gameState.isRolling = false;
                        rollBtn.disabled = false;
                        rollBtn.textContent = 'ğŸ² æ‘‡éª°å­ (5ç§¯åˆ†)';
                        return;
                    }
                    
                    console.log('ç§¯åˆ†æ‰£é™¤æˆåŠŸ:', deductResult);
                    
                    // æ·»åŠ æ»šåŠ¨åŠ¨ç”»
                    const dice1 = document.getElementById('dice1');
                    const dice2 = document.getElementById('dice2');
                    const dice3 = document.getElementById('dice3');
                    
                    // æ·»åŠ 3Dæ—‹è½¬åŠ¨ç”»
                    dice1.style.animation = 'none';
                    dice2.style.animation = 'none';
                    dice3.style.animation = 'none';
                    
                    // å¼ºåˆ¶é‡ç»˜
                    dice1.offsetHeight;
                    dice2.offsetHeight;
                    dice3.offsetHeight;
                    
                    // è®¾ç½®åŠ¨ç”»
                    dice1.style.animation = 'rollDice 1.5s ease-in-out';
                    dice2.style.animation = 'rollDice 1.5s ease-in-out 0.2s';
                    dice3.style.animation = 'rollDice 1.5s ease-in-out 0.4s';
                    
                    // ç”Ÿæˆéª°å­ç»“æœ
                    setTimeout(() => {
                        const results = this.generateDiceResults();
                        
                        // æ˜¾ç¤ºç»“æœ
                        dice1.textContent = this.getDiceFace(results[0]);
                        dice2.textContent = this.getDiceFace(results[1]);
                        dice3.textContent = this.getDiceFace(results[2]);
                        
                        const sum = results[0] + results[1] + results[2];
                        document.getElementById('diceResult').textContent = `ç‚¹æ•°: ${sum}`;
                        
                        // ç§»é™¤åŠ¨ç”»
                        dice1.style.animation = '';
                        dice2.style.animation = '';
                        dice3.style.animation = '';
                        
                        // è®¡ç®—ç»“æœ
                        this.calculateResult(sum);
                        
                        // é‡ç½®çŠ¶æ€
                        this.gameState.isRolling = false;
                        rollBtn.disabled = false;
                        rollBtn.textContent = 'ğŸ² æ‘‡éª°å­ (5ç§¯åˆ†)';
                    }, 1500);
                    
                } catch (error) {
                    console.error('æ‘‡éª°å­è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                    this.showMessage('æ‘‡éª°å­å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                    
                    // é‡ç½®çŠ¶æ€
                    this.gameState.isRolling = false;
                    rollBtn.disabled = false;
                    rollBtn.textContent = 'ğŸ² æ‘‡éª°å­ (5ç§¯åˆ†)';
                }
            },
            
            // ç”Ÿæˆéª°å­ç»“æœ
            generateDiceResults() {
                const results = [];
                for (let i = 0; i < 3; i++) {
                    // ç”Ÿæˆ1-6çš„éšæœºæ•°
                    const result = Math.floor(Math.random() * 6) + 1;
                    results.push(result);
                }
                return results;
            },
            
            // è·å–éª°å­é¢
            getDiceFace(value) {
                const faces = ['', 'âš€', 'âš', 'âš‚', 'âšƒ', 'âš„', 'âš…'];
                return faces[value];
            },
            
            // è®¡ç®—ç»“æœ - é›†æˆç§¯åˆ†ç³»ç»Ÿ
            async calculateResult(sum) {
                console.log('=== è®¡ç®—æ‘‡éª°å­ç»“æœ ===');
                console.log('éª°å­ç‚¹æ•°:', sum);
                
                let winAmount = 0;
                let isWin = false;
                let gotKey = false;
                
                // åŸºç¡€è·èƒœæ¡ä»¶ï¼šç‚¹æ•°ä¸º5çš„å€æ•°
                if (sum % 5 === 0) {
                    winAmount = this.gameState.currentBet * 1.6; // å›ºå®šå€ç‡1.6å€
                    isWin = true;
                }
                
                // 5%æ¦‚ç‡è·å¾—é‡‘é’¥åŒ™
                if (Math.random() < 0.05) {
                    this.gameState.goldKeys++;
                    gotKey = true;
                    this.showMessage('ğŸ”‘ æ­å–œï¼è·å¾—ä¸€æŠŠé‡‘é’¥åŒ™ï¼', 'treasure');
                }
                
                try {
                    if (isWin) {
                        // ä½¿ç”¨ç§¯åˆ†ç³»ç»Ÿå¢åŠ ç§¯åˆ†
                        const addResult = await window.pointsSystem.updatePoints(
                            winAmount, 
                            'å¹¸è¿éª°å­è·èƒœ',
                            { 
                                diceSum: sum,
                                betAmount: this.gameState.currentBet,
                                multiplier: 1.6,
                                winAmount: winAmount,
                                gotKey: gotKey
                            }
                        );
                        
                        if (!addResult.success) {
                            console.error('ç§¯åˆ†å¢åŠ å¤±è´¥:', addResult.error);
                            this.showMessage('ç§¯åˆ†å¢åŠ å¤±è´¥', 'error');
                        } else {
                            console.log('ç§¯åˆ†å¢åŠ æˆåŠŸ:', addResult);
                            
                            if (gotKey) {
                                this.showMessage(`ğŸ‰ æ­å–œï¼èµ¢å¾— ${winAmount} ç§¯åˆ† + 1æŠŠé‡‘é’¥åŒ™ï¼`, 'success');
                            } else {
                                this.showMessage(`ğŸ‰ æ­å–œï¼æ‚¨èµ¢å¾—äº† ${winAmount} ç§¯åˆ†ï¼`, 'success');
                            }
                        }
                    } else {
                        this.showMessage(`ğŸ˜” å¾ˆé—æ†¾ï¼æ‚¨å¤±å»äº† ${this.gameState.currentBet} ç§¯åˆ†`, 'error');
                    }
                    
                    // æ·»åŠ åˆ°å†å²è®°å½•
                    this.addToHistory(sum, this.gameState.currentBet, 1.6, isWin, winAmount, gotKey);
                    
                    // æ›´æ–°ç»Ÿè®¡
                    this.updateStats();
                    this.saveGameData();
                    this.updateUI();
                    
                } catch (error) {
                    console.error('è®¡ç®—ç»“æœè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                    this.showMessage('ç»“ç®—å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            },
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory(diceSum, betAmount, multiplier, isWin, winAmount, gotKey) {
                const historyItem = {
                    timestamp: new Date().toISOString(),
                    dice: [diceSum],
                    betAmount: betAmount,
                    multiplier: multiplier,
                    isWin: isWin,
                    winAmount: winAmount,
                    gotKey: gotKey,
                    result: isWin ? 'win' : 'lose'
                };
                
                this.gameState.history.unshift(historyItem);
                
                // åªä¿ç•™æœ€è¿‘50æ¡è®°å½•
                if (this.gameState.history.length > 50) {
                    this.gameState.history = this.gameState.history.slice(0, 50);
                }
                
                this.renderHistory();
            },
            
            // æ¸²æŸ“å†å²è®°å½•
            renderHistory() {
                const historyList = document.getElementById('historyList');
                
                if (this.gameState.history.length === 0) {
                    historyList.innerHTML = `
                        <div class="history-item">
                            <div class="history-dice">æš‚æ— è®°å½•</div>
                            <div class="history-details">
                                <span class="history-amount">å¼€å§‹æ¸¸æˆæŸ¥çœ‹å†å²</span>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                historyList.innerHTML = this.gameState.history.map(item => {
                    const diceFaces = item.dice.map(d => this.getDiceFace(d)).join('');
                    const resultClass = item.isWin ? 'win' : 'lose';
                    const resultText = item.isWin ? `èµ¢å¾—: ${item.winAmount}` : `å¤±å»:${item.betAmount}`;
                    
                    return `
                        <div class="history-item">
                            <div class="history-dice">${diceFaces}</div>
                            <div class="history-details">
                                <span class="history-amount">æŠ•æ³¨: ${item.betAmount}</span>
                                <span class="history-multiplier">å€ç‡: ${item.multiplier}x</span>
                                ${item.gotKey ? '<span class="history-key">ğŸ”‘</span>' : ''}
                                <span class="history-result ${resultClass}">${resultText}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            },
            
            // æ‰“å¼€å®ç®± - é›†æˆç§¯åˆ†ç³»ç»Ÿ
            async openTreasureBox() {
                console.log('=== æ‰“å¼€å®ç®± ===');
                
                if (this.gameState.goldKeys <= 0) {
                    this.showMessage('é‡‘é’¥åŒ™ä¸è¶³ï¼', 'error');
                    return;
                }
                
                const treasureBox = document.getElementById('treasureBox');
                treasureBox.classList.add('opening');
                
                setTimeout(() => {
                    // éšæœºé€‰æ‹©å¥–åŠ±
                    const reward = this.treasureRewards[Math.floor(Math.random() * this.treasureRewards.length)];
                    const rewardAmount = Math.floor(Math.random() * (reward.max - reward.min + 1)) + reward.min;
                    
                    console.log('å®ç®±å¥–åŠ±:', { reward, rewardAmount });
                    
                    try {
                        // ä½¿ç”¨ç§¯åˆ†ç³»ç»Ÿå¢åŠ ç§¯åˆ†
                        const addResult = await window.pointsSystem.updatePoints(
                            rewardAmount, 
                            'å¹¸è¿éª°å­å®ç®±å¥–åŠ±',
                            { 
                                rewardType: 'treasure_box',
                                rewardAmount: rewardAmount,
                                rewardDescription: reward.description
                            }
                        );
                        
                        if (!addResult.success) {
                            console.error('ç§¯åˆ†å¢åŠ å¤±è´¥:', addResult.error);
                            this.showMessage('ç§¯åˆ†å¢åŠ å¤±è´¥', 'error');
                        } else {
                            console.log('ç§¯åˆ†å¢åŠ æˆåŠŸ:', addResult);
                            
                            // æ˜¾ç¤ºå¥–åŠ±æ¨¡æ€æ¡†
                            this.showTreasureModal(rewardAmount, reward.description);
                        }
                    } catch (error) {
                        console.error('æ‰“å¼€å®ç®±è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);
                        this.showMessage('æ‰“å¼€å®ç®±å¤±è´¥', 'error');
                    }
                    
                    // æ¶ˆè€—é’¥åŒ™
                    this.gameState.goldKeys--;
                    
                    // æ›´æ–°UI
                    this.updateUI();
                    this.saveGameData();
                    
                    treasureBox.classList.remove('opening');
                }, 2000);
            },
            
            // æ˜¾ç¤ºå®ç®±å¥–åŠ±æ¨¡æ€æ¡†
            showTreasureModal(amount, description) {
                const modal = document.getElementById('treasureModal');
                const rewardElement = document.getElementById('treasureReward');
                const descElement = document.getElementById('treasureDescription');
                
                rewardElement.textContent = `è·å¾— ${amount} ç§¯åˆ†`;
                descElement.textContent = description;
                
                modal.classList.add('active');
                
                // è‡ªåŠ¨å…³é—­
                setTimeout(() => {
                    modal.classList.remove('active');
                }, 5000);
            },
            
            // å…³é—­å®ç®±æ¨¡æ€æ¡†
            closeTreasureModal() {
                document.getElementById('treasureModal').classList.remove('active');
            },
            
            // æ›´æ–°ç»Ÿè®¡
            updateStats() {
                let totalBet = 0;
                let totalWin = 0;
                let totalGames = 0;
                let totalWins = 0;
                
                this.gameState.history.forEach(item => {
                    totalBet += item.betAmount;
                    totalGames++;
                    if (item.isWin) {
                        totalWin += item.winAmount;
                        totalWins++;
                    }
                });
                
                this.gameState.stats = {
                    totalBet: totalBet,
                    totalWin: totalWin,
                    totalGames: totalGames,
                    totalWins: totalWins,
                    totalKeys: this.gameState.goldKeys
                };
                
                const netProfit = totalWin - totalBet;
                const winRate = totalGames > 0 ? (totalWins / totalGames * 100).toFixed(1) : 0;
                
                document.getElementById('totalBet').textContent = totalBet;
                document.getElementById('totalWin').textContent = totalWin;
                document.getElementById('totalKeys').textContent = this.gameState.goldKeys;
                document.getElementById('winRate').textContent = winRate + '%';
            },
            
            // æ˜¾ç¤ºæ¶ˆæ¯
            showMessage(text, type) {
                const existingMessage = document.querySelector('.message');
                if (existingMessage) {
                    existingMessage.remove();
                }
                
                const message = document.createElement('div');
                message.className = `message ${type}`;
                message.textContent = text;
                document.body.appendChild(message);
                
                setTimeout(() => {
                    message.remove();
                }, 3000);
            }
        };
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–å¹¸è¿éª°å­æ¸¸æˆ');
            DiceGame.init();
        };
    </script>
</body>
</html>